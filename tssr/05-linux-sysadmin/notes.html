<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAABE0AA8AAAAAHWwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY3d1HZY21hcAAAAdgAAACqAAACOvWLi0FjdnQgAAAChAAAABMAAAAgBtX/BGZwZ20AAAKYAAAFkAAAC3CKkZBZZ2FzcAAACCgAAAAIAAAACAAAABBnbHlmAAAIMAAABdQAAAjkYT9TNWhlYWQAAA4EAAAAMwAAADYQ6WvNaGhlYQAADjgAAAAfAAAAJAc6A1pobXR4AAAOWAAAACAAAAA0Kmz/7mxvY2EAAA54AAAAHAAAABwQPBJubWF4cAAADpQAAAAgAAAAIAEHC/NuYW1lAAAOtAAAAYQAAALxhQT4h3Bvc3QAABA4AAAAfgAAAMS3SYh9cHJlcAAAELgAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZHZmnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4Pwz+yMwf9z2KIYg5imAYUZgTJAQDcoQvQAHic7ZHNDYJAFIRnBXf94cDRIiyCKkCpwFCPJ092RcKNDoYKcN4+EmMPvpdvk539zQyAPYBCXEUJhBcCrJ5SQ9YLnLJe4qF5rdb+uWPDngNHTkta101pNyWa8lMhn6xx2dqUnW4q9YOIhAOOeueMSgsR/6ry+P7O5s6xVNg4chBsHUuFnWNJ8uZYwrw7chrsHXkODo7cB0dHOYCTY8kv0VE2WJKD6gOlWjsxAAB4nGNgQAMSEMgc9D8LhAESbAPdAHicrVZpd9NGFB15SZyELCULLWphxMRpsEYmbMGACUGyYyBdnK2VoIsUO+m+8Ynf4F/zZNpz6Dd+Wu8bLySQtOdwmpOjd+fN1czbZRJaktgL65GUmy/F1NYmjew8CemGTctRfCg7eyFlisnfBVEQrZbatx2HREQiULWusEQQ+x5ZmmR86FFGy7akV03KLT3pLlvjQb1V334aOsqxO6GkZjN0aD2yJVUYVaJIpj1S0qZlqPorSSu8v8LMV81QwohOImm8GcbQSN4bZ7TKaDW24yiKbLLcKFIkmuFBFHmU1RLn5IoJDMoHzZDyyqcR5cP8iKzYo5xWsEu20/y+L3mndzk/sV9vUbbkQB/Ijuzg7HQlX4RbW2HctJPtKFQRdtd3QmzZ7FT/Zo/ymkYDtysyvdCMYKl8hRArP6HM/iFZLZxP+ZJHo1qykRNB62VO7Es+gdbjiClxzRhZ0N3RCRHU/ZIzDPaYPh788d4plgsTAngcy3pHJZwIEylhczRJ2jByYCVliyqp9a6YOOV1WsRbwn7t2tGXzmjjUHdiPFsPHVs5UcnxaFKnmUyd2knNoykNopR0JnjMrwMoP6JJXm1jNYmVR9M4ZsaERCICLdxLU0EsO7GkKQTNoxm9uRumuXYtWqTJA/Xco/f05la4udNT2g70s0Z/VqdiOtgL0+lp5C/xadrlIkXp+ukZfkziQdYCMpEtNsOUgwdv/Q7Sy9eWHIXXBtju7fMrqH3WRPCkAfsb0B5P1SkJTIWYVYhWQGKta1mWydWsFqnI1HdDmla+rNMEinIcF8e+jHH9XzMzlpgSvt+J07MjLj1z7UsI0xx8m3U9mtepxXIBcWZ5TqdZlu/rNMfyA53mWZ7X6QhLW6ejLD/UaYHlRzodY3lBC5p038GQizDkAg6QMISlA0NYXoIhLBUMYbkIQ1gWYQjLJRjC8mMYwnIZhrC8rGXV1FNJ49qZWAZsQmBijh65zEXlaiq5VEK7aFRqQ54SbpVUFM+qf2WgXjzyhjmwFkiXyJpfMc6Vj0bl+NYVLW8aO1fAsepvH472OfFS1ouFPwX/1dZUJb1izcOTq/Abhp5sJ6o2qXh0TZfPVT26/l9UVFgL9BtIhVgoyrJscGcihI86nYZqoJVDzGzMPLTrdcuan8P9NzFCFlD9+DcUGgvcg05ZSVnt4KzV19uy3DuDcjgTLEkxN/P6VvgiI7PSfpFZyp6PfB5wBYxKZdhqA60VvNknMQ+Z3iTPBHFbUTZI2tjOBIkNHPOAefOdBCZh6qoN5E7hhg34BWFuwXknXKJ6oyyH7kXs8yik/Fun4kT2qGiMwLPZG2Gv70LKb3EMJDT5pX4MVBWhqRg1FdA0Um6oBl/G2bptQsYO9CMqdsOyrOLDxxb3lZJtGYR8pIjVo6Of1l6iTqrcfmYUl++dvgXBIDUxf3vfdHGQyrtayTJHbQNTtxqVU9eaQ+NVh+rmUfW94+wTOWuabronHnpf06rbwcVcLLD2bQ7SUiYX1PVhhQ2iy8WlUOplNEnvuAcYFhjQ71CKjf+r+th8nitVhdFxJN9O1LfR52AM/A/Yf0f1A9D3Y+hyDS7P95oTn2704WyZrqIX66foNzBrrblZugbc0HQD4iFHrY64yg18pwZxeqS5HOkh4GPdFeIBwCaAxeAT3bWM5lMAo/mMOT7A58xh0GQOgy3mMNhmzhrADnMY7DKHwR5zGHzBnHWAL5nDIGQOg4g5DJ4wJwB4yhwGXzGHwdfMYfANc+4DfMscBjFzGCTMYbCv6dYwzC1e0F2gtkFVoANTT1jcw+JQU2XI/o4Xhv29Qcz+wSCm/qjp9pD6Ey8M9WeDmPqLQUz9VdOdIfU3Xhjq7wYx9Q+DmPpMvxjLZQa/jHyXCgeUXWw+5++J9w/bxUC5AAEAAf//AA94nIVVX2hbZRQ/5/t7893s5ja9f7ouzdZ0TTqz3bRJmogbWya6bG6Cq0VbSV2ddIJjFtfIQHEig80Hda8yUN/0YQz8AyriiyD+xQd92R4HCnaCb3samnpumrpsCsLlfPf7zvedc37nL3CAtc/5W/wQZGA3tOBSY/g+TMjHmwzEoM1Q8+ZjRZY4oJhmBw5/YB6Za0yC5AkhlwA1A1yCBIBOwCII0Cj0U8BAMdUCzq05sKwkP7SlUY6fcJk4Fb/RyE79/6P5hjM/F4aZiXBoeMgzcqQ4Xi1hPqfDLG5FT+lchCVU3lYMyvuwhl1mqndQL0RsuloLywHtthLXI06OblTrhfWVnpSJ5+mwu/JdbtuN3IAnkW0LLMcRwaC7ktrlzridM6kVdyf9uO1UNBByI7JhwtG2sEwab07ORBeilWhqavJCqV0qzZTOl/7ZXQ5TbTcdcFelyGhhRDAQpdqp1FEX3w3cFTc1k9pJQkmm4ySCbSikxRP2QOfN+0tHS5MrpQuTU1Mk5nw0E5Xa0WvrOwDyGax9yB9ma6DAg82wHc43SAGTI4GjBWebOePAERFE8/AHaQpZASSTy8A4WwZiLQMQ82mFKATO0ILicRAoDm9p5P99E5b/fXG+kQYY3TYUuqmERWYoT0u/GNYL2q/4WB3LaVS+VynXsVYIcWw6DkCh3nX1D+VzlYN4LClF5yexSQos8exqZ3KVP+wtrC54u4Nznq6cq+xpMpUUnZ8FUYzE86ud0g28NOIv3Gj5/rmA3ABs7S/ywzFuQ4qyd6QxfNtiQIaEgp3w/entQg4Vcbqa16M5FfpeUB8t1+qeg7mI7cUyOe79wOk86gSxkVec4KPTX69++5x68Yubn5/F+w52z7u08sJX7fZXv8ekT/d2mILJxq6sn+SC6qEJknzLJCxyZEKwWVqYmAPBxBE/9DLeZiWHu7lcr/VytrCRuHojncNuTt9h46tmacmYisnSamdN2bZptcsmSysdVsy1PrOvOzF3xN64Rb937t/og9KHxYdcjIUqFAmIAHGHNzlns+RTPgeUYAQm9DwpNxfxbhhBHPaw3/gfTcXO2L+eJVIx5nsyGkvm9X4/f+bGkH45G0PaSjcMXTjcZyTvi3UdHoCDjQd3IDUVsgwYmUoJK/gp4JJxeRI0MKHZIkgynyIBqBTOUs6rOVCojvjZ4mCQz49ZMlMcp8QoYk6NoBfsxnJtsBohpa8iGJS+ZH7gU7NxME6cmF+t7cO9vB8d3jTWSct0ycW9ranXmolNDwmVkNnxe+8JtoztwS5rKJ0xWS95tQ/1zMYzg69MzUZnNtl1ofNbsml/OJm6f9wjRjpnu2o4MzHzn77IQkRd+1DjwMQ2pqSjGMMhyjrgTbBAKksuUm0iU7hI0aN2wOKOq7WYBSH0HGihj/jkiPxAfmwsEbfYrjMG+j3ij932Db/LV7I/xruNrhnroxjR9HRMb2nTvO0ZXOoHPk8H2ZhDPx93qcE/53sH5np/dkIP7zzhTVKdR/BAY/9ElkkR+A6lJGsqpJ4oQcTxpvBT3Kn58VkaJjgHyPEIws57xkaHh9KuVpDEpJZeMbZ5w/zBHi5NMQ4r5VphsFqID7TyB9eR4pX216c3AHxpdAwoqU9qg0ZJ6yVLKmMSz1iG2z27ifx18NkY0LPx1W/wCc2l5LrznrIsiKsqbmB78A9wIGx4tI8rjihVHJyY9pgMirenVq0yWg7Iw7eogG7ZgYM3qR9959A/fZkg6MnD/exlkmc+jWV4SB15XUR+eqC6l6ZmgPtN9z5JMfik05OV8ljylunJ4J+wA/FUaQSSKotsYsCWqaPBidBLcxkWx7XKFRIb45TGaEhjlF9uUVPqXOtcIwsXbBvfoZXIyRYFdkfnqjExH98xpnPczqzjX/uNdO1Y17Wpi5+6Ts8BXtjVFasp9KZ1mOiNbH65c5w6HgmyF2jFCZywM8mWjRc7T5Pmt0lRy7Y71+jYbpGyvwG4sH0XeJxjYGRgYADiwBB/53h+m68M3MwvgCIM1z5N/g6j///9v5H5BbMnkMvBwAQSBQCIcA9gAHicY2BkYGAO+p8FJF/8//v/F/MLBqAICuAFALYQB5kAeJxjfsHAwLwAiCNB+P9fbJjJmoGBMRUo/wKCAfO2EnQAAAAAANoBXgGcAgICVALaA1IDvAPkBAYEPARyAAEAAAANAF0ABAAAAAAAAgAUACQAcwAAAG4LcAAAAAB4nHWRzWrCQBSFT+pPqUIXLXTTzayKUohGKIibCoLuhbrrYtTRxCYZmYyKyz5Fd32HvlDfoO/QkziIFJtw9bvnnpl7ZwLgBt/wcHieGAf2UGd24Atcou+4RH3kuEweO66QXx1XyaHjGh6ROa7jFp/cwStfMVvhy7GHO+/e8QWuvcBxifqz4zL5xXGF/Oa4Sn53XMPE+3Bcx4P3M9DrvYmWoRWNQVN02kFXTPdCU4pSGQu5saE2meiLhU6timPtz3SSs9ypTCdqrJabWJoT5QQnymSRTkXgt0/UkUqVkVbN807ZdtmxdiEWRidi6HqItdErNbN+aO2612qd9sYAGmvsYRBhyUu0EGhQbfK/gzYCdElTOgSdB1eEFBIxFYkNV4RFJWPeZyyYpVQVHTHZx4y/yVGX2LGWFZri51TccUOn5B7nPefVCSPvGhVVwUl9znveO2KkhV8Wk82PZ8qwZf8OVcu1+fSmWCMw/HMOwXvKaysqM+p+cVuWag8tvv+c+xdd+4+teJxtjUEOwiAURJla24KliQfhUA2g/Sl+CKXx+loNrpzVezOLEY34Ron/0WhwQoszOvQYIKFwwQiNSbSBeO2SZ0tBP4j3zVjKNng32ZmtD1VVXCuOiw/pJ8S3WOU6l+K5UOTaDC4+2TjKMtN9KQf1ezLx/Sg/00FCvABHhjDjAAB4nGPw3sFwIihiIyNjX+QGxp0cDBwMyQUbGVidNjEwMmiBGJu5mBg5ICw+BjCLzWkX0wGgNCeQze60i8EBwmZmcNmowtgRGLHBoSNiI3OKy0Y1EG8XRwMDI4tDR3JIBEhJJBBs5mFi5NHawfi/dQNL70YmBhcADHYj9AAA) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable,
.markdown-body .highlighttable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr,
.markdown-body .highlighttable {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite,
.markdown-body .highlighttable pre,
.markdown-body .highlighttable div.highlight {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td,
.markdown-body .highlighttable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite,
.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

.markdown-body diagram-div, .markdown-body div.uml-sequence-diagram, .markdown-body, div.uml-flowchart {
  overflow: auto;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.highlight {background-color:#fff;color:#333333;}
.highlight .hll {background-color:#ffffcc;}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#dd1144}
.highlight .n{color:#333333}
.highlight .na{color:teal}
.highlight .nb{color:#0086b3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:teal}
.highlight .ni{color:purple}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:navy}
.highlight .nv{color:teal}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#dd1144}
.highlight .sc{color:#dd1144}
.highlight .sd{color:#dd1144}
.highlight .s2{color:#dd1144}
.highlight .se{color:#dd1144}
.highlight .sh{color:#dd1144}
.highlight .si{color:#dd1144}
.highlight .sx{color:#dd1144}
.highlight .sr{color:#009926}
.highlight .s1{color:#dd1144}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:teal}
.highlight .vg{color:teal}
.highlight .vi{color:teal}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
</style><title>notes</title></head><body><article class="markdown-body"><h1 id="05-linux-sysadmin">05 - Linux Sysadmin<a class="headerlink" href="#05-linux-sysadmin" title="Permanent link"></a></h1>
<p>Du 21/02 au 04/03 - Formateur : Arnaud CORMIER</p>
<div class="toc">
<ul>
<li><a href="#05-linux-sysadmin">05 - Linux Sysadmin</a><ul>
<li><a href="#revisions">Révisions</a><ul>
<li><a href="#sudo-su-env">sudo / su / env</a></li>
</ul>
</li>
<li><a href="#cours">Cours</a></li>
<li><a href="#4-demarrage-du-systeme">4. Démarrage du système</a><ul>
<li><a href="#41-bootloader">4.1 Bootloader</a><ul>
<li><a href="#fichier-de-configuration">Fichier de configuration</a></li>
<li><a href="#edition">Edition</a></li>
<li><a href="#prise-en-compte-des-modifications">Prise en compte des modifications</a></li>
</ul>
</li>
<li><a href="#42-grub-au-demarrage-de-la-machine">4.2 GRUB au démarrage de la machine</a></li>
<li><a href="#43-le-noyau-linux">4.3 Le noyau Linux</a><ul>
<li><a href="#431-fichiers-du-noyau">4.3.1 Fichiers du noyau</a></li>
<li><a href="#432-relation-grubkernel">4.3.2 Relation GRUB/kernel</a><ul>
<li><a href="#4321-constitution-de-la-ligne-de-lancement-du-noyau">4.3.2.1 Constitution de la ligne de lancement du noyau</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#44-le-gestionnaire-de-systeme-systemd">4.4 Le gestionnaire de système : systemd</a><ul>
<li><a href="#441-la-notion-de-cible">4.4.1 La notion de cible</a><ul>
<li><a href="#4411-les-differentes-cibles">4.4.1.1 Les différentes cibles</a></li>
</ul>
</li>
<li><a href="#442-commandes-de-gestion-de-systemd">4.4.2 Commandes de gestion de systemd</a><ul>
<li><a href="#4421-connaitre-la-cible-par-defaut">4.4.2.1 Connaître la cible par défaut</a></li>
<li><a href="#4422-lister-les-unites">4.4.2.2 Lister les unités</a></li>
<li><a href="#4423-gestion-des-unites">4.4.2.3 Gestion des unités</a></li>
<li><a href="#4424-changer-de-cible">4.4.2.4 Changer de cible</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#45-eteindre-redemarrer-le-systeme">4.5 Eteindre / Redémarrer le système</a></li>
</ul>
</li>
<li><a href="#5-mode-maintenance-au-demarrage">5. Mode Maintenance au démarrage</a><ul>
<li><a href="#51-methode-1-avec-grub">5.1 Méthode 1 avec GRUB</a></li>
<li><a href="#52-methode-2-avec-grub">5.2 Méthode 2 avec GRUB</a></li>
<li><a href="#53-methode-3-avec-media-dinstallation">5.3 Méthode 3 avec média d&rsquo;installation</a></li>
</ul>
</li>
<li><a href="#6-gestion-basique-du-reseau">6. Gestion basique du réseau</a><ul>
<li><a href="#61-informations-generales">6.1 Informations générales</a></li>
<li><a href="#62-prise-dinformation-en-cli">6.2 Prise d&rsquo;information en cli</a><ul>
<li><a href="#621-connaitre-ses-ip-via-la-commande-ip">6.2.1 Connaître ses IP via la commande ip</a></li>
<li><a href="#622-connaitre-sa-route-par-defaut">6.2.2 Connaître sa route par défaut</a></li>
<li><a href="#623-connaitre-les-serveurs-dns">6.2.3 Connaître les serveurs DNS</a></li>
</ul>
</li>
<li><a href="#63-configuration-dun-systeme-sans-interface-graphique">6.3 Configuration d&rsquo;un système sans interface graphique</a><ul>
<li><a href="#631-configuration-ip-en-dhcp">6.3.1 Configuration IP en DHCP</a></li>
<li><a href="#632-configuration-ip-en-adressage-static-et-dns-static">6.3.2 Configuration IP en adressage static et DNS static</a><ul>
<li><a href="#6321-configuration-de-la-couche-ip-statique">6.3.2.1 Configuration de la couche IP statique</a></li>
<li><a href="#6322-configuration-du-dns-statique">6.3.2.2 Configuration du DNS statique</a></li>
</ul>
</li>
<li><a href="#633-prise-en-compte-des-modifications">6.3.3 Prise en compte des modifications</a></li>
</ul>
</li>
<li><a href="#64-configuration-dun-systeme-dexploitation">6.4 Configuration d&rsquo;un système d&rsquo;exploitation</a></li>
</ul>
</li>
<li><a href="#7-gestion-des-paquets">7. Gestion des paquets</a><ul>
<li><a href="#71-les-releases">7.1 Les Releases</a></li>
<li><a href="#72-gestion-des-depots">7.2 Gestion des dépôts</a><ul>
<li><a href="#721-le-fichier-sourceslist">7.2.1 Le fichier sources.list</a></li>
</ul>
</li>
<li><a href="#73-gestion-courante-des-paquets">7.3 Gestion courante des paquets</a><ul>
<li><a href="#731-les-commandes-courantes-de-gestion">7.3.1 Les commandes courantes de gestion</a><ul>
<li><a href="#notes-sur-desinstallation-via-apt-stackoverflow">Notes sur désinstallation via apt (StackOverflow)</a></li>
</ul>
</li>
<li><a href="#732-la-commande-dpkg">7.3.2 La commande dpkg</a></li>
<li><a href="#733-les-fichiers-journaux">7.3.3 Les fichiers journaux</a></li>
</ul>
</li>
<li><a href="#74-installation-a-partir-des-sources">7.4 Installation à partir des sources</a></li>
</ul>
</li>
<li><a href="#8-gestion-des-espaces-de-stockage">8. Gestion des espaces de stockage</a><ul>
<li><a href="#81-partitionner-un-disque">8.1 Partitionner un disque</a><ul>
<li><a href="#811-la-norme-intel-du-mbr">8.1.1 La norme Intel du MBR</a></li>
<li><a href="#812-la-norme-intel-gpt">8.1.2 La norme Intel GPT</a></li>
<li><a href="#813-nommage-des-partitions-sous-linux">8.1.3 Nommage des partitions sous Linux</a><ul>
<li><a href="#8131-nommage-des-disques">8.1.3.1 Nommage des disques</a></li>
<li><a href="#8132-nommage-des-partitions">8.1.3.2 Nommage des partitions</a></li>
</ul>
</li>
<li><a href="#814-outils-de-partitionnement">8.1.4 Outils de partitionnement</a><ul>
<li><a href="#8141-fdisk">8.1.4.1 fdisk</a><ul>
<li><a href="#81411-prise-dinformation">8.1.4.1.1 Prise d&rsquo;information</a></li>
<li><a href="#81412-partitionnement">8.1.4.1.2 Partitionnement</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#82-lvm-logical-volume-manager">8.2 LVM Logical Volume Manager</a><ul>
<li><a href="#821-pre-requis">8.2.1 Pré-requis</a></li>
<li><a href="#822-creer-des-partitions-lvm">8.2.2 Créer des partitions LVM</a></li>
<li><a href="#823-ajouter-agrandir-diminuer-une-partition-lvm">8.2.3 Ajouter, agrandir, diminuer une partition LVM</a><ul>
<li><a href="#ajouter-des-volumes-physiques-au-groupe-de-volume">Ajouter des volumes physiques au groupe de volume</a></li>
<li><a href="#agrandir-un-volume-logique">Agrandir un volume logique</a></li>
<li><a href="#redimensionner-le-systeme-de-fichier-de-type-ext">Redimensionner le système de fichier de type ext</a></li>
</ul>
</li>
<li><a href="#824-afficher-les-informations-lvm">8.2.4 Afficher les informations LVM</a></li>
</ul>
</li>
<li><a href="#83-gestion-des-systemes-de-fichiers">8.3 Gestion des systèmes de fichiers</a><ul>
<li><a href="#831-considerations-generales">8.3.1 Considérations générales</a><ul>
<li><a href="#8311-le-superbloc">8.3.1.1 Le superbloc</a></li>
<li><a href="#8312-inodes-et-blocs-dindirection">8.3.1.2 Inodes et blocs d&rsquo;indirection</a></li>
</ul>
</li>
<li><a href="#832-systeme-de-fichier-ext">8.3.2 Système de fichier EXT</a><ul>
<li><a href="#8321-lext4">8.3.2.1 L&rsquo;EXT4</a></li>
</ul>
</li>
<li><a href="#833-les-autres-systemes-de-fichiers-sous-debian">8.3.3 Les autres systèmes de fichiers sous Debian</a></li>
<li><a href="#834-outils-de-gestion-des-systemes-de-fichiers">8.3.4 Outils de gestion des systèmes de fichiers</a><ul>
<li><a href="#8341-creation-mkfs">8.3.4.1 Création (mkfs)</a></li>
<li><a href="#8342-modification">8.3.4.2 Modification</a><ul>
<li><a href="#tune2fs">tune2fs</a></li>
<li><a href="#resize2fs">resize2fs</a></li>
</ul>
</li>
<li><a href="#8343-verification-fsck">8.3.4.3 Vérification (fsck)</a></li>
<li><a href="#8344-prise-dinformation">8.3.4.4 Prise d&rsquo;information</a><ul>
<li><a href="#blkid">blkid</a></li>
<li><a href="#lsblk">lsblk</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#84-montage-dun-systeme-de-fichiers">8.4 Montage d&rsquo;un système de fichiers</a><ul>
<li><a href="#841-prise-dinfos-sur-le-systeme-de-fichiers-avec-blkid">8.4.1 Prise d&rsquo;infos sur le système de fichiers avec blkid</a></li>
<li><a href="#842-montage-manuel-avec-mount">8.4.2 Montage manuel avec mount</a></li>
<li><a href="#843-prise-dinformation-des-points-de-montage">8.4.3 Prise d&rsquo;information des points de montage</a><ul>
<li><a href="#8431-mount">8.4.3.1 mount</a></li>
<li><a href="#8432-findmnt">8.4.3.2 findmnt</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#85-montage-automatique-fstab">8.5 Montage automatique (fstab)</a></li>
<li><a href="#86-commandes-informatives-utiles">8.6 Commandes informatives utiles</a><ul>
<li><a href="#861-information-sur-les-systemes-de-fichiers-montes-df">8.6.1 Information sur les systèmes de fichiers montés (df)</a></li>
<li><a href="#862-information-sur-lespace-utilise-par-les-repertoires-du">8.6.2 Information sur l&rsquo;espace utilisé par les répertoires (du)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#9-gestion-des-utilisateurs-et-des-groupes">9. Gestion des utilisateurs et des groupes</a><ul>
<li><a href="#91-gestion-des-groupes">9.1 Gestion des groupes</a><ul>
<li><a href="#911-etcgroup">9.1.1 /etc/group</a></li>
<li><a href="#912-etcgshadow">9.1.2 /etc/gshadow</a></li>
<li><a href="#913-commandes-de-gestions-des-groupes">9.1.3 Commandes de gestions des groupes</a><ul>
<li><a href="#9131-creation-groupadd">9.1.3.1 Création (groupadd)</a></li>
<li><a href="#9132-modification-groupmod">9.1.3.2 Modification (groupmod)</a></li>
<li><a href="#9133-suppression-groupdel">9.1.3.3 Suppression (groupdel)</a></li>
<li><a href="#9134-gpasswd">9.1.3.4 gpasswd</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#92-gestion-des-utilisateurs">9.2 Gestion des utilisateurs</a><ul>
<li><a href="#921-etcpasswd">9.2.1 /etc/passwd</a></li>
<li><a href="#922-etcshadow">9.2.2 /etc/shadow</a></li>
<li><a href="#923-commandes-de-gestions-des-utilisateurs">9.2.3 Commandes de gestions des utilisateurs</a><ul>
<li><a href="#9231-creation-useradd-adduser">9.2.3.1 Création (useradd / adduser)</a><ul>
<li><a href="#notes-sur-etcskel">Notes sur /etc/skel</a></li>
</ul>
</li>
<li><a href="#9232-modification-usermod">9.2.3.2 Modification (usermod)</a></li>
<li><a href="#9233-suppression-userdel">9.2.3.3 Suppression (userdel)</a></li>
<li><a href="#9234-modification-du-mot-de-passe-passwd">9.2.3.4 Modification du mot de passe (passwd)</a></li>
</ul>
</li>
<li><a href="#924-outils-de-verification-getent-id">9.2.4 Outils de vérification (getent / id)</a></li>
</ul>
</li>
<li><a href="#93-changement-didentite-et-elevation-de-privileges">9.3 Changement d&rsquo;identité et élévation de privilèges</a><ul>
<li><a href="#931-la-commande-su">9.3.1 la commande su</a></li>
<li><a href="#932-la-commande-sudo">9.3.2 la commande sudo</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#10-droits-sur-les-fichiers-et-repertoires">10. Droits sur les fichiers et répertoires</a><ul>
<li><a href="#100-notes-perso">10.0 Notes perso</a><ul>
<li><a href="#1000-types-de-fichiers">10.0.0 Types de fichiers</a></li>
<li><a href="#1001-permissions-rwx">10.0.1 Permissions (rwx)</a><ul>
<li><a href="#10010-change-ownership-chown">10.0.1.0 Change ownership (chown)</a></li>
<li><a href="#10011-change-permission-chmod">10.0.1.1 Change permission (chmod)</a></li>
<li><a href="#10012-droits-speciaux-setuid-setgid-sticky-bit">10.0.1.2 Droits spéciaux (setuid, setgid, sticky bit)</a><ul>
<li><a href="#100121-setuid-setgid">10.0.1.2.1 setuid, setgid</a></li>
<li><a href="#100122-sticky-bit">10.0.1.2.2 sticky bit</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#101-modification-des-droits-et-proprietaire">10.1 Modification des droits et propriétaire</a><ul>
<li><a href="#1011-modification-des-droits-chmod">10.1.1 Modification des droits (chmod)</a></li>
<li><a href="#1012-modification-du-proprietaire-chown">10.1.2 Modification du propriétaire (chown)</a></li>
</ul>
</li>
<li><a href="#102-umask">10.2 umask</a></li>
<li><a href="#103-droits-speciaux">10.3 Droits spéciaux</a><ul>
<li><a href="#setuid">SetUID</a></li>
<li><a href="#setgid">SetGID</a></li>
<li><a href="#sticky-bit">Sticky bit</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#11-maintenance-du-systeme-en-production">11. Maintenance du système en production</a><ul>
<li><a href="#111-necessite-danalyser-son-systeme">11.1 Nécessité d&rsquo;analyser son système</a></li>
<li><a href="#112-gestion-des-journaux-systeme-et-applicatif">11.2 Gestion des journaux système et applicatif</a><ul>
<li><a href="#1121-journald-au-travers-de-systemd">11.2.1 journald au travers de systemd</a><ul>
<li><a href="#11211-journalctl">11.2.1.1 journalctl</a></li>
</ul>
</li>
<li><a href="#1122-rsyslog-a-travers-journald">11.2.2 rsyslog à travers journald</a><ul>
<li><a href="#11221-principe-de-fonctionnement">11.2.2.1 Principe de fonctionnement</a></li>
</ul>
</li>
<li><a href="#1123-commande-dinteraction-avec-journald-et-rsyslog">11.2.3 Commande d&rsquo;interaction avec journald et rsyslog</a></li>
</ul>
</li>
<li><a href="#113-planification-des-taches">11.3 Planification des tâches</a><ul>
<li><a href="#1131-planification-utilisateur">11.3.1 Planification utilisateur</a></li>
<li><a href="#1132-planification-systeme">11.3.2 Planification système</a></li>
<li><a href="#1133-lancement-des-taches-non-executees-avec-anacron">11.3.3 Lancement des tâches non executées avec anacron</a><ul>
<li><a href="#11331-analyse-dun-travail-danacron-durant-le-demarrage-du-systeme">11.3.3.1 Analyse d&rsquo;un travail d&rsquo;anacron durant le démarrage du système</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#114-gestion-de-la-taille-des-fichiers-de-log">11.4 Gestion de la taille des fichiers de log</a><ul>
<li><a href="#1141-avec-journald">11.4.1 avec journald</a></li>
<li><a href="#1142-avec-logrotate">11.4.2 avec logrotate</a></li>
</ul>
</li>
<li><a href="#115-outils-danalyse-du-systeme">11.5 Outils d&rsquo;analyse du système</a><ul>
<li><a href="#1151-prise-dinformation-sur-le-systeme">11.5.1 Prise d&rsquo;information sur le système</a><ul>
<li><a href="#11511-connaitre-la-version-du-systeme-etcdebian_version">11.5.1.1 Connaître la version du système (/etc/debian_version)</a></li>
<li><a href="#11512-connaitre-la-version-du-kernel-actif-et-son-architecture-uname-a">11.5.1.2 Connaître la version du kernel actif et son architecture (uname -a)</a></li>
<li><a href="#11513-connaitre-le-type-de-cpu-lscpu">11.5.1.3 Connaître le type de CPU (lscpu)</a></li>
<li><a href="#11514-lister-les-informations-des-peripheriques-pci-lspci">11.5.1.4 Lister les informations des périphériques PCI (lspci)</a></li>
<li><a href="#11515-lister-les-informations-des-peripheriques-usb-lsusb">11.5.1.5 Lister les informations des périphériques USB (lsusb)</a></li>
<li><a href="#11516-lister-les-informations-sur-les-disques-partitions-lvm-et-systeme-de-fichiers">11.5.1.6 Lister les informations sur les disques, partitions LVM, et système de fichiers</a></li>
<li><a href="#11517-lister-les-informations-sur-les-repertoires-et-les-fichiers-du-ls-file-lsof">11.5.1.7 Lister les informations sur les répertoires et les fichiers (du, ls, file, lsof)</a></li>
<li><a href="#11518-performances-et-processus">11.5.1.8 Performances et processus</a><ul>
<li><a href="#115181-infos-en-temps-reel-top-htop-atop-glances">11.5.1.8.1 Infos en temps réel (top, htop, atop, glances)</a></li>
<li><a href="#115182-infos-directes-ps-pgrep-free">11.5.1.8.2 Infos directes (ps, pgrep, free)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="revisions">Révisions<a class="headerlink" href="#revisions" title="Permanent link"></a></h2>
<p>Plusieurs shells : <strong>shell</strong>, <strong>bash</strong> (originels, par défaut sur tout Debian)</p>
<p>Shells caca : <strong>kornshell</strong>, <strong>dash</strong>, <strong>csh</strong></p>
<p>Shells cools axés dev : <strong>zsh</strong> (installation modules possibles)</p>
<h3 id="sudo-su-env">sudo / su / env<a class="headerlink" href="#sudo-su-env" title="Permanent link"></a></h3>
<div class="highlight"><pre><span class="nv">$ </span>env               <span class="c1"># Affiche toutes les variables d&#39;environnement</span>
<span class="o">[</span>...<span class="o">]</span>         
<span class="nv">$ </span>su -              <span class="c1"># - permet de recharcher toutes les var d&#39;env</span>
<span class="nv">$ </span>sudo -s           <span class="c1"># --shell runs shell as the target user ; a command may also be specified</span>
<span class="nv">$ </span>sudo -u monUser   <span class="c1"># run shell as specified usesr name or id ; a command may also be specified</span>
<span class="nv">$ </span>sudo -i           <span class="c1"># run login shell as the target user ; a command may also be specified </span>
</pre></div>

<h2 id="cours">Cours<a class="headerlink" href="#cours" title="Permanent link"></a></h2>
<p>3 versions de Debian : stable, testing, unstable </p>
<p>Les versions instables de Debian s&rsquo;appellent toujours <strong>Syd</strong>. </p>
<p>Outils (freemium) pour cloner une machine et la redéployer : <strong>Acronis True Image</strong> (la plus utilisée), <strong>Symantec Ghost</strong>, <strong>CloneZilla</strong>. </p>
<h2 id="4-demarrage-du-systeme">4. Démarrage du système<a class="headerlink" href="#4-demarrage-du-systeme" title="Permanent link"></a></h2>
<h3 id="41-bootloader">4.1 Bootloader<a class="headerlink" href="#41-bootloader" title="Permanent link"></a></h3>
<p>Le chargeur d&rsquo;amorçage est le tout premier programme exécuté par le BIOS (legacy ou UEFI). 
Sa principale mission est de lancer le (ou un des) noyau(x) d&rsquo;OS installé(s) sur le disque dur.</p>
<p>Sous Debian, le boot loader s&rsquo;appelle <strong>GRUB2</strong>.</p>
<p>Il se divise en plusieurs partie nommées <strong>stage</strong>, stockées à divers endroits du disque dur principal :
- <strong>Stage 1</strong> : dans le Master Boot Record (MBR), situé dans les tous premiers secteurs du disque.
- <strong>Stage 1.5</strong> : également localisé au début du disque dur contenant le boot loader (BL)
- <strong>Stage 2</strong> : d&rsquo;un point de vue Linux, la fin de GRUB est placé dans le répertoire <code>/boot/grub</code></p>
<p>GRUB est rarement modifié sur un système en production de façon manuelle, mais sur une plateforme personnelle il peut permettre de gérer le multiboot.</p>
<h4 id="fichier-de-configuration">Fichier de configuration<a class="headerlink" href="#fichier-de-configuration" title="Permanent link"></a></h4>
<div class="highlight"><pre>/boot/grub/grub.cfg
</pre></div>

<p>Début du fichier :</p>
<div class="highlight"><pre>#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#
</pre></div>

<p>IL NE FAUT PAS EDITER CE FICHIER. </p>
<p>En effet, ce fichier est susceptible d&rsquo;être régénéré automatiquement, à chaque mise à jour du noyau par ex. </p>
<h4 id="edition">Edition<a class="headerlink" href="#edition" title="Permanent link"></a></h4>
<p>Les modifications de la config GRUB doivent être opérées à partir des fichiers :
- <code>/etc/default/grub</code> contenant les paramètres et options globales
- des scripts présents dans le dossier <code>/etc/grub.d</code>, incluant des paramètres spécifiques, par ex. pour déclencher la détection d&rsquo;autres OS installés sur la machine.
- Utiliser nano ou vi pour modifier les fichiers</p>
<h4 id="prise-en-compte-des-modifications">Prise en compte des modifications<a class="headerlink" href="#prise-en-compte-des-modifications" title="Permanent link"></a></h4>
<p>Pour que les modif soient prises en compte, il faut régénérer le fichier de configuration via 2 commandes possibles :</p>
<div class="highlight"><pre># grub-mkconfig -o /boot/grub/grub.cfg
(ou)
# update-grub
</pre></div>

<p><strong>Notes</strong> : il est assez rare de modifier ces fichiers, sauf cas particulier ex. gestion avancées de l&rsquo;ACPI, options graphiques, etc.</p>
<h3 id="42-grub-au-demarrage-de-la-machine">4.2 GRUB au démarrage de la machine<a class="headerlink" href="#42-grub-au-demarrage-de-la-machine" title="Permanent link"></a></h3>
<p>Selon la config de GRUB, il est possible de paramétrer l&rsquo;affichage du menu au démarrage de l&rsquo;ordinateur.
En choissisant <strong>Options avancée</strong> à l&rsquo;écran de GRUB, on peut choisir un noyau ou un mode de démarrage particulier.</p>
<p>Sur un système 100% Linux, on y retrouve par défaut des lignes correspondant aux différents noyaux installés sur le système (4 maximum par défaut).</p>
<p>Il est également possible d&rsquo;éditer la ligne de lancement sélectionnée afin de changer dynamiquement des options passées au noyau (voir plus loin).</p>
<h3 id="43-le-noyau-linux">4.3 Le noyau Linux<a class="headerlink" href="#43-le-noyau-linux" title="Permanent link"></a></h3>
<p>Le noyau (kernel) d&rsquo;un OS a pour but principal de mettre en relation le matériel (via le BIOS) et le système d&rsquo;exploitation. 
Le kernel est dit modulaire, car il est constitué de plusieurs fichiers.</p>
<h4 id="431-fichiers-du-noyau">4.3.1 Fichiers du noyau<a class="headerlink" href="#431-fichiers-du-noyau" title="Permanent link"></a></h4>
<p>Deux fichiers sont indispensables pour le démarrage minimum du système d&rsquo;exploitation Debian.</p>
<div class="highlight"><pre># ls -l /boot
  total 26717
  ‐rw‐r‐‐r‐‐ 1 root root 186589    févr. 19 10:05 config‐4.9.0‐8‐amd64
  drwxr‐xr‐x 5 root root 1024      avril 15 17:20 grub
  ‐rw‐r‐‐r‐‐ 1 root root 19607107  avril 15 17:20 initrd.img‐4.9.0‐8‐amd64
  drwx‐‐‐‐‐‐ 2 root root 12288     avril 15 15:32 lost+found
  ‐rw‐r‐‐r‐‐ 1 root root 3196808   févr. 19 10:05 System.map‐4.9.0‐8‐amd64
  ‐rw‐r‐‐r‐‐ 1 root root 4241184   févr. 19 10:05 vmlinuz‐4.9.0‐8‐amd64
</pre></div>

<ul>
<li><strong>vmlinuz‐4.9.0‐8‐amd64</strong> : fichier principal du noyau avec sa version dans le nom.</li>
<li><strong>initrd.img‐4.9.0‐8‐amd64</strong> : fichier secondaire généré à chaque mise à jour. Il contient la configuration spécifique au matériel et les options importantes du système d&rsquo;exploitation (ex. gestion du raid, chiffrement, pilote des systèmes de fichiers, etc.)</li>
</ul>
<p>Le noyau est donc en charge de gérer les différents systèmes de fichiers, le chiffrement logiciel, les pilotes de périphériques, et de lancer le gestionnaire de système <code>systemd</code>.</p>
<h4 id="432-relation-grubkernel">4.3.2 Relation GRUB/kernel<a class="headerlink" href="#432-relation-grubkernel" title="Permanent link"></a></h4>
<p>C&rsquo;est GRUB qui est chargé de lancer le noyau d&rsquo;un système. 
Les informations sont dans le fichier de lancement de GRUB (<code>/boot/grub/grub.cfg</code>) ou directement avec le menu GRUB en modifiant une ligne de lancement.</p>
<p><img alt="GRUB" src="../ressources/img/05-linux-sysadmin/ecran-grub.png" title="Ecran GRUB" /></p>
<h5 id="4321-constitution-de-la-ligne-de-lancement-du-noyau">4.3.2.1 Constitution de la ligne de lancement du noyau<a class="headerlink" href="#4321-constitution-de-la-ligne-de-lancement-du-noyau" title="Permanent link"></a></h5>
<p>La ligne dans laquelle il est possible d&rsquo;apporter des modifications est :</p>
<div class="highlight"><pre>linux /vmlinuz-4.9.0-8-amd64 <span class="nv">root</span><span class="o">=</span>/dev/mapper/debian--vg-root ro quiet
</pre></div>

<ul>
<li><code>/vmlinuz-4.9.0-8-amd64</code> : nom de l&rsquo;image noyau à charger</li>
<li><code>root=/dev/mapper/debian--vg-root</code> : déclaration du système de fichier contenant la racine du système d&rsquo;exploitation (<code>/</code>)</li>
<li><code>ro</code> : indique que la racine du système d&rsquo;exploitation sera montée en lecture seule. Il est important de ne pas changer ce paramètre (si l&rsquo;intégrité du système de fichier doit être vérifiée, celui-ci doit être en lecture seule).</li>
<li><code>quiet</code> : indique que le noyau se lancera de façon non verbeuse.</li>
</ul>
<p>Il est possible de modifier les options passés au kernel.</p>
<h3 id="44-le-gestionnaire-de-systeme-systemd">4.4 Le gestionnaire de système : systemd<a class="headerlink" href="#44-le-gestionnaire-de-systeme-systemd" title="Permanent link"></a></h3>
<p><strong>systemd</strong> remplace les scripts <em>System V</em> (5) (ou <strong>SysV</strong>) depuis Debian 8. C&rsquo;est le programme lancé par le noyau (PID 1). </p>
<p>Il est en charge de lancer tous les programmes suivants dans un ordre spécifique afin d&rsquo;obtenir un système opérationnel pour l&rsquo;utilisateur. Il est aussi en charge de mettre à disposition les différents systèmes de fichiers à travers les points de montage.</p>
<p>Le démarrage des programmes (service) est parallèle avec des dépendances inter-service. La gestion des services est matérialisée dans des fichiers spécifiques dans <code>/lib/systemd/system</code>. La constitution de ces fichiers ne sera pas abordée dans cet ouvrage.</p>
<p><strong>systemd</strong> sous Debian 10 est encore fourni avec une retro-compatibilité avec les services de type <strong>System V</strong>.</p>
<h4 id="441-la-notion-de-cible">4.4.1 La notion de cible<a class="headerlink" href="#441-la-notion-de-cible" title="Permanent link"></a></h4>
<p><strong>systemd</strong> utilise des <strong>cibles</strong> (<em>target</em>) pour savoir quelles sont les programmes à exécuter ou arrêter suivant l&rsquo;intérêt de la cible. Les cibles sont constituées de la référence des différents services pris en charge par la cible.</p>
<h5 id="4411-les-differentes-cibles">4.4.1.1 Les différentes cibles<a class="headerlink" href="#4411-les-differentes-cibles" title="Permanent link"></a></h5>
<ul>
<li><code>poweroff.target</code>   : cible permettant de stopper l&rsquo;OS.</li>
<li><code>rescue.target</code>     : cible permettant de passer en mode maintenance.</li>
<li><code>multi-user.target</code> : cible permettant de lancer l&rsquo;OS en mode console si le système possède une interface graphique installée.</li>
<li><code>graphical.target</code>  : cible permettant de lancer l&rsquo;OS en mode graphique si l&rsquo;OS a une GUI installée, sinon ça lancera l&rsquo;OS en mode console.</li>
<li><code>reboot.target</code>     : cible permettant de redémarrer l&rsquo;OS.</li>
</ul>
<h4 id="442-commandes-de-gestion-de-systemd">4.4.2 Commandes de gestion de systemd<a class="headerlink" href="#442-commandes-de-gestion-de-systemd" title="Permanent link"></a></h4>
<p><code>systemctl</code> est la commande principale de la gestion du <strong>systemd</strong>.</p>
<h5 id="4421-connaitre-la-cible-par-defaut">4.4.2.1 Connaître la cible par défaut<a class="headerlink" href="#4421-connaitre-la-cible-par-defaut" title="Permanent link"></a></h5>
<div class="highlight"><pre>root@debian:~# systemctl get-default
  graphical.target
</pre></div>

<h5 id="4422-lister-les-unites">4.4.2.2 Lister les unités<a class="headerlink" href="#4422-lister-les-unites" title="Permanent link"></a></h5>
<div class="highlight"><pre>root@debian:~# systemctl list-units
  UNIT                     LOAD     ACTIVE   SUB      DESCRIPTION
  networking.service       loaded   active   exited   Raise network interfaces
  NetworkManager.service   loaded   active   running  Network Manager
</pre></div>

<ul>
<li><code>--all</code> : permet de lister toutes les unités chargées mais inactives.</li>
</ul>
<div class="highlight"><pre># systemctl list-units --all
</pre></div>

<h5 id="4423-gestion-des-unites">4.4.2.3 Gestion des unités<a class="headerlink" href="#4423-gestion-des-unites" title="Permanent link"></a></h5>
<p>Plusieurs intéraction possibles avec les unités via la commande <code>systemctl</code>. On peut afficher le status, activer/désactiver, démarrer/stopper, recharger un service.</p>
<p><strong>Status</strong>:</p>
<div class="highlight"><pre>eni@debian:~$ systemctl status NetworkManager
  ● NetworkManager.service - Network Manager
       Loaded: loaded (/lib/systemd/system/NetworkManager.service; enabled; vendor preset: enabled)
       Active: active (running) since Tue 2022-02-22 08:52:28 CET; 13h ago
         Docs: man:NetworkManager(8)
     Main PID: 1154 (NetworkManager)
        Tasks: 3 (limit: 38330)
       Memory: 14.5M
          CPU: 17.007s
       CGroup: /system.slice/NetworkManager.service
               └─1154 /usr/sbin/NetworkManager --no-daemon
</pre></div>

<p>Executer la même commande en mode sudo/su permet d&rsquo;avoir beaucoup plus de détails.</p>
<p><strong>Activation/Désactivation</strong></p>
<div class="highlight"><pre>root@debian:~# systemctl disable bind9.service
  Synchronizing state of bind9.service with SysV service script with /lib/systemd/systemd‐sysv‐install.
  Executing: /lib/systemd/systemd‐sysv‐install disable bind9

root@debian:~# systemctl enable bind9.service
  Synchronizing state of bind9.service with SysV service script with /lib/systemd/systemd‐sysv‐install.
  Executing: /lib/systemd/systemd‐sysv‐install enable bind9
</pre></div>

<p><strong>Stopper/Lancer un ou plusieurs services</strong></p>
<div class="highlight"><pre># systemctl start bind9
# systemctl stop bind9
</pre></div>

<p>On peut lancer/stopper plusieurs services en même temps.</p>
<h5 id="4424-changer-de-cible">4.4.2.4 Changer de cible<a class="headerlink" href="#4424-changer-de-cible" title="Permanent link"></a></h5>
<p>Il est possible de changer de cible avec la commande :</p>
<div class="highlight"><pre># systemctl isolate maCible
</pre></div>

<h3 id="45-eteindre-redemarrer-le-systeme">4.5 Eteindre / Redémarrer le système<a class="headerlink" href="#45-eteindre-redemarrer-le-systeme" title="Permanent link"></a></h3>
<p>Même s&rsquo;il est possible d&rsquo;éteindre le système via la commande <code>systemctl isolate maCible</code> , il est fortement conseillé d&rsquo;utiliser la commande <code>shutdown</code> sur un serveur de prod.</p>
<p>En effet il sera possible de préciser une heure d&rsquo;extinction ou du redémarrage et d&rsquo;envoyer un message console aux utilisateurs connectés.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>shutdown [option] &lt;heure&gt; &lt;message&gt;
</pre></div>

<ul>
<li><code>-h</code> : arrêter le system (halt)</li>
<li><code>-r</code> : redémarrer (reboot)</li>
<li><code>-c</code> : annuler une commande <code>shutdown</code> (cancel)</li>
</ul>
<h2 id="5-mode-maintenance-au-demarrage">5. Mode Maintenance au démarrage<a class="headerlink" href="#5-mode-maintenance-au-demarrage" title="Permanent link"></a></h2>
<h3 id="51-methode-1-avec-grub">5.1 Méthode 1 avec GRUB<a class="headerlink" href="#51-methode-1-avec-grub" title="Permanent link"></a></h3>
<p>Lorsqu&rsquo;on a besoin d&rsquo;effectuer une maintenance sur un serveur, il est possible de modifier le menu GRUB au démarrage afin de lancer le noyau avec le commutateur <em>single</em>.</p>
<p><strong>ATTENTION cettte méthode ne peut pas fonctionner sur un système en mode sudo sans mot de passe activé pour le compte root</strong></p>
<p>Une fois le menu GRUB affiché, il suffit de sélectionner un kernel avec les touches <kbd>UP</kbd>/<kbd>DOWN</kbd>, puis d&rsquo;appuyer sur la touche <kbd>E</kbd> pour entrer dans le menu d&rsquo;édition.</p>
<p>Ensuite on modifiera la ligne de chargement du noyau de façon à remplacer <code>quiet</code> par <code>single</code> :</p>
<div class="highlight"><pre><span class="c1"># AVANT</span>
linux /vmlinuz-4.9.0-8-amd64 <span class="nv">root</span><span class="o">=</span>/dev/mapper/debian--vg-root ro quiet

<span class="c1"># APRES</span>
linux /vmlinuz-4.9.0-8-amd64 <span class="nv">root</span><span class="o">=</span>/dev/mapper/debian--vg-root ro single
</pre></div>

<p><strong>ATTENTION</strong> le clavier est alors en QWERTY.</p>
<p>Pour démarrer, il faut ensuite appuyer sur <kbd>CTRL-x</kbd></p>
<p>Pour sortir du module maintenance (<code>rescue.target</code>), il faudra taper la combinaison <kbd>CTRL-d</kbd>.</p>
<h3 id="52-methode-2-avec-grub">5.2 Méthode 2 avec GRUB<a class="headerlink" href="#52-methode-2-avec-grub" title="Permanent link"></a></h3>
<p>Cette méthode est plus brutale car elle demandera une extinction forcée électriquement du serveur. Mais elle peut être très pratique sur un serveur en mode sudo ou sur un serveur dont on ne connaît pas le mot de passe root.</p>
<p>Modifier la ligne du noyau dans GRUB :</p>
<div class="highlight"><pre><span class="c1"># AVANT</span>
linux /vmlinuz‐4.9.0‐8‐amd64 <span class="nv">root</span><span class="o">=</span>/dev/mapper/debian‐‐vg‐root ro quiet

<span class="c1"># APRES</span>
linux /vmlinuz‐4.9.0‐8‐amd64 <span class="nv">root</span><span class="o">=</span>/dev/mapper/debian‐‐vg‐root ro <span class="nv">init</span><span class="o">=</span>/bin/bash
</pre></div>

<p>Puis redémarrer avec <kbd>CTRL-x</kbd>.</p>
<p>Une fois redémarré, appuyer sur <kbd>ENTREE</kbd>. Attention le clavier sera en <strong>QWERTY</strong>.</p>
<p>Le système est redémarré mais le système de fichiers racine est en lecture seule, il faut lancer la commande suivante pour le basculer en lecture/écriture :</p>
<div class="highlight"><pre># mount -o remount,rw /
</pre></div>

<p>Puis faire les modifications nécessaires sur le système. </p>
<p>A la fin, il ne faut pas oublier de lancer une synchronisation du cache disque dur en RAM sur le disque via la commande </p>
<div class="highlight"><pre>sync
</pre></div>

<h3 id="53-methode-3-avec-media-dinstallation">5.3 Méthode 3 avec média d&rsquo;installation<a class="headerlink" href="#53-methode-3-avec-media-dinstallation" title="Permanent link"></a></h3>
<p>Il suffit de démarrer sur le média d&rsquo;installation et dans les options avancées, choisir <code>Rescue mode</code>.</p>
<p>Puis suivre les indications.</p>
<p><strong>Notes</strong>: l&rsquo;option <code>graphical rescue mode</code> ne présente aucun intérêt.</p>
<p><em>Voir &ldquo;TP3 Démarrage en mode maintenance&rdquo; et &ldquo;TP 4 Gestion du démarrage et des services&rdquo;</em></p>
<h2 id="6-gestion-basique-du-reseau">6. Gestion basique du réseau<a class="headerlink" href="#6-gestion-basique-du-reseau" title="Permanent link"></a></h2>
<h3 id="61-informations-generales">6.1 Informations générales<a class="headerlink" href="#61-informations-generales" title="Permanent link"></a></h3>
<p>Pour une mise en réseau des postes client et serveur, il faut que la couche IP soit correctement réalisé.</p>
<p>La configuration IP a généralement besoin d&rsquo;une adresse IP, d&rsquo;un masque réseau et potentiellement d&rsquo;une passerelle par défaut. Afin de pouvoir résoudre les noms d&rsquo;hôtes, il faudra aussi renseigner un ou des serveurs DNS.</p>
<h3 id="62-prise-dinformation-en-cli">6.2 Prise d&rsquo;information en cli<a class="headerlink" href="#62-prise-dinformation-en-cli" title="Permanent link"></a></h3>
<h4 id="621-connaitre-ses-ip-via-la-commande-ip">6.2.1 Connaître ses IP via la commande <code>ip</code><a class="headerlink" href="#621-connaitre-ses-ip-via-la-commande-ip" title="Permanent link"></a></h4>
<p>Via la commande <code>ip</code>.</p>
<ul>
<li><code>ip a</code> / <code>ip addr</code>  : adresses ip</li>
<li><code>ip r</code> / <code>ip route</code> : route (passerelle par défaut)</li>
<li><code>ip -c</code> : colorise l&rsquo;output</li>
<li><code>ip -br</code> : pour &ldquo;brief&rdquo;, imprime uniquement les iface, leur status et leur ip.</li>
</ul>
<p>ex. <code>$ ip -br -c a</code></p>
<div class="highlight"><pre>eni@debian:~<span class="nv">$ </span>ip a
  1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen 1
  link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
  inet 127.0.0.1/8 scope host lo
  valid_lft forever preferred_lft forever
  inet6 ::1/128 scope host
  valid_lft forever preferred_lft forever
  2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc pfifo_fast state UP group default qlen 1000
  link/ether 00:0c:29:3b:0f:4b brd ff:ff:ff:ff:ff:ff
  inet 10.6.6.6/16 brd 10.9.255.255 scope global dynamic ens33
  valid_lft 605264sec preferred_lft 605264sec
  inet6 fe80::20c:29ff:fe3b:f4b/64 scope link
  valid_lft forever preferred_lft forever
</pre></div>

<h4 id="622-connaitre-sa-route-par-defaut">6.2.2 Connaître sa route par défaut<a class="headerlink" href="#622-connaitre-sa-route-par-defaut" title="Permanent link"></a></h4>
<div class="highlight"><pre>eni@debian:~<span class="nv">$ </span>ip r
  default via 10.6.255.254 dev ens33 proto static metric 100
  10.6.0.0/16 dev ens33 proto kernel scope link src 10.9.50.16 metric 100
</pre></div>

<p>La passerelle par défaut est &ldquo;10.6.255.254&rdquo;, sur le réseau &ldquo;10.6.0.0/16&rdquo;</p>
<h4 id="623-connaitre-les-serveurs-dns">6.2.3 Connaître les serveurs DNS<a class="headerlink" href="#623-connaitre-les-serveurs-dns" title="Permanent link"></a></h4>
<p>Via le fichier /etc/resolv.conf.</p>
<div class="highlight"><pre>eni@debian:~<span class="nv">$ </span>cat /etc/resolv.conf
  search eni.local
  nameserver 10.6.0.66
</pre></div>

<p>Le serveur DNS est &ldquo;nameserver 10.6.0.66&rdquo;</p>
<h3 id="63-configuration-dun-systeme-sans-interface-graphique">6.3 Configuration d&rsquo;un système sans interface graphique<a class="headerlink" href="#63-configuration-dun-systeme-sans-interface-graphique" title="Permanent link"></a></h3>
<p>La configuration IP et DNS sur un système sans GUI se fait dans 2 fichiers de configuration.</p>
<p>Il est possible d&rsquo;avoir une configuration simplifiée via un serveur DHCP ou une configuration statique.</p>
<p>Les fichiers sont <code>/etc/network/interfaces</code> et <code>/etc/resolv.conf</code>.</p>
<p><strong>Notes</strong>:</p>
<ul>
<li>On peut modifier à la main puis sauver pour que les modifications s&rsquo;appliquent immédiatement sans avoir besoin de faire quoi que ce soit d&rsquo;autre.</li>
<li>Le nom d&rsquo;une interface réseau est défini en fonction du matériel, ex. enp5s0 (TITAN), ou ens33 (VM eni).</li>
</ul>
<h4 id="631-configuration-ip-en-dhcp">6.3.1 Configuration IP en DHCP<a class="headerlink" href="#631-configuration-ip-en-dhcp" title="Permanent link"></a></h4>
<p>L&rsquo;adressage IP en système DHCP se fait uniquement dans le fichier <code>/etc/network/interfaces</code> :</p>
<div class="highlight"><pre><span class="c1"># The loopback network interface</span>
auto lo
iface lo inet loopback

auto ens33
iface ens33 inet dhcp
</pre></div>

<ul>
<li><code>auto</code> / <code>allow hot-plug</code> : ?</li>
<li><code>iface</code>  : interface</li>
<li><code>inet</code>   : pour spécifier une IPv4.</li>
<li><code>inet6</code>  : pour une IPv6</li>
<li><code>dhcp</code>   : pour spécifier l&rsquo;ip d&rsquo;un serveur DHCP</li>
<li><code>static</code> : pour donner une ip statique</li>
</ul>
<h4 id="632-configuration-ip-en-adressage-static-et-dns-static">6.3.2 Configuration IP en adressage static et DNS static<a class="headerlink" href="#632-configuration-ip-en-adressage-static-et-dns-static" title="Permanent link"></a></h4>
<h5 id="6321-configuration-de-la-couche-ip-statique">6.3.2.1 Configuration de la couche IP statique<a class="headerlink" href="#6321-configuration-de-la-couche-ip-statique" title="Permanent link"></a></h5>
<p>La configuration se fait dans le fichier /etc/network/interfaces.</p>
<div class="highlight"><pre><span class="c1"># The loopback network interface</span>
auto lo
iface lo inet loopback

auto ens33
iface ens33 inet static
    address 10.6.6.6
    netmask 255.255.0.0
    gateway 10.6.255.254
</pre></div>

<h5 id="6322-configuration-du-dns-statique">6.3.2.2 Configuration du DNS statique<a class="headerlink" href="#6322-configuration-du-dns-statique" title="Permanent link"></a></h5>
<p>La configuration se fait dans le fichier /etc/resolv.conf</p>
<div class="highlight"><pre>nameserver 10.6.0.66
</pre></div>

<h4 id="633-prise-en-compte-des-modifications">6.3.3 Prise en compte des modifications<a class="headerlink" href="#633-prise-en-compte-des-modifications" title="Permanent link"></a></h4>
<p>Pour appliquer les modifications, redémarrer le service <code>networking.service</code> ou en redémarrant la machine.</p>
<div class="highlight"><pre># systemctl restart networking.service
</pre></div>

<p><strong>RAPPEL</strong></p>
<ul>
<li>Activation du service : <code>sudo systemctl enable networking.service</code></li>
<li>Démarrage du service :  <code>sudo systemctl start  networking.service</code></li>
<li>le service peut être <code>failed</code>. Auquel cas il faut mieux redémarrer la machine.</li>
</ul>
<h3 id="64-configuration-dun-systeme-dexploitation">6.4 Configuration d&rsquo;un système d&rsquo;exploitation<a class="headerlink" href="#64-configuration-dun-systeme-dexploitation" title="Permanent link"></a></h3>
<p>La configuration d&rsquo;un poste graphique se fait par un outil graphique. Il est fortement déconseillé d&rsquo;utiliser le fichier de configuration du service <code>networking</code>. En effet, c&rsquo;est un autre service qui gère la couche IP, le service <code>NetworkManager</code>. Il est toutefois possible de configurer <code>NetworkManager</code> via deux outils en ligne de commande : <code>nmtui</code> et <code>nmcli</code>.</p>
<ul>
<li><code>nmtui</code> : interface UI dans terminal (type BIOS) pour régler l&rsquo;interface réseau</li>
<li><code>nmcli</code> : invite de commande pour régler l&rsquo;interface réseau</li>
</ul>
<p><img alt="nmtui" src="../ressources/img/05-linux-sysadmin/nmtui.png" title="nmtui" /></p>
<p><img alt="nmcli" src="../ressources/img/05-linux-sysadmin/nmcli.png" title="nmcli" /></p>
<p>Après une configuration, il est possible de relancer graphiquement le service ou via <code>systemctl</code>.</p>
<div class="highlight"><pre># systemctl restart NetworkManager
</pre></div>

<p><em>Voir &ldquo;TP5 Gestion de la configuration réseau d&rsquo;un poste&rdquo;</em></p>
<h2 id="7-gestion-des-paquets">7. Gestion des paquets<a class="headerlink" href="#7-gestion-des-paquets" title="Permanent link"></a></h2>
<p>La distribution Debian contient plus de 50.000 paquets, maintenus par un millier de développeurs. Les longues périodes de tests justifient la réputation de stabilité de Debian. En revanche il arrive que des paquets arrivent en phase stable, alors qu&rsquo;ils sont considérés comme désuets pour d&rsquo;autres distributions.</p>
<h3 id="71-les-releases">7.1 Les Releases<a class="headerlink" href="#71-les-releases" title="Permanent link"></a></h3>
<p>Une release est une version publiée par Debian, quelle soit stable ou non.</p>
<p>Il y a 4 types de <em>releases</em> :</p>
<p><strong>Experimental</strong></p>
<p>Elle ne contient pas tous les paquets constituant une release complète. Elle contient des paquets de logiciels en cours de développement, et pouvant par conséquent dégrader le système. Elle est utilisée principalement par les developpeurs souhaitant avoir un premier retour d&rsquo;utilisateurs (expérimentés, courageux ou inconscients).</p>
<p><strong>Unstable</strong></p>
<p>Toujours nommée <strong>Sid</strong>, elle est en constante évolution, alimentée par de nouveaux paquets ou par les mises à jour des paquets existants. C&rsquo;est une <strong>rolling release</strong>. 
Le paquet d&rsquo;origine est créé par son mainteneur sur une architecture standard et les <strong>autobuilders</strong> vont compiler automatiquement le paquet pour les autres architectures.</p>
<p><strong>Testing</strong></p>
<p>Les paquets qui ne rencontrent pas de bug graves sur les différentes architectures, et après une période de quarantaine en version <strong>Sid</strong>, seront éligibles pour la version Testing. La version Testing est donc un prolongement de Unstable, mais elle minimise les risques de problèmes bloquants. L&rsquo;entrée en Testing se fait automatiquement depuis Unstable et sous condition d&rsquo;éligibilité.</p>
<p><strong>Stable</strong></p>
<p>C&rsquo;est une version figée, seules les mises à jour de sécurité sont acceptées. Les paquets qui entrent dans la version Stable sont considérés exempts de bugs (bien que ce ne soit pas toujours le cas). La promotion en version Stable est réalisée sous la responsabilité du &ldquo;<em>Release Manager</em>&rdquo;.</p>
<h3 id="72-gestion-des-depots">7.2 Gestion des dépôts<a class="headerlink" href="#72-gestion-des-depots" title="Permanent link"></a></h3>
<p>Les paquets logiciels, ainsi que leurs sources, sont disponibles sur Internet dans des dépots (<em>repositories</em>).</p>
<p>Les repos permettent de mettre à jour le système ou installer de nouveaux paquets. </p>
<p>On peut également installer un paquet indépendamment d&rsquo;un repo, mais l&rsquo;ajout d&rsquo;un repo contenant ce logiciel présente certains avantages :
- <strong>Mise à jour</strong> : la MàJ est automatiquement prise en charge
- <strong>Gestion des dépendances</strong> : si l&rsquo;installation requiert des biblio non standard, celle-ci seront incluses dans le dépôt et automatiquement installées.</p>
<h4 id="721-le-fichier-sourceslist">7.2.1 Le fichier sources.list<a class="headerlink" href="#721-le-fichier-sourceslist" title="Permanent link"></a></h4>
<p>Le fichier <code>/etc/apt/sources.list</code> contient la configuration du dépôt. Voir aussi le dossier <code>/etc/apt/sources.list.d/</code> pour y mettre des repo spécifiques. </p>
<div class="highlight"><pre>eni@debian:~<span class="nv">$ </span>cat /etc/apt/sources.list
  deb http://ftp.fr.debian.org/debian/ bullseye main
  deb‐src http://ftp.fr.debian.org/debian/ bullseye main

  deb http://security.debian.org/ bullseye/updates main
  deb‐src http://security.debian.org/ bullseye/updates main

  <span class="c1"># squeeze‐updates, previously known as &#39;volatile&#39;</span>
  deb http://ftp.fr.debian.org/debian/ bullseye‐updates main
  deb‐src http://ftp.fr.debian.org/debian/ bullseye‐updates main
</pre></div>

<p><strong>Moi</strong>:</p>
<div class="highlight"><pre>eni@debian:~<span class="nv">$ </span>cat /etc/apt/sources.list
  <span class="c1"># See https://wiki.debian.org/SourcesList for more information.</span>
  deb http://deb.debian.org/debian bullseye main non-free contrib
  deb-src http://deb.debian.org/debian bullseye main non-free contrib

  deb http://deb.debian.org/debian bullseye-updates main non-free contrib
  deb-src http://deb.debian.org/debian bullseye-updates main non-free contrib

  deb http://security.debian.org/debian-security/ bullseye-security main non-free contrib
  deb-src http://security.debian.org/debian-security/ bullseye-security main non-free contrib
</pre></div>

<p>Le premier champ indique le <strong>type de paquet</strong> : 
  + <code>deb</code> : paquet binaire
  + <code>deb-src</code> : paquet source</p>
<p>Seuls les paquets binaires sont utilisés en production, les paquets sources permettant d&rsquo;obtenir les fichiers sources afin de vérifier ou modifier le logiciel.</p>
<p>L&rsquo;ordre des lignes est important, les premiers dépôts trouvés étant utilisés prioritairement.</p>
<p>Le deuxième champ indique le <strong>chemin de base de la source</strong>
  + <code>http://</code> : url de téléchargement
  + <code>ftp://</code> : site FTP de téléchargement
  + <code>file://</code> : répertoire local
  + <code>cdrom:[...]</code> : suivi entre crochet du label du CD, indique une source type CD/DVD</p>
<p>Et aussi : <code>copy</code>, <code>rsh</code>, <code>ssh</code>.</p>
<p>Le troisième champ spécifie la <strong>branche disponible</strong>. Celle-ci permet de connaître la version des paquets à installer. Une branche peut être :
- <strong>oldstable</strong>    : l&rsquo;ancienne version stable
- <strong>stable</strong>       : la version officielle actuelle
- <strong>bullseye</strong>     : une version spécifique
- <strong>testing</strong>      : la prochaine version stable
- <strong>unstable</strong>     : c&rsquo;est la version qui porte toujours le nom de Sid
- <strong>experimental</strong> : il est préférable de la laisser aux développeurs
- <strong>autres</strong>&hellip;    : la version correspond en fait à un répertoire dans l&rsquo;arborescence, il est possible d&rsquo;en créer à l&rsquo;envie lorsqu&rsquo;on gère son propre dépôt.</p>
<p>Le quatrième champ et les suivants indique la <strong>section</strong>, dont l&rsquo;objectif est de filtrer les paquets à installer :
- <code>main</code>     : paquets Debian standard, tous libres
- <code>contrib</code>  : paquets libres avec dépendances propriétaires
- <code>non-free</code> : paquets propriétaires, sous licence non-libre</p>
<h3 id="73-gestion-courante-des-paquets">7.3 Gestion courante des paquets<a class="headerlink" href="#73-gestion-courante-des-paquets" title="Permanent link"></a></h3>
<ul>
<li>Les <strong>opérations de gestion de base</strong> sur les systèmes Debian sont réalisées en cli à l&rsquo;aide de 2 outils différents : <code>apt-get</code> / <code>apt-cache</code> ou <code>apt</code>.</li>
<li>Les <strong>opérations de recherche et de consultation</strong> pourront être réalisées avec un compte d&rsquo;utilisateur standard.</li>
<li>
<p>Les <strong>opérations altérant le système</strong> seront réalisées avec les privilèges du compte <strong>root</strong>.</p>
</li>
<li>
<p>La commande <code>apt</code> est plus récente et gère mieux la désinstallation des dépendances en cas de retrait d&rsquo;un paquet. </p>
</li>
<li>La commande <code>apt-get</code> est plus ancienne et sans doute plus utilisée. </li>
</ul>
<p>Il est recommandé de <strong>toujours utiliser la même méthode</strong>, car les solveurs de paquets sont différents entre ces commandes.</p>
<h4 id="731-les-commandes-courantes-de-gestion">7.3.1 Les commandes courantes de gestion<a class="headerlink" href="#731-les-commandes-courantes-de-gestion" title="Permanent link"></a></h4>
<p>Afin de faciliter l&rsquo;utilisation de ces commandes, le paquet <code>bash-completion</code> fournit une aide efficace grâce à l&rsquo;autocomplétion des commandes de gestion des paquets, de leurs options et de la base des paquets disponibles et/ou installés.</p>
<p><strong>Mettre à jour la base de données des paquets disponibles</strong> sur les dépôts :</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo apt update
<span class="nv">$ </span>sudo apt-get update
</pre></div>

<p><strong>Appliquer les mises à jour</strong></p>
<div class="highlight"><pre># apt upgrade
# apt-get upgrade
</pre></div>

<p><strong>Appliquer les mises à jour, en supprimant éventuellement d&rsquo;autres paquets</strong></p>
<div class="highlight"><pre># apt full-upgrade
# apt-get dist-upgrade
</pre></div>

<p><strong>Installer un paquet</strong></p>
<div class="highlight"><pre># apt install foo
# apt-get install foo
</pre></div>

<p><strong>Désinstaller un paquet, en laissant les fichiers de configuration</strong></p>
<div class="highlight"><pre># apt remove foo
# apt-get remove foo
</pre></div>

<p><strong>Désinstaller un paquet, en supprimant les fichiers de configuration</strong></p>
<div class="highlight"><pre># apt purge foo
# apt-get purge foo
</pre></div>

<p><strong>Nettoyer le dépôt local des fichiers téléchargés</strong> suite aux màj et autres installations</p>
<div class="highlight"><pre># apt clean
# apt-get clean
</pre></div>

<p><strong>Chercher un paquet qui correspond à une expression rationnelle</strong></p>
<div class="highlight"><pre># apt search lightning
# apt-cache search lightning
</pre></div>

<p><strong>Obtenir des informations détaillées sur un paquet</strong></p>
<div class="highlight"><pre># apt show paquet
# apt-cache show paquet
</pre></div>

<p>Il existe un autre pacman nommé <strong>aptitude</strong> qui n&rsquo;est pas installé par défaut. 
Historiquement, il est plus récent que apt-* et plus vieux que apt.</p>
<h5 id="notes-sur-desinstallation-via-apt-stackoverflow">Notes sur désinstallation via apt (StackOverflow)<a class="headerlink" href="#notes-sur-desinstallation-via-apt-stackoverflow" title="Permanent link"></a></h5>
<p><code>apt-get remove packagename</code></p>
<p>will remove the binaries, but not the configuration or data files of the package packagename. It will also leave dependencies installed with it on installation time untouched.</p>
<p><code>apt-get purge packagename</code> or <code>apt-get remove --purge packagename</code></p>
<p>will remove about everything regarding the package packagename, but not the dependencies installed with it on installation. Both commands are equivalent.</p>
<p>Particularly useful when you want to &lsquo;start all over&rsquo; with an application because you messed up the configuration. However, it does not remove configuration or data files residing in users home directories, usually in hidden folders there. There is no easy way to get those removed as well.</p>
<p><code>apt-get autoremove</code></p>
<p>removes orphaned packages, i.e. installed packages that used to be installed as an dependency, but aren&rsquo;t any longer. Use this after removing a package which had installed dependencies you&rsquo;re no longer interested in.</p>
<p><code>aptitude remove packagename</code> or <code>aptitude purge packagename</code> (likewise)</p>
<p>will also attempt to remove other packages which were required by packagename on but are not required by any remaining packages. Note that aptitude only remembers dependency information for packages that it has installed.</p>
<p>And many more exist. Lower-level dpkg-commands can be used (advanced), or GUI tools like Muon, Synaptic, Software Center, etc. There&rsquo;s no single &lsquo;correct way&rsquo; of removing applications or performing other tasks interacting with your package management.</p>
<p>The list you found are just examples. Make sure you understand the meanings and try out what it wants to do before accepting the action (you need to press Y before it actually performs the actions as proposed).</p>
<p>The asterisk version in the question is probably wrong; apt-get accepts a regular expression and not a glob pattern as the shell. So what happens with</p>
<div class="highlight"><pre>sudo apt-get remove application*
</pre></div>

<p>is the following:</p>
<ol>
<li>
<p>The shell tries to expand application* looking at the files in the current directory. If (as is normally the case) it finds nothing, it returns the glob pattern unaltered (supposing bash with default behavior here &mdash; zsh will error out).</p>
</li>
<li>
<p>apt-get will remove the packages whose name contains a string that satisfies the regular expression application*, that is, applicatio followed by an arbitrary number of n: applicatio, application, applicationn, libapplicatio, etc.</p>
</li>
<li>
<p>To see how this can be dangerous, try (without root for double safety) apt-get -s remove &ldquo;wine*&rdquo; (-s will simulate the thing instead of doing it) &mdash; it will say is going to remove all packages that has &ldquo;win&rdquo; in their name and the dependant, almost the entire system&hellip;</p>
</li>
</ol>
<p>Probably, the command that was meant is really</p>
<div class="highlight"><pre>sudo apt-get remove &quot;^application.*&quot;
</pre></div>

<p>(note the quotes and the dot) which will remove all packages whose name starts with application.</p>
<p>These commands,</p>
<div class="highlight"><pre>sudo updatedb                  # &lt;-- updates the locate database (index). harmless
sudo locate application        # &lt;-- locates the file &#39;application&#39;. harmless
sudo rm -rf (file/folder name) # &lt;-- removes files/dirs recursively. dangerous.
</pre></div>

<p>are completely outside the scope of the package management. Do not remove files belonging to packages without using the package manager! It will get confused and is the wrong way to do things.</p>
<p>If you don&rsquo;t know to which package a file belongs, try this:</p>
<div class="highlight"><pre>dpkg -S /path/to/file
</pre></div>

<h4 id="732-la-commande-dpkg">7.3.2 La commande dpkg<a class="headerlink" href="#732-la-commande-dpkg" title="Permanent link"></a></h4>
<p><strong>dpkg</strong> est la base du système de gestion des paquets Debian. Il est l&rsquo;équivalent de la commande rpm pour RedHat. </p>
<p>Il a été conçu pour :</p>
<ul>
<li>installer / mettre à jour des paquets Debian</li>
<li>supprimer des paquets </li>
<li>fournir des informations</li>
</ul>
<p>Il n&rsquo;était pas question, à l&rsquo;epoque de sa création en 1993, de télécharger des fichiers sur internet. C&rsquo;est pourquoi <code>dpkg</code> ne gère pas les dépendances, on l&rsquo;utilise donc rarement aujourd&rsquo;hui pour l&rsquo;installation des paquets.</p>
<p>En revanche, il permet d&rsquo;obtenir des informations précieuses sur les paquets ou les fichiers installés à partir de paquets.</p>
<p><strong>Lister les paquets disponibles dans les dépôts et contenant la chaîne &ldquo;ftp&rdquo;.</strong></p>
<pre>eni@debian:~$ sudo dpkg -l "*ftp*"
  Desired=Unknown/Install/Remove/Purge/Hold
  | Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
  |/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
  ||/ Name                Version      Architecture Description
  +++-===================-============-============-===========================================================================
  ii  openssh-sftp-server 1:8.4p1-5    amd64        secure shell (SSH) sftp server module, for SFTP access from remote machines
  un  php-ftp             &lt;none&gt;       &lt;none&gt;       (no description available)
  un  php7.3-ftp          &lt;none&gt;       &lt;none&gt;       (no description available)
  un  php7.4-ftp          &lt;none&gt;       &lt;none&gt;       (no description available)
  un  sftp                &lt;none&gt;       &lt;none&gt;       (no description available)
  un  webmin-proftpd      &lt;none&gt;       &lt;none&gt;       (no description available)
  un  webmin-wuftpd       &lt;none&gt;       &lt;none&gt;       (no description available)
</pre>

<p>Noter les préfixes indiquant le souhait et l&rsquo;état du paquet.</p>
<p><strong>Lister les fichiers installés par un paquet (installé) :</strong></p>
<div class="highlight"><pre># dpkg -L ftp
</pre></div>

<p><strong>Lister le paquet à l&rsquo;origine d&rsquo;un fichier :</strong></p>
<div class="highlight"><pre># dpkg ‐S /sbin/ip
iproute2: /sbin/ip
</pre></div>

<h4 id="733-les-fichiers-journaux">7.3.3 Les fichiers journaux<a class="headerlink" href="#733-les-fichiers-journaux" title="Permanent link"></a></h4>
<p>Les fichiers journaux permettent de consulter l&rsquo;historique des installations et mises à jour. Chaque utilitaire dispose de son propre fichier de logs :</p>
<ul>
<li><code>apt-get</code> : fichier <code>/var/log/apt/history.log</code></li>
<li><code>apt</code>     : fichier <code>/var/log/apt/history.log</code></li>
<li><code>dpkg</code>    : fichier <code>/var/log/dpkg.log</code></li>
</ul>
<p>Les commandes <code>apt-get</code> et <code>apt</code> s&rsquo;appuient sur <code>dpkg</code> pour l&rsquo;installation proprement dite, on doit donc retrouver dans les logs de <code>dpkg</code> toutes les interventions réalisées sur les paquets.</p>
<h3 id="74-installation-a-partir-des-sources">7.4 Installation à partir des sources<a class="headerlink" href="#74-installation-a-partir-des-sources" title="Permanent link"></a></h3>
<p>Technique avancée qui varie selon le type de source récupéré. Il y a tout de même un cheminement qui reste le même :</p>
<p><strong>L&rsquo;environnement de compilation</strong></p>
<p>Il est important de faire un espace de compilation spécifique à un utilisateur qui n&rsquo;est pas root afin d&rsquo;éviter des problématiques systèmes et sa sécurisation.</p>
<p><strong>La lecture de la documentation</strong></p>
<p>La documentation est généralement disponible sous un fichier README ou INSTALL. Celui-ci contient généralement les autres étapes de la construction de l&rsquo;application, avec la liste des dépendances de construction de fonctionnement.</p>
<p><strong>Préparation de la compilation</strong></p>
<p>Cette étape va vérifier s&rsquo;il y a toutes les dépendances de compilation sur le système puis générer un fichier <code>MakeFile</code> contenant toutes les informations de compilation et d&rsquo;installation.</p>
<div class="highlight"><pre><span class="nv">$ </span>./configure
</pre></div>

<p><strong>Compilation</strong></p>
<p>Cette étape va permettre de créer l&rsquo;application compilée à partir de ses sources en se basant sur le fichier <code>MakeFile</code> contenant toutes les informations de compilation.</p>
<div class="highlight"><pre><span class="nv">$ </span>make
</pre></div>

<p>A l&rsquo;issue de cette étape, l&rsquo;application n&rsquo;est toujours pas installée dans le système mais elle est <strong>totalement fonctionnelle</strong>.</p>
<p><strong>Installation</strong></p>
<p>C&rsquo;est la seule étape à réaliser avec les privilèges root car cette étape est une simple copie de l&rsquo;application dans les répertoires système comme <code>/opt/bin</code> par exemple.</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo make install
</pre></div>

<p><em>Voir TP 6 - Gestion des installations logicielles</em></p>
<p><a href="#05-linux-sysadmin">Retour en haut</a></p>
<h2 id="8-gestion-des-espaces-de-stockage">8. Gestion des espaces de stockage<a class="headerlink" href="#8-gestion-des-espaces-de-stockage" title="Permanent link"></a></h2>
<h3 id="81-partitionner-un-disque">8.1 Partitionner un disque<a class="headerlink" href="#81-partitionner-un-disque" title="Permanent link"></a></h3>
<p>Sous Linux, un disque dur est représenté par un périphérique de type bloc. Afin de mieux comprendre comment Linux présentera ce périphérique et ses sous-divisions, il est primordiale de comprendre le partitionnement.</p>
<h4 id="811-la-norme-intel-du-mbr">8.1.1 La norme Intel du MBR<a class="headerlink" href="#811-la-norme-intel-du-mbr" title="Permanent link"></a></h4>
<p>Créée en 1983, la norme Intel indique que les 512 premiers octets d&rsquo;un disque dur sont utilisés pour l&rsquo;amorçage du système.</p>
<p>Le <strong>MBR</strong> (<strong>Master Boot Record</strong>) est constitué de 2 principaux éléments :</p>
<ul>
<li>le boot loader : 446 premiers octets. Celui-ci contient le stage 1 de GRUB.</li>
<li>la table de partition : 64 octets, contient la position des 4 <strong>partitions primaires</strong>.</li>
</ul>
<p>Du fait de ne pouvoir avoir l&rsquo;information que de 4 partitions dans la table de partition, la norme Intel MBR a choisi de donner la possibilité d&rsquo;avoir un type particulier de partition principale : la <strong>partition étendue</strong>.</p>
<p>La partition étendue pourra stocker les informations de 56 <strong>partitions logiques</strong></p>
<p>La plus grosse problématique du MBR est la taille limite des partitions fixée au maximum à 2.2To</p>
<h4 id="812-la-norme-intel-gpt">8.1.2 La norme Intel GPT<a class="headerlink" href="#812-la-norme-intel-gpt" title="Permanent link"></a></h4>
<p>Créée en 2013 le <strong>GPT</strong> (<strong>GUID Partition Table</strong>) est le remplaçant du MBR.</p>
<ul>
<li>Nombre maximum de partitions : 128 (voire 256)</li>
<li>Limite théorique des partitions et des disques : 9.4 Zo (Zeta octets)</li>
</ul>
<h4 id="813-nommage-des-partitions-sous-linux">8.1.3 Nommage des partitions sous Linux<a class="headerlink" href="#813-nommage-des-partitions-sous-linux" title="Permanent link"></a></h4>
<h5 id="8131-nommage-des-disques">8.1.3.1 Nommage des disques<a class="headerlink" href="#8131-nommage-des-disques" title="Permanent link"></a></h5>
<p>Sous Linux, les disques de type SCSI/SATA sont matérialisés dans le répertoire <code>/dev</code> suivi de <code>sd</code> puis la lettre correspondant au disque, dans l&rsquo;ordre de détection.</p>
<p>Ex. <code>/dev/sda</code> sera le premier disque détecté, puis <code>/dev/sdb</code>, etc.</p>
<p>Cela correspond au disque en entier. Pour manipuler des partitions, il faudra ajouter le numéro de la partition, ex. <code>/dev/sda2</code>.</p>
<h5 id="8132-nommage-des-partitions">8.1.3.2 Nommage des partitions<a class="headerlink" href="#8132-nommage-des-partitions" title="Permanent link"></a></h5>
<p>Linux ne nomme pas les partitions à la suite. Il va réserver les chiffres de 1 à 4 pour les partitions principales (principale et étendue).</p>
<p>Quel que soit le nombre de partitions principales, s&rsquo;il y a une partition étendue alors les partitions logiques commenceront quoi qu&rsquo;il arrive à 5.</p>
<p><strong>Exemple</strong>:</p>
<p>Le 2e disque du système est partitionné avec 2 partitions principales et une partition étendue contenant 3 partitions logiques. Linux présentera tout cela de cette façon :</p>
<ul>
<li><code>/dev/sdb</code>       disque entier</li>
<li><code>/dev/sdb1</code>    1e partition principale</li>
<li><code>/dev/sdb2</code>    2e partition principale</li>
<li><code>/dev/sdb3</code>    partition étendue<ul>
<li><code>/dev/sdb5</code>    1e partition logique</li>
<li><code>/dev/sdb6</code>    2e partition logique</li>
<li><code>/dev/sdb7</code>    3e partition logique</li>
</ul>
</li>
</ul>
<p><strong>Notes</strong>:</p>
<ul>
<li>A logical partition (LPAR) is a subset of a computer&rsquo;s hardware resources, virtualized as a separate computer.</li>
<li>A primary partition contains one file system.</li>
<li>
<p>An HDD may contain only one extended partition, but that extended partition can be subdivided into multiple logical partitions. GPT only has the primary partition, doesn&rsquo;t have the extended partition and the logical partition. </p>
</li>
<li>
<p>Partition primaire : un disque contient un max de 4 partitions primaire (le MBR est contenu sur le premier secteur du disque n&rsquo;a que 4 emplacements pour stocker des adresses de partitions)</p>
</li>
<li>Partition étendue : si on veut plus de 4 partitions, une des partitions sera alors remplacer par une partition étendue qui se divisera en partition logiques (aka partitions secondaires).</li>
<li>Partition logiques : partitions supplémentaires quand le nombre de partitions dépasse 4. La quatrième partition s&rsquo;appelle alors la partition étendue et contiendra les partitions supplémentaire (partitions logiques)</li>
</ul>
<p><img alt="partitions" src="../ressources/img/05-linux-sysadmin/partitions.png" title="Partitionnement" /></p>
<h4 id="814-outils-de-partitionnement">8.1.4 Outils de partitionnement<a class="headerlink" href="#814-outils-de-partitionnement" title="Permanent link"></a></h4>
<p>Il existe plusieurs outils console ou graphique pour la gestion des partitions. </p>
<p>Les plus courants : <code>parted</code>, <code>gparted</code>, <code>fdisk</code>, <code>sfdisk</code>, <code>cfdisk</code>, etc.</p>
<h5 id="8141-fdisk">8.1.4.1 fdisk<a class="headerlink" href="#8141-fdisk" title="Permanent link"></a></h5>
<p><strong>Syntaxe</strong> :</p>
<div class="highlight"><pre>fdisk [option] &lt;periph de stockage&gt;
</pre></div>

<h6 id="81411-prise-dinformation">8.1.4.1.1 Prise d&rsquo;information<a class="headerlink" href="#81411-prise-dinformation" title="Permanent link"></a></h6>
<p><strong>Afficher la table de partition du périphérique</strong> :</p>
<div class="highlight"><pre>root@debian:~# fdisk ‐l /dev/sda
  Disque /dev/sda : 20 GiB, 21474836480 octets, 41943040 secteurs
  Unités : secteur de 1 × 512 = 512 octets
  Taille de secteur (logique / physique) : 512 octets / 512 octets
  taille d&#39;E/S (minimale / optimale) : 512 octets / 512 octets
  Type d&#39;étiquette de disque : dos
  Identifiant de disque : 0x732e6aa1

  Périphérique Amorçage Début  Fin      Secteurs Taille Id Type
  /dev/sda1    *          2048   499711   497664   243M 83 Linux
  /dev/sda2             501758 41940991 41439234  19,8G  5 Étendue
  /dev/sda5             501760 41940991 41439232  19,8G 8e LVM Linux
</pre></div>

<h6 id="81412-partitionnement">8.1.4.1.2 Partitionnement<a class="headerlink" href="#81412-partitionnement" title="Permanent link"></a></h6>
<p>L&rsquo;utilisation de <code>fdisk</code> est basique mais efficace. Il faut connaître les étapes importantes mises à disposition parmi toutes les options disponibles.</p>
<div class="highlight"><pre>root@debian:~# fdisk /dev/sdb

  Welcome to fdisk (util-linux 2.36.1).
  Changes will remain in memory only, until you decide to write them.
  Be careful before using the write command.


  Command (m for help): m

  Help:

    GPT
     M   enter protective/hybrid MBR

    Generic
     d   delete a partition
     F   list free unpartitioned space
     l   list known partition types
     n   add a new partition
     p   print the partition table
     t   change a partition type
     v   verify the partition table
     i   print information about a partition

    Misc
     m   print this menu
     x   extra functionality (experts only)

    Script
     I   load disk layout from sfdisk script file
     O   dump disk layout to sfdisk script file

    Save &amp; Exit
     w   write table to disk and exit
     q   quit without saving changes

    Create a new label
     g   create a new empty GPT partition table
     G   create a new empty SGI (IRIX) partition table
     o   create a new empty DOS partition table
     s   create a new empty Sun partition table
</pre></div>

<p><strong>Création d&rsquo;une partition avec fdisk</strong></p>
<ol>
<li>Lors de la création d&rsquo;une partition <code>fdisk</code> propose de créer une partition primaire ou étendue </li>
<li>Si une partition étendue a déjà été créée, fdisk proposera une partition logique, </li>
<li>puis son numéro (conseil: laisser faire le système), </li>
<li>le bloc de début (laisser faire le système) </li>
<li>et la taille de la partition, en bloc par défaut mais il est possible de préciser une taille à ajouter avec <code>+&lt;int&gt;&lt;unité&gt;</code> (ex. <code>+20G</code>)</li>
</ol>
<div class="highlight"><pre>Commande (m pour l&#39;aide) : n
Type de partition
  p primaire (0 primaire, 0 étendue, 4 libre)
  e étendue (conteneur pour partitions logiques)
Sélectionnez (p par défaut) : p
Numéro de partition (1‐4, 1 par défaut) :
Premier secteur (2048‐62914559, 2048 par défaut) :
Dernier secteur, +secteurs ou +taille{K,M,G,T,P} (2048‐62914559, 62914559 par défaut) : +20G
</pre></div>

<p>Une nouvelle partition 1 de type &ldquo;Linux&rdquo; et de taille 20 GiB a été créée.</p>
<div class="highlight"><pre>Commande (m pour l&#39;aide) : p
Disque /dev/sdb : 30 GiB, 32212254720 octets, 62914560 secteurs
Unités : secteur de 1 × 512 = 512 octets
Taille de secteur (logique / physique) : 512 octets / 512 octets
taille d&#39;E/S (minimale / optimale) : 512 octets / 512 octets
Type d&#39;étiquette de disque : dos
Identifiant de disque : 0x0ab85bf5

Périphérique Amorçage    Début      Fin Secteurs Taille Id Type
/dev/sdb1                 2048 41945087 41943040    20G 83 Linux
</pre></div>

<p>Une fois les partitions créées, il ne faut pas oublier de définir le type de partition via la commande <code>t</code>.</p>
<p><strong>Liste des types de partitions connus par fdisk</strong></p>
<p><em>Pour voir la liste des types de partitions connus : <code>Commande (m pour l'aide) : l</code></em></p>
<p>Les plus notables :
- 7 HPFS/NTFS/exFAT
- W95 FAT32
- 82 partition d&rsquo;ech (swap ?)
- 83 Linux
- 8e LVM Linux
- fd RAID Linux auto</p>
<p>Déclarer le type de partition est utile pour savoir quel type de système de fichier sera installé sur la partition.</p>
<p>Une fois les créations de partitions effectuées, l&rsquo;enregistrement des modifications se fait via la commande <code>w</code>.</p>
<div class="highlight"><pre>Commande (m pour l&#39;aide) : w
La table de partitions a été altérée.
Appel d&#39;ioctl() pour relire la table de partitions.
Synchronisation des disques.
</pre></div>

<h3 id="82-lvm-logical-volume-manager">8.2 LVM Logical Volume Manager<a class="headerlink" href="#82-lvm-logical-volume-manager" title="Permanent link"></a></h3>
<p>La gestion de volumes logiques apporte une souplesse dans la gestion des espaces de stockage. Le partitionnement traditionnel est problématique lorsqu&rsquo;on souhaite agrandir un système de fichier.</p>
<p>L&rsquo;agrandissement d&rsquo;une partition est obligatoirement fait à froid et peut se faire uniquement avec un espace contigu à la partition à agrandir. Ce qui peut poser un problème de souplesse en production.</p>
<p>Le LVM permet de s&rsquo;affranchir des limites physiques des périphériques. LVM implémente une couche logique pour une gestion plus souple et plus évolutive des volumes de stockage.</p>
<p>On gère plusieurs types d&rsquo;éléments :
- Les volumes physiques (PV) : désignent les périphériques intégrés dans LVM
- Les groupes de volumes (VG) : permettent de regrouper les volumes physiques
- Les volumes logiques (LV) : désignent les unités définies au sein des groupes de volumes</p>
<p>La création d&rsquo;un ou plusieurs groupes de volumes sera faites à partir des volumes physiques disponibles. 
Les groupes de volumes seront ensuite découpés en volumes logiques. Ces volumes logiques pourront alors être utilisés comme n&rsquo;importe quel volume de stockage.</p>
<p>Les commandes de gestion s&rsquo;organisent autour de ces dénominations et respectent toujours la même logique. Pour la création, on aura par exemple :</p>
<ul>
<li><code>pvcreate</code> : création des volumes physiques</li>
<li><code>vgcreate</code> : création des groupes de volumes</li>
<li><code>lvcreate</code> : création des volumes logiques</li>
</ul>
<p>Il en sera de même pour toutes les autres directives : <strong>display</strong>, <strong>extend</strong>, <strong>reduce</strong>, <strong>remove</strong>, etc.</p>
<h4 id="821-pre-requis">8.2.1 Pré-requis<a class="headerlink" href="#821-pre-requis" title="Permanent link"></a></h4>
<p>Définir l&rsquo;identifiant des partitions à utiliser avec <code>fdisk</code>, utiliser l&rsquo;id <strong>8e</strong> pour <strong>Linux LVM</strong>.</p>
<div class="highlight"><pre>Device Boot  Start  End  Blocks    Id  System
/dev/sdb1    1      486  3903763+  8e  Linux LVM
</pre></div>

<h4 id="822-creer-des-partitions-lvm">8.2.2 Créer des partitions LVM<a class="headerlink" href="#822-creer-des-partitions-lvm" title="Permanent link"></a></h4>
<p><strong>Créer des volumes physiques</strong></p>
<div class="highlight"><pre># pvcreate /dev/sdb1 /dev/sdb2 /dev/sdb3
</pre></div>

<p>Il est possible de créer un PV de tout un disque. Il faut préalablement effacer les 512 premiers octets.</p>
<p><strong>Créer des groupes de volumes</strong></p>
<div class="highlight"><pre># vgcreate vggroup1 /dev/sdb1
</pre></div>

<p><strong>Créer des volumes logiques</strong></p>
<div class="highlight"><pre># lvcreate -n lv1 -L 150M vggroup1
</pre></div>

<ul>
<li><code>-n NOM_DU_VOLUME</code> : nom du volume</li>
<li><code>-L TAILLE_AVEC_UNITES</code> : taille avec [K|M|G|T|E]  (KO, MO, GO, TO, EO)</li>
</ul>
<p>Il y aura 2 chemins possibles pour manipuler le volume logique :</p>
<ul>
<li>directement dans <code>/dev/&lt;vg&gt;/&lt;lv&gt;</code></li>
<li>ou dans <code>/dev/mapper/&lt;vg&gt;-&lt;lv&gt;</code></li>
</ul>
<h4 id="823-ajouter-agrandir-diminuer-une-partition-lvm">8.2.3 Ajouter, agrandir, diminuer une partition LVM<a class="headerlink" href="#823-ajouter-agrandir-diminuer-une-partition-lvm" title="Permanent link"></a></h4>
<h6 id="ajouter-des-volumes-physiques-au-groupe-de-volume">Ajouter des volumes physiques au groupe de volume<a class="headerlink" href="#ajouter-des-volumes-physiques-au-groupe-de-volume" title="Permanent link"></a></h6>
<div class="highlight"><pre># vgextend vggroup1 /dev/sdb2 /dev/sdb3
</pre></div>

<h6 id="agrandir-un-volume-logique">Agrandir un volume logique<a class="headerlink" href="#agrandir-un-volume-logique" title="Permanent link"></a></h6>
<div class="highlight"><pre># lvextend ‐L +400M /dev/vggroup1/lv1     # ajoute 400M au volume
# lvextend ‐L 1G /dev/vggroup1/lv1        # fixe à 1 Go la taille du volume
# lvdisplay ‐m /dev/vggroup1/lv1          # affiche les volumes occupés
</pre></div>

<p>De la même façon, <code>lvreduce</code> permet de réduire la taille d&rsquo;un volume logique.</p>
<p>Attention le système de fichier ne prendra pas en compte automatiquement ces changements. Il faudra forcer un redimensionnement  pour pouvoir utiliser tout l&rsquo;espace. </p>
<h6 id="redimensionner-le-systeme-de-fichier-de-type-ext">Redimensionner le système de fichier de type ext<a class="headerlink" href="#redimensionner-le-systeme-de-fichier-de-type-ext" title="Permanent link"></a></h6>
<div class="highlight"><pre># resize2fs -fp /dev/vggroup1/lvl
</pre></div>

<ul>
<li><code>-f</code> : force (permet de passer outre <code>fsck</code>)</li>
<li><code>-p</code> : affiche l&rsquo;avancement (progress)</li>
</ul>
<p>Un démontage préalable du volume peut être nécessaire selon le type de système de fichier.</p>
<h4 id="824-afficher-les-informations-lvm">8.2.4 Afficher les informations LVM<a class="headerlink" href="#824-afficher-les-informations-lvm" title="Permanent link"></a></h4>
<p>Plusieurs commandes sont disponibles pour obtenir des informations sur les volumes LVM configurés :</p>
<ul>
<li>infos résumées avec &ldquo;vs&rdquo; : <code>pvs</code>, <code>vgs</code>, <code>lvs</code></li>
<li>infos détaillées avec &ldquo;display&rdquo; : <code>pvdisplay</code>, <code>vgdisplay</code>, <code>lvdisplay</code></li>
</ul>
<p><strong>Afficher les infos résumées sur tous les groupes de volumes</strong> :</p>
<div class="highlight"><pre>root@debian:~# vgs
  VG        #PV #LV #SN Attr         VSize   VFree
  vggroup1  1       5      0 wz‐‐n‐  15,76g  0
</pre></div>

<p><strong>Afficher les informations détaillées sur tous les groupes de volumes</strong></p>
<div class="highlight"><pre># vgdisplay
</pre></div>

<p><strong>Afficher les informations résumées sur tous les LV du groupe de volumes vggroup1</strong></p>
<div class="highlight"><pre># lvs /dev/vggroup1
</pre></div>

<p><strong>Afficher les informations détaillées du volume lv1 du groupe de volumes vggroup1</strong></p>
<div class="highlight"><pre># lvdisplay /dev/vggroup1/lv1
</pre></div>

<p>Toutes les commandes LVM sont également disponibles dans un <strong>shell dédié</strong> accessible via la commande <code>lvm</code>.</p>
<h3 id="83-gestion-des-systemes-de-fichiers">8.3 Gestion des systèmes de fichiers<a class="headerlink" href="#83-gestion-des-systemes-de-fichiers" title="Permanent link"></a></h3>
<h4 id="831-considerations-generales">8.3.1 Considérations générales<a class="headerlink" href="#831-considerations-generales" title="Permanent link"></a></h4>
<p>Tous les systèmes de fichiers de type Unix sont basés sur le même principe et les mêmes éléments élémentaires. 
Les systèmes de fichiers Unix sont ségmentés en blocs de données, actuellement à 4 Ko par défaut. 
Chaque bloc pourra avoir différentes structures.</p>
<ul>
<li>superbloc               : bloc contenant les infos vitales du système de fichier</li>
<li>inode                   : bloc contenant les inodes contenant les infos d&rsquo;un fichier</li>
<li>bloc d&rsquo;indirection      : bloc redirigeant vers d&rsquo;autres blocs (cf. plus loin dans ce chapitre)</li>
<li>bloc de données         : bloc contenant les données réelles du fichier</li>
<li>table des inodes        : bloc contenant la liste des blocs d&rsquo;inodes</li>
<li>table des inodes libres : bloc contenant la liste des inodes libres</li>
<li>table des bloc libres   : bloc contenant la liste des blocs de données libres</li>
</ul>
<h5 id="8311-le-superbloc">8.3.1.1 Le superbloc<a class="headerlink" href="#8311-le-superbloc" title="Permanent link"></a></h5>
<p>Le superbloc contient les infos vitales du filesystem. Donc par mesure de sécurité, il est dupliqué à différents endroits du FS. </p>
<p>Il contient les infos suivantes :</p>
<ul>
<li>taille des blocs</li>
<li>taille du FS</li>
<li>nombre de montage effectués </li>
<li>nombre maximum de montage avant vérification</li>
<li>date du dernier montage</li>
<li>intervalle maximum entre deux montages avant vérification</li>
<li>un pointeur vers l&rsquo;inode racine du système de fichiers (FS)</li>
</ul>
<h5 id="8312-inodes-et-blocs-dindirection">8.3.1.2 Inodes et blocs d&rsquo;indirection<a class="headerlink" href="#8312-inodes-et-blocs-dindirection" title="Permanent link"></a></h5>
<p>Les inodes sont regroupés par blocs dans un système de fichiers. 
La taille d&rsquo;un inode est de 128 octets. Avec des blocs de 4 Ko, il y aura 32 inodes par bloc d&rsquo;inodes.</p>
<p>Un inode contient des infos propres au fichier qu&rsquo;il représente:</p>
<ul>
<li>type de fichier : voir tableau (-, d, l, etc.)</li>
<li>mode ou droit d&rsquo;accès : en octal, ex. 0644 pour <code>rw-r--r--</code></li>
<li>nombre de liens physique : si la valeur tombe à zéro, le fichier est considéré comme supprimé</li>
<li>UID : User ID du propriétaire (user)</li>
<li>GID : Group ID propriétaire (group)</li>
<li>taille du fichier : en octets</li>
<li>champs dates : <code>atime</code> (dernier accès au fichier), <code>ctime</code> (dernier changement des infos de l&rsquo;inode), <code>mtime</code> (dernier changement des données réelle du fichier)</li>
<li>15 adresses pointant vers les blocs de données réelles du fichier</li>
</ul>
<p><strong>IMPORTANT</strong> : l&rsquo;inode ne possède pas le nom du fichier, celui-ci est renseigné dans le <em>répertoire contenant ce fichier</em> .</p>
<p>Type de fichiers :</p>
<table>
<thead>
<tr>
<th align="center">code</th>
<th align="left">type</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">-</td>
<td align="left">standard (file)</td>
</tr>
<tr>
<td align="center">d</td>
<td align="left">directory</td>
</tr>
<tr>
<td align="center">l</td>
<td align="left">lien symbolique</td>
</tr>
<tr>
<td align="center">b</td>
<td align="left">fichier spécial mode block</td>
</tr>
<tr>
<td align="center">c</td>
<td align="left">fichier spécial mode caractère</td>
</tr>
<tr>
<td align="center">n</td>
<td align="left">fichier spécial mode réseau (node)</td>
</tr>
<tr>
<td align="center">p</td>
<td align="left">named pipe</td>
</tr>
</tbody>
</table>
<h4 id="832-systeme-de-fichier-ext">8.3.2 Système de fichier EXT<a class="headerlink" href="#832-systeme-de-fichier-ext" title="Permanent link"></a></h4>
<p>L&rsquo;ext2, l&rsquo;ext3 et l&rsquo;ext4 sont implémentés sur Debian.</p>
<p>La différence entre ext2 et ext3 est la journalisation, améliorant la récupération du système de fichier en cas de crash (extinction brutale du PC par ex.)</p>
<p>Le système de fichier ext4 est une amélioration de l&rsquo;ext3 mais réécrit de zéro.</p>
<h5 id="8321-lext4">8.3.2.1 L&rsquo;EXT4<a class="headerlink" href="#8321-lext4" title="Permanent link"></a></h5>
<p>C&rsquo;est le FS par défaut depuis Debian 9. Son avantage est qu&rsquo;il est peu sujet à la fragmentation grâce à la préallocation des blocs de données contigus.</p>
<p><strong>Caractéristiques</strong> :</p>
<ul>
<li>taille maximale de fichier : 16 Tio (avec des blocs de 4 Ko)</li>
<li>nombre maximal de fichiers : 4 milliards</li>
<li>taille maximale du nom de fichiers : 255 octets</li>
<li>taille maximale de volume : 1 Eio (limité à 16 Tio par e2fsprogs avec des blocs de 4 Ko)</li>
</ul>
<h4 id="833-les-autres-systemes-de-fichiers-sous-debian">8.3.3 Les autres systèmes de fichiers sous Debian<a class="headerlink" href="#833-les-autres-systemes-de-fichiers-sous-debian" title="Permanent link"></a></h4>
<p>Il y a d&rsquo;autres systèmes de fichiers gérés nativement sous Debian, entre autres : NTFS, FAT.</p>
<p>Il est possible d&rsquo;installer d&rsquo;autres outils de gestion de systèmes de fichiers comme XFS, Btrfs, etc.</p>
<h4 id="834-outils-de-gestion-des-systemes-de-fichiers">8.3.4 Outils de gestion des systèmes de fichiers<a class="headerlink" href="#834-outils-de-gestion-des-systemes-de-fichiers" title="Permanent link"></a></h4>
<h5 id="8341-creation-mkfs">8.3.4.1 Création (mkfs)<a class="headerlink" href="#8341-creation-mkfs" title="Permanent link"></a></h5>
<p>Le <strong>formatage</strong> va installer un système de fichiers sur un périphérique de stockage. Sans un FS, le périphérique de stockage est inutilisable.
Un périphérique de stockage peut être une partition (par ex. <code>/dev/sdb1</code>) ou un volume logique (par ex. <code>/dev/vgta/line</code> ou <code>/dev/mapper/vgta-rien</code>).</p>
<p><strong>Syntaxe</strong> :</p>
<div class="highlight"><pre>mkfs.[FSTYPE] OPTIONS PERIPH_STOCKAGE
</pre></div>

<p><strong>mkfs.[fstype]</strong> est une commande simplifiant la mémorisation des commandes de création de système de fichier. C&rsquo;est en fait une fausse commande qui fait appel à la vraie commande de création. </p>
<p>Ex. <code>mkfs.ext4</code> est la commande <code>mke2fs</code> avec des options préconfigurées pour générer de l&rsquo;ext4</p>
<p><strong>Exemple</strong></p>
<div class="highlight"><pre>root@deb-desktop:~# mkfs.ext4 -h
  mkfs.ext4: invalid option -- &#39;h&#39;
  Usage: mkfs.ext4 [-c|-l filename] [-b block-size] [-C cluster-size]
          [-i bytes-per-inode] [-I inode-size] [-J journal-options]
          [-G flex-group-size] [-N number-of-inodes] [-d root-directory]
          [-m reserved-blocks-percentage] [-o creator-os]
          [-g blocks-per-group] [-L volume-label] [-M last-mounted-directory]
          [-O feature[,...]] [-r fs-revision] [-E extended-option[,...]]
          [-t fs-type] [-T usage-type ] [-U UUID] [-e errors_behavior][-z undo_file]
          [-jnqvDFSV] device [blocks-count]

root@deb-desktop:~# mkfs.ext4 -L VAR /dev/root/var
  mke2fs 1.46.2 (28-Feb-2021)
  Creating filesystem with 5242880 4k blocks and 1310720 inodes
  Filesystem UUID: 7647c2e1-1e58-4008-befb-7958e19dc124
  Superblock backups stored on blocks: 
          32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
          4096000

  Allocating group tables: done                            
  Writing inode tables: done                            
  Creating journal (32768 blocks): done
  Writing superblocks and filesystem accounting information: done   
</pre></div>

<h5 id="8342-modification">8.3.4.2 Modification<a class="headerlink" href="#8342-modification" title="Permanent link"></a></h5>
<h6 id="tune2fs">tune2fs<a class="headerlink" href="#tune2fs" title="Permanent link"></a></h6>
<p><strong>tune2fs</strong> permet de modifier des options d&rsquo;un système de fichier type ext. Il permet aussi de récupérer les informations du superbloc.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>tune2fs OPTIONS PERIPH_STOCKAGE
</pre></div>

<p><strong>Options usuelles</strong> :</p>
<ul>
<li><code>-L</code> permet de modifier l&rsquo;étiquette du FS (label) </li>
<li><code>-l</code> permet d&rsquo;afficher les infos du superbloc </li>
<li><code>-i</code> permet de modifier l&rsquo;intervalle entre deux vérifications </li>
<li><code>-c</code> permet de modifier le nombre maximum de montage déclenchant une vérification</li>
</ul>
<h6 id="resize2fs">resize2fs<a class="headerlink" href="#resize2fs" title="Permanent link"></a></h6>
<p><strong>resize2fs</strong> permet de changer la taille d&rsquo;un système de fichiers.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>resize2fs OPTION PERIPH_STOCKAGE
</pre></div>

<h5 id="8343-verification-fsck">8.3.4.3 Vérification (fsck)<a class="headerlink" href="#8343-verification-fsck" title="Permanent link"></a></h5>
<p>La vérification d&rsquo;un système de fichiers permet de contrôler l&rsquo;intégralité des données présentes sur celui-ci. 
Il est possible de le faire manuellement tout comme il possible de l&rsquo;automatiser au démarrage.</p>
<div class="highlight"><pre>fsck.FSTYPE OPTIONS PERIPH_STOCKAGE
</pre></div>

<p>Comme pour les commandes de formatage, la vérification peut facilement se faire avec les commandes <code>fsck.FSTYPE</code>.</p>
<h5 id="8344-prise-dinformation">8.3.4.4 Prise d&rsquo;information<a class="headerlink" href="#8344-prise-dinformation" title="Permanent link"></a></h5>
<p>Il est parfois utile de trouver les infos type, etiquette et UUID d&rsquo;un système de fichiers.</p>
<h6 id="blkid">blkid<a class="headerlink" href="#blkid" title="Permanent link"></a></h6>
<p>La commande <strong>blkid</strong> permet d&rsquo;afficher les infos relatives à un périphérique particulier. 
Sans argument, elle affichera les info relatives à tous les périphériques formatés.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>blkid OPTION PERIPH_STOCKAGE
</pre></div>

<div class="highlight"><pre>root@debian:~# blkid /dev/sdb1
  /dev/sdb1: UUID=&quot;42237738‐92a8‐4ddf‐9326‐293152e8eed7&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;4dced6bd‐01&quot;

root@debian:~# blkid
  /dev/sda1: UUID=&quot;32a0cf22‐91d5‐4082‐9b69‐548810a16c45&quot; TYPE=&quot;ext2&quot; PARTUUID=&quot;732e6aa1‐01&quot;
  /dev/sda5: UUID=&quot;VDfsmc‐gci2‐BOct‐IlVv‐rfcR‐R5IA‐ozNO8x&quot; TYPE=&quot;LVM2_member&quot; PARTUUID=&quot;732e6aa1‐05&quot;
  /dev/sr0: UUID=&quot;2019‐02‐16‐12‐34‐06‐00&quot; LABEL=&quot;Debian 9.8.0 amd64 1&quot; TYPE=&quot;iso9660&quot; PTUUID=&quot;49506c1e&quot; PTTYPE=&quot;dos&quot;
  /dev/mapper/debian‐‐vg‐root: UUID=&quot;bffe9183‐34a3‐49d4‐b1a4‐a97bac0e95fc&quot; TYPE=&quot;ext4&quot;
  /dev/mapper/debian‐‐vg‐swap_1: UUID=&quot;d5d6cc72‐10f5‐48e4‐bd60‐3b46fd5385bb&quot; TYPE=&quot;swap&quot;
  /dev/sdb1: UUID=&quot;42237738‐92a8‐4ddf‐9326‐293152e8eed7&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;4dced6bd‐01&quot;
</pre></div>

<h6 id="lsblk">lsblk<a class="headerlink" href="#lsblk" title="Permanent link"></a></h6>
<p>La commande <strong>lsblk</strong> permet d&rsquo;afficher sous forme arborescente les infos relatives aux périphériques et aux systèmes de fichiers.</p>
<p><img alt="lsblk" src="../ressources/img/05-linux-sysadmin/lsblk.png" title="lsblk" /></p>
<p><em>Voir TP 7 - Gestion des espaces disque</em></p>
<p><a href="#05-linux-sysadmin">Retour en haut</a></p>
<h3 id="84-montage-dun-systeme-de-fichiers">8.4 Montage d&rsquo;un système de fichiers<a class="headerlink" href="#84-montage-dun-systeme-de-fichiers" title="Permanent link"></a></h3>
<p>Sous un OS Linux, comme tout est fichier, la mise à disposition d&rsquo;un système de fichier venant d&rsquo;un espace de stockage (partition, LVM, RAID, etc.) se fera en définissant un répertoire comme point de montage.</p>
<p>Le simple fait de rendre un répertoire comme point de montage, fait que tous les fichiers et repertoires présents dans ce répertoire ne seront plus accessibles. Il est donc fortement conseillé de prendre un répertoire vide comme futur point de montage.</p>
<p>Pour un montage temporaire, il est conseillé d&rsquo;utiliser le répertoire <code>/mnt</code>. S&rsquo;il faut monter plusieurs FS de façon temporaire, il est possible de créer des sous-dossiers dans <code>/mnt</code> pour chacun des FS.</p>
<h4 id="841-prise-dinfos-sur-le-systeme-de-fichiers-avec-blkid">8.4.1 Prise d&rsquo;infos sur le système de fichiers avec blkid<a class="headerlink" href="#841-prise-dinfos-sur-le-systeme-de-fichiers-avec-blkid" title="Permanent link"></a></h4>
<p>Afin de monter un système de fichier (FS), il est utile de bien connaître le type de FS présent sur un périphérique et avoir plusieurs informations complémentaires comme son étiquette ou son UUID (unique ID).</p>
<p>La commande <strong>blkid</strong> permet de trouver des infos sur les périphériques, telles que l&rsquo;UUID, le type, le label (si existe) d&rsquo;un système de fichier.</p>
<div class="highlight"><pre>root@debian:~# blkid
  /dev/sda1: UUID=&quot;32a0cf22‐91d5‐4082‐9b69‐548810a16c45&quot; TYPE=&quot;ext2&quot; PARTUUID=&quot;732e6aa1‐01&quot;
  /dev/sda5: UUID=&quot;VDfsmc‐gci2‐BOct‐IlVv‐rfcR‐R5IA‐ozNO8x&quot; TYPE=&quot;LVM2_member&quot; PARTUUID=&quot;732e6aa1‐05&quot;
  /dev/sr0: UUID=&quot;2019‐02‐16‐12‐34‐06‐00&quot; LABEL=&quot;Debian 9.8.0 amd64 1&quot; TYPE=&quot;iso9660&quot; PTUUID=&quot;49506c1e&quot; PTTYPE=&quot;dos&quot;
  /dev/mapper/debian‐‐vg‐root: UUID=&quot;bffe9183‐34a3‐49d4‐b1a4‐a97bac0e95fc&quot; TYPE=&quot;ext4&quot;
  /dev/mapper/debian‐‐vg‐swap_1: UUID=&quot;d5d6cc72‐10f5‐48e4‐bd60‐3b46fd5385bb&quot; TYPE=&quot;swap&quot;
  /dev/sdb1: UUID=&quot;42237738‐92a8‐4ddf‐9326‐293152e8eed7&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;4dced6bd‐01&quot;

root@debian:~# blkid /dev/sdb1
  /dev/sdb1: UUID=&quot;42237738‐92a8‐4ddf‐9326‐293152e8eed7&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;4dced6bd‐01&quot;
</pre></div>

<h4 id="842-montage-manuel-avec-mount">8.4.2 Montage manuel avec mount<a class="headerlink" href="#842-montage-manuel-avec-mount" title="Permanent link"></a></h4>
<p>La commande <strong>mount</strong> permet de mettre à disposition un système de fichiers dans un répertoire.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>mount OPTION /dev/periph/source /point/de/montage
</pre></div>

<p><strong>Options possibles</strong>:</p>
<ul>
<li><code>-t FSTYPE</code> : détermine le type de système de fichiers à monter</li>
<li><code>-o OPTION</code> : permet de définir différentes options séparées par une virgule</li>
<li><code>sync</code> | <code>async</code>  : active ou non l&rsquo;utilisation de la mise en tampon en RAM des données avant écriture dans le système de fichiers. Défaut : <code>async</code></li>
<li><code>exec</code> | <code>noexec</code> : permet d&rsquo;exécuter ou non les fichiers executables présents sur le FS. Défaut : <code>exec</code></li>
<li><code>ro</code> | <code>rw</code>       : monte le FS en lecture seule (ro) ou en lecture/ecriture (rw). Défaut : <code>rw</code></li>
<li><code>suid</code> | <code>nosuid</code> : permet d&rsquo;exécuter ou non les binaires avec l&rsquo;interprétation du SUID positionné dessus. Défaut : <code>suid</code></li>
<li><code>remount</code>         : permet de changer une ou des options de montage sans démonter le système de fichiers.</li>
</ul>
<p><strong>Exemple</strong>:</p>
<div class="highlight"><pre># mount -t ext4 /dev/sdb1 /mnt
</pre></div>

<h4 id="843-prise-dinformation-des-points-de-montage">8.4.3 Prise d&rsquo;information des points de montage<a class="headerlink" href="#843-prise-dinformation-des-points-de-montage" title="Permanent link"></a></h4>
<p>Les commandes <strong>mont</strong> et <strong>findmnt</strong> permettent d&rsquo;afficher des informations sur les différents pour des montages.</p>
<h5 id="8431-mount">8.4.3.1 mount<a class="headerlink" href="#8431-mount" title="Permanent link"></a></h5>
<p>La sortie de <strong>mount</strong> est faiblement lisible mais permet de savoir facilement les options de montage appliquées.</p>
<p><img alt="mount" src="../ressources/img/05-linux-sysadmin/mount-output.png" title="mount output" /></p>
<h5 id="8432-findmnt">8.4.3.2 findmnt<a class="headerlink" href="#8432-findmnt" title="Permanent link"></a></h5>
<p>Cette commande permet une meilleure lisibilité et surtout de prendre l&rsquo;information sur un seul point de montage.</p>
<p><img alt="findmnt" src="../ressources/img/05-linux-sysadmin/findmnt-output.png" /></p>
<p>Pour voir l&rsquo;information sur un seul point de montage, il suffit de cibler :</p>
<div class="highlight"><pre>root@debian:~# findmnt /mnt
  TARGET SOURCE     FSTYPE  OPTIONS
  /mnt   /dev/sdb1  ext4    rw,relatime,data=ordered
</pre></div>

<h3 id="85-montage-automatique-fstab">8.5 Montage automatique (fstab)<a class="headerlink" href="#85-montage-automatique-fstab" title="Permanent link"></a></h3>
<p>Les montages automatiques sont effectués par systemd au tout début du démarrage du système d&rsquo;exploitation. La déclaration des montages automatiques est présentes dans le fichier <code>/etc/fstab</code>.</p>
<div class="highlight"><pre><span class="c1"># /etc/fstab: static file system information. </span>
<span class="c1"># </span>
<span class="c1"># Use &#39;blkid&#39; to print the universally unique identifier for a </span>
<span class="c1"># device; this may be used with UUID= as a more robust way to name devices </span>
<span class="c1"># that works even if disks are added and removed. See fstab(5). </span>
<span class="c1"># </span>
<span class="c1"># systemd generates mount units based on this file, see systemd.mount(5). </span>
<span class="c1"># Please run &#39;systemctl daemon-reload&#39; after making changes here. </span>
<span class="c1"># </span>
<span class="c1"># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt; </span>
/dev/mapper/root-racine /               ext4    <span class="nv">errors</span><span class="o">=</span>remount-ro <span class="m">0</span>       <span class="m">1</span> 
/dev/mapper/root-home /home           ext4    defaults        <span class="m">0</span>       <span class="m">2</span> 
/dev/mapper/root-windows /windows        vfat    utf8            <span class="m">0</span>       <span class="m">0</span> 
/dev/mapper/root-swap none            swap    sw              <span class="m">0</span>       <span class="m">0</span> 
/dev/sr0        /media/cdrom0   udf,iso9660 user,noauto     <span class="m">0</span>       0
</pre></div>

<p><strong><file system></strong> </p>
<p>Cette colonne déclare le système à monter. Cette source peut être exprimée de plusieurs façons :</p>
<ul>
<li>via un <strong>UUID</strong> : plus sécurisé mais humainement moins lisible</li>
<li>via un <strong>label</strong> : humainement plus lisible mais peut poser problème en cas de doublons</li>
<li>via le <strong>chemin du périphérique</strong> : on l&rsquo;utilise principalement pour les LVM car il n&rsquo;est pas possible d&rsquo;avoir plusieurs volumes LVM avec le même nom sur un système. Il est <strong>fortement déconseillé</strong> de l&rsquo;utiliser pour des partitions (ex. <code>/dev/sdb1</code>)</li>
</ul>
<p><strong><mount point></strong></p>
<p>Cette colonne déclare le répertoire de montage du système de fichiers.</p>
<p><strong><type></strong></p>
<p>Cette colonne déclare le type de FS. Il est possible de mettre <code>auto</code> mais cela ralentit le montage des périphériques.</p>
<p><strong><options></strong></p>
<p>Cette colonne déclare les options de montage. Il est possible de mettre <code>defaults</code>. Les options dans <code>defaults</code> sont <code>async</code>, <code>nouser</code>, <code>rw</code>, <code>auto</code>, <code>suid</code>, <code>dev</code></p>
<p><strong><dump></strong></p>
<p>Cette colonne est très peu utilisée. Elle correspond à des paramètres de configuration de la commande <code>dump</code>.</p>
<p><strong><pass></strong></p>
<p>Cette section permet de savoir si le système doit analyser l&rsquo;intégrité du FS afin de corriger les problèmes avant de le monter.<br></p>
<ul>
<li>si pass = 0 : pas de vérification</li>
<li>si pass &gt; 0 : analysera le système de fichiers (1 pour la racine, 2 pour les autres)</li>
</ul>
<p>Afin de se garantir de la bonne intégration d&rsquo;une nouvelle ligne dans le fichier <code>/etc/fstab</code>, il est important de la tester avant le redémarrage du poste. Le moyen le plus simple est d&rsquo;utiliser la commande <code>mount</code> en ne précisant que le point de montage.</p>
<div class="highlight"><pre>root@debian:~# mount /srv/data
  mount: impossible de trouver /srv/data dans /etc/fstab
</pre></div>

<p>Dans le cas où une ligne indique <code>/srv/data</code> dans le fichier fstab alors le montage se fera par rapport aux différentes déclarations.</p>
<p>Si la commande ne renvoie rien, c&rsquo;est que le montage s&rsquo;est correctement effectué.</p>
<p>Même si la littérature mentionne souvent l&rsquo;utilisation de la commande <code>mount -a</code> pour tester son fichier <code>/etc/fstab</code>, il est <strong>fortement déconseillé</strong> de l&rsquo;utiliser car celle-ci tente de monter toutes les entrées du fichier, et pas uniquement la nouvelle ligne à tester.</p>
<h3 id="86-commandes-informatives-utiles">8.6 Commandes informatives utiles<a class="headerlink" href="#86-commandes-informatives-utiles" title="Permanent link"></a></h3>
<h4 id="861-information-sur-les-systemes-de-fichiers-montes-df">8.6.1 Information sur les systèmes de fichiers montés (df)<a class="headerlink" href="#861-information-sur-les-systemes-de-fichiers-montes-df" title="Permanent link"></a></h4>
<p><strong>df</strong></p>
<p>La commande <strong>df</strong> permet de prendre des informations sur les systèmes de fichiers montés.</p>
<p><strong>Syntaxe</strong></p>
<div class="highlight"><pre>df OPTIONS /point/de/montage
</pre></div>

<p><strong>Options usuelles</strong></p>
<ul>
<li><code>-h</code> : affiche les tailles en puissance de 1024 (K, M, G, &hellip;)</li>
<li><code>-i</code> : affiche les informations sur les inodes</li>
</ul>
<p><strong>Exemple</strong></p>
<div class="highlight"><pre>root@debian:~# df ‐h
  Sys. de fichiers          Taille Utilisé Dispo Uti% Monté sur
  udev                        982M       0  982M   0% /dev
  tmpfs                       199M     22M  178M  11% /run
  /dev/mapper/debian‐‐vg‐root  18G    4,3G   13G  26% /
  tmpfs                       994M       0  994M   0% /dev/shm
  tmpfs                       5,0M    4,0K  5,0M   1% /run/lock
  tmpfs                       994M       0  994M   0% /sys/fs/cgroup
  /dev/sda1                   236M     37M  187M  17% /boot
  tmpfs                       199M     32K  199M   1% /run/user/115
  tmpfs                       199M     32K  199M   1% /run/user/1000
  /dev/sr0                    3,4G    3,4G     0 100% /media/cdrom0
  /dev/sdb1                    20G     45M   19G   1% /mnt
</pre></div>

<h4 id="862-information-sur-lespace-utilise-par-les-repertoires-du">8.6.2 Information sur l&rsquo;espace utilisé par les répertoires (du)<a class="headerlink" href="#862-information-sur-lespace-utilise-par-les-repertoires-du" title="Permanent link"></a></h4>
<p>La commande <code>ls -l</code> ne permet pas de connaître la taille d&rsquo;un répertore. En effet, elle remonte juste la taille utilisée par l&rsquo;inode du répertoire et non son contenu.</p>
<p>La commande <code>du</code> est la commande utilisée pour connaître la taille d&rsquo;un répertoire.</p>
<p><strong>Syntaxe</strong></p>
<div class="highlight"><pre>du OPTION /chemin/du/dossier
</pre></div>

<p><strong>Options usuelles</strong></p>
<ul>
<li><code>-h</code> : affiche les tailles en puissance de 1024 (K, M, G, &hellip;)</li>
<li><code>-s</code> : n&rsquo;affiche pas les sous-répertoires mais uniquement le répertoire en argument.</li>
</ul>
<p><strong>Exemple</strong></p>
<div class="highlight"><pre>root@debian:~# du -hs /etc
  6.9M    /etc
</pre></div>

<p><em>Voir TP 8 - Gestion des systèmes de fichiers et montage</em></p>
<p><a href="#05-linux-sysadmin">Retour en haut</a></p>
<h2 id="9-gestion-des-utilisateurs-et-des-groupes">9. Gestion des utilisateurs et des groupes<a class="headerlink" href="#9-gestion-des-utilisateurs-et-des-groupes" title="Permanent link"></a></h2>
<p>Sous Linux, les utilisateurs sont représentés par deux valeurs importantes : l&rsquo;UID (User ID) et le GID (Group ID - id du groupe principal).</p>
<p>Mais il est possible d&rsquo;un utilisateur appartienne à plusieurs groupes. Il y aura donc les notions de groupe principal et de groupe secondaire. Le groupe principal étant le groupe attribué à l&rsquo;utilisateur au moment de sa connexion.</p>
<p>Il existe 3 type d&rsquo;utilisateurs</p>
<ul>
<li>
<p><strong>root: UID=0, GID=0</strong><br>
C&rsquo;est l&rsquo;administrateur du système. Il a tout pouvoir. Il est conseillé de ne pas se logger directement sous ce compte mais de le devenir via la commande <code>su -</code> (où le tiret permet de recharger les variables locales). Sur certains systèmes, il est même impossible de se connecter en root dans l&rsquo;interface graphique.</p>
</li>
<li>
<p><strong>daemon: UID=1-999, GID=1-999</strong><br>
Représentent les utilisateurs applicatifs (les <strong>services</strong>). En effet, sous Linux, 99% des services ne sont pas executés sous l&rsquo;identité de root mais sous leur propres identité à des fins de sécurité.</p>
</li>
<li>
<p><strong>Utilisateur: UID et GDI &gt; 1000</strong><br>
Représentent les utilisateurs &ldquo;humains&rdquo;.</p>
</li>
</ul>
<h3 id="91-gestion-des-groupes">9.1 Gestion des groupes<a class="headerlink" href="#91-gestion-des-groupes" title="Permanent link"></a></h3>
<p>Les informations des groupes sont dans deux fichiers : <code>/etc/group</code> et <code>/etc/gshadow</code>.</p>
<h4 id="911-etcgroup">9.1.1 /etc/group<a class="headerlink" href="#911-etcgroup" title="Permanent link"></a></h4>
<p>Ce fichier est composé de plusieurs champs séparés par &ldquo;:&rdquo;. Ces champs sont respectivement :</p>
<ul>
<li>nom du groupe</li>
<li>mdp chiffré </li>
<li>GID</li>
<li>liste des membres ayant ce groupe en groupe secondaire</li>
</ul>
<p>S&rsquo;il y a un <code>x</code> dans la colonne du mot de passe, cela indique que le mot de passe est dans le fichier <code>/etc/gshadow</code>.</p>
<p><img alt="etc-group" src="../ressources/img/05-linux-sysadmin/etc-group-explained.png" title="/etc/group" /></p>
<p>Exemple :</p>
<div class="highlight"><pre><span class="nv">$ </span>cat /etc/group
  root:x:0:
  daemon:x:1:
  bin:x:2:
  sys:x:3:
  adm:x:4:
  tty:x:5:
  disk:x:6:
  <span class="o">[</span>...<span class="o">]</span>
  www-data:x:33:
  shadow:x:42:
  users:x:100:
  nogroup:x:65534:
  ssh:x:112:
  <span class="o">[</span>...<span class="o">]</span>
  eni:x:1000:
  systemd-coredump:x:999:
</pre></div>

<h4 id="912-etcgshadow">9.1.2 /etc/gshadow<a class="headerlink" href="#912-etcgshadow" title="Permanent link"></a></h4>
<p>Ce fichier contient les informations cachées sur le groupes séparées par des &ldquo;:&rdquo;. Il est rarement utilisé.</p>
<p>Ici les champs sont les suivants :</p>
<ul>
<li>nom du groupe </li>
<li>mdp chiffré</li>
<li>administrateurs</li>
<li>membres</li>
</ul>
<div class="highlight"><pre><span class="nv">$ </span>sudo cat /etc/gshadow
  root:*::
  daemon:*::
  bin:*::
  sys:*::
  adm:*::
  tty:*::
  disk:*::
  lp:*::
  <span class="o">[</span>...<span class="o">]</span>
  dip:*::eni
  www-data:*::
  <span class="o">[</span>...<span class="o">]</span>
  lightdm:!::
  eni:!::
  systemd-coredump:!*::
</pre></div>

<p>Si le champs <em>mdp</em> contient les caractères <code>!</code> ou <code>*</code>, alors les utilisateurs ne pourront pas utiliser le mdp pour accèder au groupe. </p>
<p>Si le champs <em>mdp</em> est vide, alors seuls les membres du groupe pourront obtenir les permissions du groupe.</p>
<p>Le champs <em>administrateurs</em> contient la liste des administrateurs du groupe séparés par des virgules. Les administrateurs peuvent modifier le mdp et les membres du groupe. </p>
<h4 id="913-commandes-de-gestions-des-groupes">9.1.3 Commandes de gestions des groupes<a class="headerlink" href="#913-commandes-de-gestions-des-groupes" title="Permanent link"></a></h4>
<h5 id="9131-creation-groupadd">9.1.3.1 Création (groupadd)<a class="headerlink" href="#9131-creation-groupadd" title="Permanent link"></a></h5>
<p>La commande <strong>groupadd</strong> permet de créer un nouveau groupe.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre># groupadd [OPTIONS] group 
</pre></div>

<p><strong>Options usuelles</strong>:</p>
<ul>
<li><code>-g GID</code> : valeur numérique de l&rsquo;identifiant du groupe<br>
Cette valeur doit être unique. Par défaut c&rsquo;est le plus petit id supérieur au GID_MIN et aux id des groupes existant.</li>
</ul>
<h5 id="9132-modification-groupmod">9.1.3.2 Modification (groupmod)<a class="headerlink" href="#9132-modification-groupmod" title="Permanent link"></a></h5>
<p>La commande <strong>groupmod</strong> permet de modifier la definition d&rsquo;un groupe sur le système.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre># groupmod [OPTIONS] GROUP
</pre></div>

<p><strong>Options usuelles</strong>:</p>
<ul>
<li><code>-g GID</code> : le group ID du group donné sera changé pour &ldquo;GID&rdquo;. Attention aux orphelins des fichiers créés préalablement.</li>
<li><code>-n NEW_GROUPNAME</code> : change le nom du groupe</li>
</ul>
<h5 id="9133-suppression-groupdel">9.1.3.3 Suppression (groupdel)<a class="headerlink" href="#9133-suppression-groupdel" title="Permanent link"></a></h5>
<p>La commande <strong>groupdel</strong> permet de supprimer un groupe, s&rsquo;il est vidé de tous ses membres avant.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>groupdel <span class="o">[</span>OPTIONS<span class="o">]</span> GROUP
</pre></div>

<h5 id="9134-gpasswd">9.1.3.4 gpasswd<a class="headerlink" href="#9134-gpasswd" title="Permanent link"></a></h5>
<p>La commande <strong>gpasswd</strong> permet d&rsquo;administrer les groupes, i.e administrer les fichiers /etc/group et /etc/gshadow.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>gpasswd <span class="o">[</span>OPTIONS<span class="o">]</span> group
</pre></div>

<p><strong>Options usuelles</strong>:</p>
<ul>
<li><code>-a FOO</code> : ajoute l&rsquo;utilisateur FOO au groupe </li>
<li><code>-d FOO</code> : supprime l&rsquo;utilisateur FOO du groupe </li>
</ul>
<h3 id="92-gestion-des-utilisateurs">9.2 Gestion des utilisateurs<a class="headerlink" href="#92-gestion-des-utilisateurs" title="Permanent link"></a></h3>
<p>Les informations des utilisateurs sont dans <code>/etc/passwd</code> et <code>/etc/shadow</code>.</p>
<h4 id="921-etcpasswd">9.2.1 /etc/passwd<a class="headerlink" href="#921-etcpasswd" title="Permanent link"></a></h4>
<p>Les champs du fichier sont :</p>
<ul>
<li>nom</li>
<li>mdp chiffré</li>
<li>UID</li>
<li>GID</li>
<li>nom complet</li>
<li>répertoire personnel (chemin)</li>
<li>shell (chemin)</li>
</ul>
<p><img alt="etc-passwd" src="../ressources/img/05-linux-sysadmin/etc-passwd-explained.png" title="/etc/passwd" /></p>
<p>Exemple :</p>
<div class="highlight"><pre><span class="nv">$ </span>cat /etc/passwd
  <span class="o">[</span>...<span class="o">]</span>
  daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
  dnsmasq:x:109:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
  eni:x:1000:1000:eni,,,:/home/eni:/bin/bash
  <span class="o">[</span>...<span class="o">]</span>
  sshd:x:108:65534::/run/sshd:/usr/sbin/nologin
  <span class="o">[</span>...<span class="o">]</span>
  www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</pre></div>

<p>S&rsquo;il y a un <code>x</code> dans la colonne &ldquo;mdp&rdquo; alors le mdp est dans le fichier <code>/etc/shadow</code>.</p>
<p>Le champ &ldquo;GID&rdquo; détermine quel est le groupe principal de l&rsquo;utilisateur.</p>
<p>Le champ &ldquo;nom complet&rdquo; peut comporter des infos complémentaires comme le téléphone, etc. Ces informations peuvent être directement indiquées lors de la création de l&rsquo;utilisateur ou via la commande <code>chfn</code> (change real user name and information - <code>chfn [option] [LOGIN]</code>)</p>
<p>Le champ &ldquo;répertoire personnel&rdquo; contient le chemin du répertoire d&rsquo;accueil de l&rsquo;utilisateur, si celui-ci a été créé. </p>
<p>Le champ &ldquo;shell&rdquo; correspond au chemin du binaire du shell de l&rsquo;utilisateur. Il est possible de le modifier avec la commande <code>chsh</code> (change login shell - <code>chsh [options] [LOGIN]</code>).</p>
<h4 id="922-etcshadow">9.2.2 /etc/shadow<a class="headerlink" href="#922-etcshadow" title="Permanent link"></a></h4>
<p>Ce fichier contient les informations cachées des utilisateurs.</p>
<p>Les champs du fichier sont :</p>
<ul>
<li>user</li>
<li>mdp chiffré</li>
<li>date dernier changement</li>
<li>agemini.agemax</li>
<li>periode avertissement</li>
<li>période inactivité</li>
<li>date fin validité</li>
<li>champ réservé</li>
</ul>
<div class="highlight"><pre><span class="nv">$ </span>sudo cat /etc/shadow
  root:<span class="nv">$y$j9T$ZD2FVp</span>.xRUWn6fymn5Pux.<span class="nv">$mqJtezUsD2fOtLJ4OJoGBbITBfH9pxVzllfR</span>/NyCOtA:19044:0:99999:7:::
  daemon:*:19044:0:99999:7:::
  <span class="o">[</span>...<span class="o">]</span>
  dnsmasq:*:19044:0:99999:7:::
  <span class="o">[</span>...<span class="o">]</span>
  lightdm:*:19044:0:99999:7:::
  eni:<span class="nv">$y$j9T$rRiN4T0N9aRfTbTz17l6T</span>/<span class="nv">$WVMEU9icTLqdQ3deWiuSAZzqdHrlaRNbmENNMeJt4A</span>/:19044:0:99999:7:::
  systemd-coredump:!*:19044::::::
</pre></div>

<p><strong>User</strong> contient le nom de l&rsquo;utilisateur</p>
<p><strong>Mdp</strong> : contient le hash du mdp. Cette colonne est composée de 3 champs séparés par des &ldquo;$&rdquo;.<br></p>
<ul>
<li>Premier champs : <strong>algo de hashage</strong></li>
<li><code>$1$</code> signifie MD5</li>
<li><code>$2a$</code> signifie Blowfish</li>
<li><code>$2$</code> signifie Blowfish (manipulation correcte de caractères 8 bits)</li>
<li><code>$5$</code> signifie SHA-256</li>
<li>
<p><code>$6$</code> signifie SHA-512</p>
</li>
<li>
<p>Deuxième champ : le <strong>sel</strong> (string aléatoire ajouter au mdp avant de faire son hash).</p>
</li>
<li>
<p>Troisième champ : le <strong>hash du mdp</strong> + son <strong>sel</strong>. </p>
</li>
</ul>
<p>Le fait d&rsquo;utiliser un sel dans le stockage des mdp permet d&rsquo;augmenter leur sécurité. Le principe du hash est de générer une chaine unique d&rsquo;une certaine taille par rapport à une chaîne donnée. Donc si deux utilisateurs ont le même mdp, par exemple &ldquo;iop&rdquo; alors les hashs purs seront identiques. L&rsquo;ajout du sel fait en sorte que les hashs soient différents, pourtant les utilisateurs ont le même mdp.</p>
<p><strong>Date de dernier changement de mdp</strong> : en nombre de jours depuis le 01/01/1970. Une valeur de 0 force le changement du mdp par l&rsquo;utilisateur à la prochaine connexion. </p>
<ul>
<li>Si ce champ est vide l&rsquo;utilisateur ne subit pas les options de vieillissement du mot de passe.</li>
</ul>
<p><strong>Âge minimum</strong> : durée en jours que l&rsquo;utilisateur devra attendre avant de pouvoir changer son mdp à nouveau. </p>
<ul>
<li>Si la valeur est vide ou à 0, cela signifie qu&rsquo;il n&rsquo;y a pas d&rsquo;âge minimum.</li>
</ul>
<p><strong>Âge maximum</strong> : durée en jours après laquelle l&rsquo;utilisateur devra changer son mot de passe. Une fois cette durée écoulée, le mdp restera valide mais il sera demandé à l&rsquo;utilisateur de changer de mdp à la prochaine connexion.</p>
<ul>
<li>Un champs vide signifie qu&rsquo;il n&rsquo;y a aucun âge limite.</li>
<li>Si l&rsquo;âge maximum est inférieur à l&rsquo;âge minimum, alors l&rsquo;utilisateur ne pourra pas changer son mdp.</li>
</ul>
<p><strong>Période d&rsquo;avertissement d&rsquo;expiration du mdp</strong> : durée en jours pendant laquelle l&rsquo;utilisateur sera averti avant que son mdp n&rsquo;expire. Une valeur vide ou à 0 désactive la période d&rsquo;avertissement.</p>
<p><strong>Période d&rsquo;inactivité du mdp</strong> : durée en jours pendant laquelle le mdp sera qd même accepté après son expiration. L&rsquo;utilisateur devra mettre à jour son mdp à la prochaine connexion.</p>
<ul>
<li>Après expiration du mdp suivie de la période d&rsquo;expiration, plus aucune connection n&rsquo;est possible avec le mdp. L&rsquo;utilisateur est prié de contacter son admin.</li>
<li>Un champs vide ou à 0 signifie qu&rsquo;aucune periode d&rsquo;inactivité n&rsquo;est imposée.</li>
</ul>
<p><strong>Date de fin de validité du compte</strong> : la date d&rsquo;expiration du compte exprimée en nombre de jours depuis le 01/01/1970.</p>
<ul>
<li>la date d&rsquo;expiration du compte est différente d&rsquo;une expiration de mdp. Même si le mdp est valide, aucune connection ne sera possible si le compte a expiré.</li>
<li>Un champs vide signifie que le compte n&rsquo;expirera jamais</li>
<li>Ce champs ne doit jamais être à 0 car cela signifierait que c&rsquo;est soit un compte ayant expiré le 01/01/1970, ou qu&rsquo;il n&rsquo;a pas d&rsquo;expiration. (sic)</li>
</ul>
<h4 id="923-commandes-de-gestions-des-utilisateurs">9.2.3 Commandes de gestions des utilisateurs<a class="headerlink" href="#923-commandes-de-gestions-des-utilisateurs" title="Permanent link"></a></h4>
<h5 id="9231-creation-useradd-adduser">9.2.3.1 Création (useradd / adduser)<a class="headerlink" href="#9231-creation-useradd-adduser" title="Permanent link"></a></h5>
<p>La commande <strong>useradd</strong> permet de créer un nouvel utilisateur ou de mettre à jour les informations par défaut d&rsquo;un utilisateur existant.</p>
<blockquote>
<p>useradd is a low level utility for adding users. On Debian, administrators should usually use adduser(8) instead.</p>
</blockquote>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>useradd <span class="o">[</span>options<span class="o">]</span> LOGIN 
useradd -D, --defaults
useradd -D <span class="o">[</span>options<span class="o">]</span>
</pre></div>

<p><strong>Options usuelles</strong>:</p>
<ul>
<li><code>-m, --create-home</code> : créer le home de l&rsquo;utilisateur s&rsquo;il n&rsquo;existe pas. </li>
<li><code>-M, --no-create-home</code> : ne créer pas le home de l&rsquo;utilisateur.</li>
<li><code>-d, --home-dir HOME_DIR</code> :  pour spécifier le chemin du home. Par défaut sous <code>/home/&lt;user&gt;</code>. Cette valeur par défaut peut être changée dans <code>/etc/defaults/useradd</code>.</li>
<li><code>-u, --uid UID</code> : indique l&rsquo;UID de l&rsquo;utilisateur. Si omit, <code>useradd</code> utilisera le plus petit UID disponible.</li>
<li><code>-g, --gid GROUP</code> : le GID du groupe principal de l&rsquo;utilisateur. Doit faire référence à un groupe déjà existant.</li>
<li><code>-G, --groups GROUP1[, GROUP2,...[GROUPN]]]</code> : indique la liste des groupes secondaires</li>
<li><code>-s, --shell SHELL</code> : précise le chemin absolu du binaire du shell de l&rsquo;utilisateur. Si vide, c&rsquo;est le shell par défaut qui sera défini. Ce shell par défaut peut être changé dans <code>/etc/default/useradd</code>. </li>
<li><code>-r, --system</code> : crée un compte utilisateur système. Pas de création de home pour lui sauf si <code>-m</code> est utilisé.</li>
</ul>
<p><strong>Fichier de configuration</strong></p>
<p>Le fichier de configuration <code>/etc/default/useradd</code> :</p>
<div class="highlight"><pre>eni@debian:~<span class="nv">$ </span>cat /etc/default/useradd 
<span class="c1"># Default values for useradd(8)</span>
<span class="c1">#</span>
<span class="c1"># The SHELL variable specifies the default login shell on your</span>
<span class="c1"># system.</span>
<span class="c1"># Similar to DSHELL in adduser. However, we use &quot;sh&quot; here because</span>
<span class="c1"># useradd is a low level utility and should be as general</span>
<span class="c1"># as possible</span>
<span class="nv">SHELL</span><span class="o">=</span>/bin/sh
<span class="c1">#</span>
<span class="c1"># The default group for users</span>
<span class="c1"># 100=users on Debian systems</span>
<span class="c1"># Same as USERS_GID in adduser</span>
<span class="c1"># This argument is used when the -n flag is specified.</span>
<span class="c1"># The default behavior (when -n and -g are not specified) is to   create a</span>
<span class="c1"># primary user group with the same name as the user being added to the</span>
<span class="c1"># system.</span>
<span class="c1"># GROUP=100</span>
<span class="c1">#</span>
<span class="c1"># The default home directory. Same as DHOME for adduser</span>
<span class="c1"># HOME=/home</span>
<span class="c1">#</span>
<span class="c1"># The number of days after a password expires until the account </span>
<span class="c1"># is permanently disabled</span>
<span class="c1"># INACTIVE=-1</span>
<span class="c1">#</span>
<span class="c1"># The default expire date</span>
<span class="c1"># EXPIRE=</span>
<span class="c1">#</span>
<span class="c1"># The SKEL variable specifies the directory containing &quot;skeletal&quot; user</span>
<span class="c1"># files; in other words, files such as a sample .profile that   will be</span>
<span class="c1"># copied to the new user&#39;s home directory when it is created.</span>
<span class="c1"># SKEL=/etc/skel</span>
<span class="c1">#</span>
<span class="c1"># Defines whether the mail spool should be created while</span>
<span class="c1"># creating the account</span>
<span class="c1"># CREATE_MAIL_SPOOL=yes</span>
</pre></div>

<p><strong>Exemple de création</strong>:</p>
<div class="highlight"><pre><span class="nv">user</span><span class="o">=</span><span class="s1">&#39;francois&#39;</span>
<span class="nv">real_name</span><span class="o">=</span><span class="s1">&#39;François&#39;</span>
<span class="nv">mdp</span><span class="o">=</span><span class="s1">&#39;password&#39;</span>
<span class="nv">groupe_principal</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span>
<span class="nv">groupe_secondaire</span><span class="o">=</span><span class="s1">&#39;stagiaire documentation&#39;</span>

useradd -m -d /home/<span class="nv">$user</span> -G <span class="nv">$group_name</span> -s <span class="nv">$shell</span>
</pre></div>

<h6 id="notes-sur-etcskel">Notes sur /etc/skel<a class="headerlink" href="#notes-sur-etcskel" title="Permanent link"></a></h6>
<p>Lors de la création d&rsquo;un utilisateur, si l&rsquo;option <code>-m</code> est passée à useradd, alors le contenu du répertoire <code>/etc/skel</code> sera copié dans le répertoire d&rsquo;accueil de l&rsquo;utilisateur.</p>
<ul>
<li>skel is derived from the <strong>skeleton</strong> because it contains basic structure of home directory.</li>
<li>The <code>/etc/skel</code> directory contains files and directories that are automatically copied over to a new user&rsquo;s when it is created from <strong>useradd</strong> command.</li>
<li>The default skel folder can be modifier in <code>etc/default/useradd</code> (line <code>SKEL=/etc/skel</code>)</li>
<li>Default permission of <code>/etc/skel</code> is <code>drwxr-xr-x</code>.</li>
<li>It is recommended to leave the permission of skel directory or its content as it is, as some programs/profils depend on </li>
</ul>
<h5 id="9232-modification-usermod">9.2.3.2 Modification (usermod)<a class="headerlink" href="#9232-modification-usermod" title="Permanent link"></a></h5>
<p>La commande <strong>usermod</strong> permet de modifier un utilisateur.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>usermod <span class="o">[</span>options<span class="o">]</span> LOGIN
</pre></div>

<p><strong>Options usuelles</strong>:</p>
<ul>
<li><code>-a, --append</code> : ajouter l&rsquo;utilisateur aux groupes supplémentaires. A n&rsquo;utiliser qu&rsquo;avec l&rsquo;option <code>-G</code>.</li>
<li><code>-d, --home HOME_DIR</code> : indique le nouveau répertoire d&rsquo;accueil de l&rsquo;utilisateur. Si l&rsquo;option <code>-m</code> est fournie, le contenu du répertoire actuel sera déplacé dans le nouveau.</li>
<li><code>-e, --expiredate EXPIRE_DATE</code> : date à laquelle le compte sera désactivé. La date est indiquée au format YYYY-MM-JJ ou en nombre de jours depuis le 01/01/1970. Si EXPIRE_DATE est vide alors l&rsquo;expiration du compte sera désactiver.</li>
<li><code>-f, --inactive DUREE_INACTIVITE</code> : nombre de jours après l&rsquo;expiration d&rsquo;un mdp après lequel le compte est définitivement désactivé. Une valeur à 0 désactive le compte dès que le mdp a dépassé sa fin de validité, et une valeur de -1 désactive cette fonctionnalité.</li>
<li><code>-g, --gid GROUP</code> : nom ou id du nouveau groupe principal de l&rsquo;utilisateur. Tout fichier du répertoire personnel de l&rsquo;utilisateur appartenant au groupe principal précédent de l&rsquo;utilisateur appartiendra à ce nouveau groupe.<br><br>
Le groupe propriétaire des fichiers en dehors du répertoire personnel de l&rsquo;utilisateur doit être modifié manuellement.</li>
<li><code>-G, --groupes GROUP1[,GROUP2...[,GROUPN]]</code> : liste des groupes secondaires de l&rsquo;utilisateur. <br><br>
Si l&rsquo;utilisateur appartient déjà à un groupe qui n&rsquo;est pas listé, l&rsquo;utilisateur sera enlevé du groupe. Il est peut être utile d&rsquo;ajouter l&rsquo;option <code>-a, --append</code> afin de ne pas perdre ces appartenances.</li>
<li><code>-s, --shell</code> : chemin du shell de l&rsquo;utilisateur. Peut être configurer avec la commande <code>chsh</code>.</li>
<li><code>-L, --lock</code> : verrouille le mdp de l&rsquo;utilisateur. Cette option ajoute un &ldquo;!&rdquo; devant le hash du mdp dans <code>/etc/shadow</code>.<br>
<em>Note</em> : pour verrouiller le compte (et pas seulement l&rsquo;accès au compte par un mdp), il est également nécessaire de placer <code>DATE_FIN_VALIDITE</code> à 1.</li>
<li><code>-U, --unlock</code> : Déverrouille le mdp de l&rsquo;utilisateur.</li>
</ul>
<h5 id="9233-suppression-userdel">9.2.3.3 Suppression (userdel)<a class="headerlink" href="#9233-suppression-userdel" title="Permanent link"></a></h5>
<p>La commande <strong>userdel</strong> permet de supprimer un utilisateur.</p>
<blockquote>
<p>userdel is a low level utility for removing users. On Debian,  administrators should usually use deluser(8) instead.</p>
<p>The userdel command modifies the system account files, deleting all entries that refer to the user name LOGIN. The named user must exist.</p>
</blockquote>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre># userdel [OPTIONS] LOGIN
</pre></div>

<p><strong>Options usuelles</strong>:</p>
<ul>
<li><code>-r, --remove</code> : Les fichiers présents dans le home de l&rsquo;utilisateur seront également supprimés. Les fichiers de l&rsquo;utilisateur présents dans d&rsquo;autres répertoires ne seront pas supprimés. </li>
</ul>
<h5 id="9234-modification-du-mot-de-passe-passwd">9.2.3.4 Modification du mot de passe (passwd)<a class="headerlink" href="#9234-modification-du-mot-de-passe-passwd" title="Permanent link"></a></h5>
<p>La commande <strong>passwd</strong> permet de modifier le mdp utilisateur. Si elle est executée par root, cette commande modifiera les champs du fichier <code>/etc/shadow</code> selon les options passées.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre># passwd [OPTIONS] [LOGIN]
</pre></div>

<p><strong>Options usuelles</strong>:</p>
<ul>
<li><code>-e, --expire</code> : fait expirer immédiatement le mdp de l&rsquo;utilisateur. Celui-ci sera obligé de changer son mdp à sa prochaine connexion.</li>
<li><code>-l, --lock</code> : verrouille le mdp en ajoutant un &ldquo;!&rdquo; devant le hash du mot de passe dans <code>/etc/shadow</code>.</li>
<li><code>-u, --unlock</code> : déverrouille le mdp en supprimant le &ldquo;!&rdquo; devant le hash du mdp dans <code>/etc/shadow</code>.</li>
</ul>
<p>Pour modifier certains champs du fichier <code>/etc/shadow</code>, il est possible aussi d&rsquo;utiliser la commande <code>chage</code> si elle est installée.</p>
<h4 id="924-outils-de-verification-getent-id">9.2.4 Outils de vérification (getent / id)<a class="headerlink" href="#924-outils-de-verification-getent-id" title="Permanent link"></a></h4>
<p>La commande <strong>getent</strong> permet de consulter les groupes et les utilisateurs. Elle est plus simple à utiliser qu&rsquo;un cat sur les fichiers /etc/group ou /etc/passwd.</p>
<div class="highlight"><pre>NAME
       getent - get entries from Name Service Switch libraries

SYNOPSIS
       getent [option]... database key...

DESCRIPTION
       The  getent  command displays entries from databases supported by the Name
       Service Switch libraries, which are configured in /etc/nsswitch.conf.   If
       one  or  more key arguments are provided, then only the entries that match
       the supplied keys will be displayed.  Otherwise, if no  key  is  provided,
       all  entries  will be displayed (unless the database does not support enu‐
       meration).
</pre></div>

<p><strong>Usage</strong>:</p>
<div class="highlight"><pre><span class="nv">$ </span>getent passwd <span class="o">[</span>LOGIN<span class="o">]</span>     <span class="c1"># profil user</span>
<span class="nv">$ </span>getent group <span class="o">[</span>GROUP<span class="o">]</span>      <span class="c1"># group appartenance</span>
</pre></div>

<p><strong>Exemples</strong>:</p>
<div class="highlight"><pre><span class="nv">$ </span>cat /etc/passwd <span class="p">|</span> cut -d: -f1           <span class="c1"># users only</span>
<span class="nv">$ </span>cat /etc/passwd <span class="p">|</span> awk -F: <span class="s1">&#39;{print $1}&#39;</span>  <span class="c1"># users only</span>
<span class="nv">$ </span>getent passwd francois                  <span class="c1"># getent passwd [LOGIN]</span>
  francois:x:1002:1001:François,,,:/home/francois:/bin/sh
</pre></div>

<div class="highlight"><pre><span class="nv">$ </span>cat /etc/group
<span class="nv">$ </span>groups francois
  francois : admin stagiaires documentation
<span class="nv">$ </span>getent group stagiaires
  stagiaires:x:1002:fred,francois
</pre></div>

<div class="highlight"><pre><span class="nv">$ </span><span class="k">for</span> f in francois fred fabrice<span class="p">;</span> <span class="k">do</span> getent passwd <span class="nv">$f</span><span class="p">;</span> <span class="k">done</span>
  francois:x:1001:1001::/home/francois:/bin/sh
  fred:x:1002:1005:Frédéric,,,:/home/fred:/bin/bash
  fabrice:x:1003:1006:Fabrice,,,:/home/fabrice:/bin/bash
</pre></div>

<div class="highlight"><pre>eni@deb-desktop:~<span class="nv">$ </span><span class="k">for</span> f in francois fred fabrice<span class="p">;</span> <span class="k">do</span> id <span class="nv">$f</span> <span class="p">;</span> <span class="k">done</span>
  <span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>francois<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>admin<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>admin<span class="o">)</span>,1002<span class="o">(</span>stagiaires<span class="o">)</span>,1003<span class="o">(</span>documentation<span class="o">)</span>
  <span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>fred<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1005<span class="o">(</span>fred<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1005<span class="o">(</span>fred<span class="o">)</span>,1002<span class="o">(</span>stagiaires<span class="o">)</span>,1003<span class="o">(</span>documentation<span class="o">)</span>
  <span class="nv">uid</span><span class="o">=</span>1003<span class="o">(</span>fabrice<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1006<span class="o">(</span>fabrice<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1006<span class="o">(</span>fabrice<span class="o">)</span>,1004<span class="o">(</span>vip<span class="o">)</span>
</pre></div>

<h3 id="93-changement-didentite-et-elevation-de-privileges">9.3 Changement d&rsquo;identité et élévation de privilèges<a class="headerlink" href="#93-changement-didentite-et-elevation-de-privileges" title="Permanent link"></a></h3>
<h4 id="931-la-commande-su">9.3.1 la commande su<a class="headerlink" href="#931-la-commande-su" title="Permanent link"></a></h4>
<p>La commande <strong>su</strong> permet d&rsquo;executer une commande avec l&rsquo;utilisateur root.</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre><span class="nv">$ </span>su <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>-<span class="o">]</span> <span class="o">[</span>user <span class="o">[</span>argument...<span class="o">]]</span>
</pre></div>

<p><strong>Options usuelles</strong>:</p>
<ul>
<li><code>-s SHELL, --shell=SHELL</code> : utiliser un autre shell que celui indiqué dans <code>/etc/passwd</code> pour l&rsquo;utilisateur cible.</li>
<li><code>-</code>, <code>-l</code>, <code>--login</code> : start the shell as a login shell with an environment similar to a real login. Faire un changement d&rsquo;identité reproduisant complétement un login.</li>
<li><code>-c COMMAND</code>, <code>--command=COMMAND</code> : executer la commande, il est conseillé de mettre la commande entre simple quote.</li>
</ul>
<h4 id="932-la-commande-sudo">9.3.2 la commande sudo<a class="headerlink" href="#932-la-commande-sudo" title="Permanent link"></a></h4>
<p>La commande <strong>sudo</strong> permet d&rsquo;executer une commande en tant qu&rsquo;un autre utilisateur. Cette commande demande le mdp de l&rsquo;utilisateur et non le mdp root. L&rsquo;élévation de privilège sera gardée en mémoire pour 5 minutes par défaut.</p>
<p><strong>Exemples</strong></p>
<ul>
<li>Executer une commande avec les droits root :
<div class="highlight"><pre><span class="nv">$ </span>sudo apt update
</pre></div></li>
<li>Devenir root avec la commande sudo
<div class="highlight"><pre><span class="nv">$ </span>sudo -i
<span class="nv">$ </span>sudo -s
</pre></div></li>
</ul>
<p><strong>Notes</strong>:</p>
<p>Les systèmes Linux ont une gestion des utilisateurs assez frustre en ce qui concerne l&rsquo;administration. Il faut être root pour pouvoir intervenir sur le système.</p>
<p>Mais la répartition des tâches en entreprise amène à considérer les tâches d&rsquo;administration différemment. Les opérations répétitives telles que les changements de mdp, la gestion des comptes d&rsquo;utilisateurs, les sauvegardes et restaurations doivent pouvoir être effectuées par des utilisateurs à qui l&rsquo;on ne doit pas accorder le privilège root.</p>
<p>La commande <code>sudo</code> permet de déléguer des tâches précises d&rsquo;administration à certains utilisateurs. Par exemple, il sera possible d&rsquo;accorder les privilèges de gestion des utilisateurs à un groupe d&rsquo;utilisateurs.</p>
<p>Afin qu&rsquo;un utilisateur puisse utiliser la commande <code>sudo</code>, il faut qu&rsquo;il soit renseigné dans le fichier de configuration <code>/etc/sudoers</code> et renseigner les commandes qu&rsquo;il pourra utiliser.</p>
<p>Plus simplement, il est possible de donner tous les droits root à un utilisateur en l&rsquo;ajoutant au groupe <code>sudo</code>.</p>
<p><strong>Ajouter un utilisateur au groupe sudo</strong></p>
<div class="highlight"><pre># usermod -aG sudo monUser
</pre></div>

<ul>
<li><code>a</code> : append</li>
<li><code>G</code> : groupe secondaire</li>
</ul>
<p><em>Voir TP 9 - Gestion des utilisateurs et des groupes</em></p>
<p><a href="#05-linux-sysadmin">Retour en haut</a></p>
<h2 id="10-droits-sur-les-fichiers-et-repertoires">10. Droits sur les fichiers et répertoires<a class="headerlink" href="#10-droits-sur-les-fichiers-et-repertoires" title="Permanent link"></a></h2>
<p>Les droits d&rsquo;accès sur les fichiers sont directement inscrits dans l&rsquo;inode des fichiers. Ils sont découpés en 3 colonnes : utilisateur propriétaire (<strong>user</strong>), groupe propriétaire (<strong>group</strong>) et les autres (<strong>other</strong>).</p>
<h3 id="100-notes-perso">10.0 Notes perso<a class="headerlink" href="#100-notes-perso" title="Permanent link"></a></h3>
<h4 id="1000-types-de-fichiers">10.0.0 Types de fichiers<a class="headerlink" href="#1000-types-de-fichiers" title="Permanent link"></a></h4>
<p><strong>Types de fichiers</strong>:</p>
<ul>
<li><code>-</code> : standard (file)</li>
<li><code>d</code> : répertoire</li>
<li><code>l</code> : lien symbolique</li>
<li><code>b</code> : fichier spécial mode block</li>
<li><code>c</code> : fichier spécial mode caractère</li>
<li><code>n</code> : fichier spécial mode réseau</li>
<li><code>p</code> : named pipe</li>
</ul>
<h4 id="1001-permissions-rwx">10.0.1 Permissions (rwx)<a class="headerlink" href="#1001-permissions-rwx" title="Permanent link"></a></h4>
<p><strong>Permissions</strong>:</p>
<table>
  <tr>
<th colspan="3" rowspan="1" headers="user" scope="3" style="border: 2px solid black;text-align: center;">user</th>
<th colspan="3" rowspan="1" headers="user" scope="3"style="border: 2px solid black;text-align: center;">group</th>
<th colspan="3" rowspan="1" headers="user" scope="3"style="border: 2px solid black;text-align: center;">other</th>
</tr>
<tr>
  <td style="border-left: 2px solid black; border-bottom: 2px solid black; text-align: center;">r</td>
  <td style="border-bottom: 2px solid black; text-align: center;">w</td>
  <td style="border-right: 2px solid black; border-bottom: 2px solid black; text-align: center;">x</td>

  <td style="border-left: 2px solid black; border-bottom: 2px solid black; text-align: center;">r</td>
  <td style="border-bottom: 2px solid black; text-align: center;">w</td>
  <td style="border-right: 2px solid black; border-bottom: 2px solid black; text-align: center;">x</td>

  <td style="border-left: 2px solid black; border-bottom: 2px solid black; text-align: center;">r</td>
  <td style="border-bottom: 2px solid black; text-align: center;">w</td>
  <td style="border-right: 2px solid black; border-bottom: 2px solid black; text-align: center;">x</td>
</tr>
<tr>
  <td style="border-left: 1px dotted black; border-bottom: 1px dotted black; text-align: center;">4</td>
  <td style="border-bottom: 1px dotted black; text-align: center;">2</td>
  <td style="border-right: 1px dotted black; border-bottom: 1px dotted black; text-align: center;">1</td>

  <td style="border-left: 1px dotted black; border-bottom: 1px dotted black; text-align: center;">4</td>
  <td style="border-bottom: 1px dotted black; text-align: center;">2</td>
  <td style="border-right: 1px dotted black; border-bottom: 1px dotted black; text-align: center;">1</td>

  <td style="border-left: 1px dotted black; border-bottom: 1px dotted black; text-align: center;">4</td>
  <td style="border-bottom: 1px dotted black; text-align: center;">2</td>
  <td style="border-right: 1px dotted black; border-bottom: 1px dotted black; text-align: center;">1</td>
</tr>
</table>

<h5 id="10010-change-ownership-chown">10.0.1.0 Change ownership (chown)<a class="headerlink" href="#10010-change-ownership-chown" title="Permanent link"></a></h5>
<p><strong>Change Ownership</strong>:</p>
<div class="highlight"><pre># chown userXX foo.txt
# chown userXX:groupXX foo.txt
# chown :groupXX foo.txt

# chown -R data-www:data-www /var/www 
</pre></div>

<h5 id="10011-change-permission-chmod">10.0.1.1 Change permission (chmod)<a class="headerlink" href="#10011-change-permission-chmod" title="Permanent link"></a></h5>
<p><strong>Change permissions</strong>:</p>
<div class="highlight"><pre>$ chmod 640 foo.txt
$ chmod u+x foo.txt
$ chmod a+x foo.sh
$ chmod u=rwx,g=r,o=- foo.txt
</pre></div>

<ul>
<li><code>u</code>, <code>g</code>, <code>o</code>, <code>a</code> : user, group, other, all</li>
<li><code>+</code>, <code>-</code>, <code>=</code> : ajouter / supprimer / donner exactement un droit</li>
<li><code>r</code>, <code>w</code>, <code>x</code>, <code>-</code> : read, write, execute, none</li>
<li><code>s</code> : setuid / setgid</li>
<li><code>t</code> : sticky bit (verrouillage des modif au seul proprio)</li>
</ul>
<h5 id="10012-droits-speciaux-setuid-setgid-sticky-bit">10.0.1.2 Droits spéciaux (setuid, setgid, sticky bit)<a class="headerlink" href="#10012-droits-speciaux-setuid-setgid-sticky-bit" title="Permanent link"></a></h5>
<h6 id="100121-setuid-setgid">10.0.1.2.1 setuid, setgid<a class="headerlink" href="#100121-setuid-setgid" title="Permanent link"></a></h6>
<p>setuid, setgid et sticky bit sont des permissions spéciales. <strong>setuid</strong> (set user id) et <strong>setgid</strong> permettent de modifier le droit d&rsquo;exécution au niveau d&rsquo;un utilisateur ou d&rsquo;un groupe.</p>
<p>Qd <strong>setuid</strong> est ajoutée, le programme est lancé avec les <strong>droits du propriétaire</strong> quelque soit l&rsquo;utilisateur qui le lance. <strong>setgid</strong> permet la même chose mais pour un groupe.</p>
<p>On peut voir les marqueurs en faisant un <code>ls -l</code>. </p>
<ul>
<li><strong>s</strong> = il y a aussi le droit x de positionné</li>
<li><strong>S</strong> = il n&rsquo;y a pas le droit x de positionné</li>
</ul>
<div class="highlight"><pre><span class="nv">$ </span>ls -l /usr/bin/passwd
  -rwsr-xr-x <span class="m">1</span> root root <span class="m">63960</span> Feb  <span class="m">7</span>  <span class="m">2020</span> /usr/bin/passwd
</pre></div>

<p><strong>Ajouter/retirer un droit spécial</strong></p>
<div class="highlight"><pre><span class="nv">$ </span>chmod u+s foo.txt    <span class="c1"># ajouter permission setuid</span>
<span class="nv">$ </span>chmod u-s foo.txt    <span class="c1"># retirer permission setuid</span>

<span class="nv">$ </span>chmod g+s foo.txt    <span class="c1"># ajouter permission setgid</span>
<span class="nv">$ </span>chmod g-s foo.txt    <span class="c1"># retirer permission setgid</span>

<span class="nv">$ </span>ls -l foo*
  -rwSr-Sr-- <span class="m">1</span> eni eni    <span class="m">0</span> Feb <span class="m">27</span> 13:49 foo.txt
  drwsr-sr-x <span class="m">2</span> eni eni <span class="m">4096</span> Feb <span class="m">27</span> 13:51 foo
</pre></div>

<h6 id="100122-sticky-bit">10.0.1.2.2 sticky bit<a class="headerlink" href="#100122-sticky-bit" title="Permanent link"></a></h6>
<p>Le problème avec <code>setuid</code> et <code>setgid</code>, c&rsquo;est que les différents membres du groupe peuvent accidentellement supprimer les fichiers des autres users. </p>
<p>Pour forcer les users d&rsquo;un même groupe à ne pouvoir modifier que leur fichiers, on utilise le Sticky Bit. Il représente des autorisations spéciales qui indique qu&rsquo;un utilisateur à le droit de lire/écrire mais qu&rsquo;il ne peut pas supprimer le fichier à moins d&rsquo;en être le propriétaire.</p>
<p>Cela permet de dissocier le droit de modification et le droit de suppression.</p>
<p><strong>Utilisation</strong>:</p>
<div class="highlight"><pre><span class="nv">$ </span>chmod +t projet/
<span class="nv">$ </span>ls -l
  drwxr-xr-t <span class="m">2</span> eni eni <span class="m">4096</span> Feb <span class="m">27</span> 13:57 projet
</pre></div>

<ul>
<li><strong>t</strong> = il y a aussi le droit x de positionné</li>
<li><strong>T</strong> = il n&rsquo;y a pas le droit x de positionné</li>
</ul>
<p>Le sticky bit est peut aussi être utilisé sur le dossier contenant un lien symbolique pour empêcher les utilisateurs de l&rsquo;effacer. (<em>RAPPEL</em> : tous les users ont tous les droits sur un lien symbolique).</p>
<p>En octal, setuid=4, setgid=2, sticky bit=1</p>
<table>
  <tr>
    <th colspan="3" rowspan="1" headers="special" scope="3" style="border: 2px solid black;text-align: center;">special</th>
    <th colspan="3" rowspan="1" headers="user" scope="3" style="border: 2px solid black;text-align: center;">user</th>
    <th colspan="3" rowspan="1" headers="group" scope="3"style="border: 2px solid black;text-align: center;">group</th>
    <th colspan="3" rowspan="1" headers="other" scope="3"style="border: 2px solid black;text-align: center;">other</th>
</tr>
<tr>
  <td style="border-left: 2px solid black; border-bottom: 2px solid black; text-align: center;" >setuid</td>
  <td style="border-bottom: 2px solid black; text-align: center;"                               >setgid</td>
  <td style="border-right: 2px solid black; border-bottom: 2px solid black; text-align: center;">sticky bit</td>

  <td style="border-left: 2px solid black; border-bottom: 2px solid black; text-align: center;" >r</td>
  <td style="border-bottom: 2px solid black; text-align: center;"                               >w</td>
  <td style="border-right: 2px solid black; border-bottom: 2px solid black; text-align: center;">x</td>  

  <td style="border-left: 2px solid black; border-bottom: 2px solid black; text-align: center;" >r</td>
  <td style="border-bottom: 2px solid black; text-align: center;"                               >w</td>
  <td style="border-right: 2px solid black; border-bottom: 2px solid black; text-align: center;">x</td>

  <td style="border-left: 2px solid black; border-bottom: 2px solid black; text-align: center;" >r</td>
  <td style="border-bottom: 2px solid black; text-align: center;"                               >w</td>
  <td style="border-right: 2px solid black; border-bottom: 2px solid black; text-align: center;">x</td>
</tr>
<tr style="border: 2px solid black">
  <td style="border-left: 2px solid black;text-align: center;">4</td>
  <td style="text-align: center;">2</td>
  <td style="border-right: 2px solid black;text-align: center;">1</td>  

  <td style="border-left: 2px solid black;text-align: center;">4</td>
  <td style="text-align: center;">2</td>
  <td style="border-right: 2px solid black;text-align: center;">1</td>  

  <td style="border-left: 2px solid black;text-align: center;">4</td>
  <td style="text-align: center;">2</td>
  <td style="border-right: 2px solid black;text-align: center;">1</td>  

  <td style="border-left: 2px solid black;text-align: center;">4</td>
  <td style="text-align: center;">2</td>
  <td style="border-right: 2px solid black;text-align: center;">1</td>  
</tr>
<tr style="border: 2px solid black">
  <td colspan="3" rowspan="1" style="border-left: 2px solid black; border-right: 2px solid black; text-align: center;" >1</td>
  <td colspan="3" rowspan="1" style="border-right: 2px solid black; text-align: center;"                                >7</td>
  <td colspan="3" rowspan="1" style="border-right: 2px solid black; text-align: center;"                                >7</td>
  <td colspan="3" rowspan="1" style="text-align: center;">4</td>
</tr>
</table>

<ul>
<li>Ex. 5754 = setuid + sticky bit + rwxr-xr&ndash;</li>
<li>Ex. 1775 = sticky bit + 775 = seul le proprio peut supprimer le fichier.</li>
<li>Ex. 2755 = setgid + 755 = seul un utisateur du group propriétaire peut supprimer le fichier.</li>
</ul>
<div class="highlight"><pre><span class="nv">$ </span>chmod <span class="m">5754</span> foo.txt
<span class="nv">$ </span>ls -l
  -rwsr-xr-T <span class="m">1</span> eni eni    <span class="m">0</span> Feb <span class="m">27</span> 22:26 foo.txt

<span class="nv">$ </span>chmod <span class="m">5757</span> foo.txt 
<span class="nv">$ </span>ls -l foo.txt 
  -rwsr-xrwt <span class="m">1</span> eni eni <span class="m">0</span> Feb <span class="m">27</span> 22:26 foo.txt
</pre></div>

<ul>
<li>Ex. 7775 : user &amp; group peuvent modifier fichier mais pas le supprimer, sauf si user est proEx. prio.</li>
<li>Ex. 2775 : group peut modifier le fichier et le supprimer. Les user normaux qui ne sont pas dans le groupe proprio ne peuvent pas le modifier.</li>
<li>Ex. 4775 : Seul le user proprio peut modifier et supprimer le fichier. </li>
<li>Ex. 1775 : user peut modifier mais pas supprimer sauf si c&rsquo;est lui le propriétaire.</li>
</ul>
<div class="highlight"><pre><span class="nv">$ i</span><span class="o">=</span><span class="m">7755</span> <span class="o">&amp;&amp;</span> chmod <span class="nv">$i</span> foo* <span class="o">&amp;&amp;</span>  ls -l <span class="p">|</span> grep foo
  drwsr-sr-t <span class="m">2</span> eni eni <span class="m">4096</span> Feb <span class="m">27</span> 22:43 foo
  -rwsr-sr-t <span class="m">1</span> eni eni    <span class="m">0</span> Feb <span class="m">27</span> 22:26 foo.txt
</pre></div>

<h3 id="101-modification-des-droits-et-proprietaire">10.1 Modification des droits et propriétaire<a class="headerlink" href="#101-modification-des-droits-et-proprietaire" title="Permanent link"></a></h3>
<h4 id="1011-modification-des-droits-chmod">10.1.1 Modification des droits (chmod)<a class="headerlink" href="#1011-modification-des-droits-chmod" title="Permanent link"></a></h4>
<p><a href="#10010-change-ownership-chown">voir plus haut</a></p>
<h4 id="1012-modification-du-proprietaire-chown">10.1.2 Modification du propriétaire (chown)<a class="headerlink" href="#1012-modification-du-proprietaire-chown" title="Permanent link"></a></h4>
<p><a href="#10011-change-permission-chmod">voir plus haut</a></p>
<h3 id="102-umask">10.2 umask<a class="headerlink" href="#102-umask" title="Permanent link"></a></h3>
<p>L&rsquo;umask détermine les <strong>permissions par défaut</strong> à la création d&rsquo;un fichier ou un dossier</p>
<blockquote>
<p>umask sets file mode creation mask.<br>
It sets the calling process&rsquo;s file mode creation mask (umask) to <u>mask</u> &amp; 0777 (i.e only the file permission bits of <u>mask</u> are used), and returns the previous value of the mask.</p>
</blockquote>
<p>La valeur de l&rsquo;umask sera &ldquo;soustraite&rdquo; à la valeur des droits maximaux à la création : <strong>0666</strong> pour un fichier, <strong>0777</strong> pour un répertoire.</p>
<p>Sur Debian, l&rsquo;umask par défaut des utilisateurs est de <strong>0022</strong>. Il est important que l&rsquo;umask de root et des utilisateurs de service (UID &lt; 1000) reste à 0022. Il est possible pour chaque utilisateur de changer son umask avec la commande <code>umask</code>.</p>
<p><strong>Permission_par_défaut = permissions_max - valeur_umask</strong></p>
<p>Ex. 0755 = 0777 - 0022</p>
<p><strong>Source</strong>:</p>
<div class="highlight"><pre><span class="cp">#include &lt;sys/types.h&gt;</span>
<span class="cp">#include &lt;sys/stat.h&gt;</span>

<span class="kt">mode_t</span> <span class="nf">umask</span><span class="p">(</span><span class="kt">mode_t</span> <span class="n">mask</span><span class="p">);</span>
</pre></div>

<p>Pour avoir un umask spécifique lors de sa connexion, il sera possible d&rsquo;ajouter une entrée avec la commande <code>umask</code> dans son fichier de chargement de son shell (le fichier <code>~/.bashrc</code> pour le shell bash).</p>
<p><strong>Syntaxe</strong>:</p>
<div class="highlight"><pre>umask [MODE]
</pre></div>

<p><strong>Exemples</strong>:</p>
<div class="highlight"><pre>eni@deb-desktop:~<span class="nv">$ </span><span class="nb">umask</span>
0022
eni@deb-desktop:~<span class="nv">$ </span><span class="nb">umask </span><span class="m">0007</span>   <span class="c1"># modifie temporairement !</span>
eni@deb-desktop:~<span class="nv">$ </span><span class="nb">umask</span>
0007
eni@deb-desktop:~<span class="nv">$ </span><span class="nb">umask </span>0022
eni@deb-desktop:~<span class="nv">$ </span><span class="nb">umask</span>
0022
</pre></div>

<h3 id="103-droits-speciaux">10.3 Droits spéciaux<a class="headerlink" href="#103-droits-speciaux" title="Permanent link"></a></h3>
<h4 id="setuid">SetUID<a class="headerlink" href="#setuid" title="Permanent link"></a></h4>
<p>Symbolique sur la colonne user. Champ d&rsquo;exécution : s=comprend aussi le droit x, S=n&rsquo;a pas le droit x. </p>
<p>Permet d&rsquo;executer un fichier avec les droits du propriétaire. N&rsquo;est pas utilisé sur un répertoire.</p>
<p>Octal 4.</p>
<h4 id="setgid">SetGID<a class="headerlink" href="#setgid" title="Permanent link"></a></h4>
<p>Symbolique sur la colonne group. Champ d&rsquo;exécution : s=comprend aussi le droit x, S=n&rsquo;a pas le droit x. </p>
<p>Permet d&rsquo;executer un fichier avec les droits du groupe. Ex. <code>/usr/bin/crontab</code> s&rsquo;execute avec le droit SetGID.</p>
<p>Tout fichier créé dans un dossier avec SetGID héritera du groupe du dossier parent. Les sous-dossiers créés hériteront quant à eux du droit SetGID.<br>Utile lorsque plusieurs utilisateurs travaillent sur un projet commun.</p>
<p>Octal 2.</p>
<h4 id="sticky-bit">Sticky bit<a class="headerlink" href="#sticky-bit" title="Permanent link"></a></h4>
<p>Symbolique sur la colonne others. Champ d&rsquo;exécution : t=comprend aussi le droit x, T=n&rsquo;a pas le droit x. </p>
<p>Lorsqu&rsquo;il est positionné sur un fichier, il permet la mise en zone de swap. Le but est que le fichier puisse être stocké en mémoire pour pouvoir être relancé rapidement. (gné?)</p>
<p>Tout fichier créé ne pourra être supprimé que par son propriétaire et par root. Ex. <code>/tmp</code></p>
<p><em>Voir TP 10 - Gestion des permissions</em> </p>
<p><a href="#05-linux-sysadmin">Retour en haut</a></p>
<h2 id="11-maintenance-du-systeme-en-production">11. Maintenance du système en production<a class="headerlink" href="#11-maintenance-du-systeme-en-production" title="Permanent link"></a></h2>
<h3 id="111-necessite-danalyser-son-systeme">11.1 Nécessité d&rsquo;analyser son système<a class="headerlink" href="#111-necessite-danalyser-son-systeme" title="Permanent link"></a></h3>
<p>Il est important d&rsquo;analyser son OS pour vérifier que tout fonctionne correctement. Il y a deux types d&rsquo;outils permettant cette analyse : les outils proactifs et réactifs.</p>
<p>Afin d&rsquo;analyser facilement son système, il est utile de lire les journaux du système (logs). </p>
<p>Afin de préserver un bon fonctionnement, il est utile d&rsquo;automatiser des tâches administratives.</p>
<p>Enfin, il est important de connaître des commandes de prise d&rsquo;informations du système, la RAM, le CPU, les processus, etc.</p>
<h3 id="112-gestion-des-journaux-systeme-et-applicatif">11.2 Gestion des journaux système et applicatif<a class="headerlink" href="#112-gestion-des-journaux-systeme-et-applicatif" title="Permanent link"></a></h3>
<p>La gestion des journaux applicatifs est gérée sous Debian par 2 services : <code>journald</code> au travers de <code>systemd</code> et l&rsquo;ancien système <code>rsyslog</code> au travers de <code>journald</code>.</p>
<h4 id="1121-journald-au-travers-de-systemd">11.2.1 journald au travers de systemd<a class="headerlink" href="#1121-journald-au-travers-de-systemd" title="Permanent link"></a></h4>
<p>Tous les services, programmes, tâches gérées par <code>systemd</code> ont leur comportement remontés dans <code>journald</code>. Le fait d&rsquo;exécuter la commande <code>systemctl status DAEMON</code> affiche le status du service mais aussi les logs de l&rsquo;application (si executée en mode root).</p>
<p>Ces logs sont enregistrés dans une base de données gérée par <code>journald</code>. Il est donc possible de consulter les logs complets en requêtant cette bdd avec la commande <code>journalctl</code>, dont le fichier de config est  <code>/etc/systemd/journald</code>. </p>
<h5 id="11211-journalctl">11.2.1.1 journalctl<a class="headerlink" href="#11211-journalctl" title="Permanent link"></a></h5>
<p>journalctl - Query the systemd journal.</p>
<p><strong>Synopsis</strong></p>
<div class="highlight"><pre>journalctl [OPTIONS...] [MATCHES...]
</pre></div>

<p><strong>Description</strong></p>
<blockquote>
<p><strong>journalctl</strong> may be used to query the contents of the  systemd(1) journal as written by systemd-journald.service(8).</p>
<p>If called without parameters, it will show the full contents of the journal, starting with the oldest entry collected.</p>
<p>If one or more match arguments are passed, the output is filtered accordingly. A match is in the format &ldquo;FIELD=VALUE&rdquo;, e.g. &ldquo;_SYSTEMD_UNIT=httpd.service&rdquo;, referring to the components of a structured journal entry. 
[&hellip;]</p>
</blockquote>
<ul>
<li>Pour naviguer dans le journal, il est préférable d&rsquo;utiliser la commande <code>less</code>.</li>
<li>
<p>Pour visualiser les logs en temps réel, on utilise le commutateur <code>-f</code></p>
</li>
<li>
<p>Voir les logs d&rsquo;un service donné : <code>journalctl -u [service]</code></p>
</li>
</ul>
<div class="highlight"><pre>root@debian:~# journalctl -u cron
  ‐‐ Logs begin at Sun 2019‐04‐21 07:14:36 CEST, end at Thu 2019‐05‐09 13:24:52 CEST. ‐‐
  avril <span class="m">21</span> 07:17:01 debian CRON<span class="o">[</span>4404<span class="o">]</span>: pam_unix<span class="o">(</span>cron:session<span class="o">)</span>: session opened <span class="k">for</span> user root by <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">)</span>
  avril <span class="m">21</span> 07:17:01 debian CRON<span class="o">[</span>4405<span class="o">]</span>: <span class="o">(</span>root<span class="o">)</span> CMD <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run‐parts ‐‐report /etc/cron.hourly<span class="o">)</span>
  avril <span class="m">21</span> 07:30:01 debian CRON<span class="o">[</span>4409<span class="o">]</span>: pam_unix<span class="o">(</span>cron:session<span class="o">)</span>: session opened <span class="k">for</span> user root by <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">)</span>
</pre></div>

<ul>
<li>Voir les logs pour un PDI donné : `journalctl _PID=PID</li>
</ul>
<div class="highlight"><pre>root@debian:~# journalctl <span class="nv">_PID</span><span class="o">=</span>1
  ‐‐ Logs begin at Sun 2019‐04‐21 07:14:36 CEST, end at Thu 2019‐05‐09 13:24:52 CEST. ‐‐
  avril <span class="m">21</span> 08:01:38 debian systemd<span class="o">[</span>1<span class="o">]</span>: Started Run anacron jobs.
  avril <span class="m">21</span> 08:01:38 debian systemd<span class="o">[</span>1<span class="o">]</span>: anacron.timer: Adding 2min 48.679199s random time.
  avril <span class="m">21</span> 08:53:38 debian systemd<span class="o">[</span>1<span class="o">]</span>: Starting Daily apt download activities...
  avril <span class="m">21</span> 08:53:45 debian systemd<span class="o">[</span>1<span class="o">]</span>: Started Daily apt download activities.
  avril <span class="m">21</span> 08:53:45 debian systemd<span class="o">[</span>1<span class="o">]</span>: apt‐daily.timer: Adding 10h 23.576305s random time.
</pre></div>

<ul>
<li>Voir les logs d’un programme : <code>journalctl /usr/bin/sshd</code></li>
</ul>
<div class="highlight"><pre>root@debian:~# journalctl /usr/sbin/sshd
  ‐‐ Logs begin at Sun 2019‐04‐21 07:14:36 CEST, end at Thu 2019‐05‐09 13:24:52 CEST. ‐‐
  mai <span class="m">06</span> 09:56:38 debian sshd<span class="o">[</span>18899<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:auth<span class="o">)</span>: authentication failure<span class="p">;</span> <span class="nv">logname</span><span class="o">=</span> <span class="nv">uid</span><span class="o">=</span><span class="m">0</span> <span class="nv">euid</span><span class="o">=</span><span class="m">0</span> <span class="nv">tty</span><span class="o">=</span>ssh
  <span class="nv">ruser</span><span class="o">=</span> <span class="nv">rhost</span><span class="o">=</span>10.9.121.13 <span class="nv">user</span><span class="o">=</span>root
  mai <span class="m">06</span> 09:56:40 debian sshd<span class="o">[</span>18899<span class="o">]</span>: Failed password <span class="k">for</span> root from 10.9.121.13 port <span class="m">60040</span> ssh2
  mai <span class="m">06</span> 09:56:48 debian sshd<span class="o">[</span>18901<span class="o">]</span>: Accepted password <span class="k">for</span> penthium from 10.9.121.13 port <span class="m">60042</span> ssh2
  mai <span class="m">06</span> 09:56:48 debian sshd<span class="o">[</span>18901<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:session<span class="o">)</span>: session opened <span class="k">for</span> user penthium by <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">)</span>
  mai <span class="m">06</span> 15:48:06 debian sshd<span class="o">[</span>18901<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:session<span class="o">)</span>: session closed <span class="k">for</span> user penthium
</pre></div>

<ul>
<li>Voir les logs par niveau de priorité : <code>journalctl ‐p LEVEL</code></li>
</ul>
<div class="highlight"><pre>root@debian:~# journalctl ‐p err
  ‐‐ Logs begin at Sun 2019‐04‐21 07:14:36 CEST, end at Thu 2019‐05‐09 13:24:52 CEST. ‐‐
  mai <span class="m">06</span> 07:42:43 debian kernel: sd 3:0:0:0: <span class="o">[</span>sdc<span class="o">]</span> No Caching mode page found
  mai <span class="m">06</span> 07:42:43 debian kernel: sd 3:0:0:0: <span class="o">[</span>sdc<span class="o">]</span> Assuming drive cache: write through
  mai <span class="m">06</span> 10:05:19 debian gdm‐password<span class="o">][</span>18939<span class="o">]</span>: pam_unix<span class="o">(</span>gdm‐password:auth<span class="o">)</span>: conversation failed
  mai <span class="m">06</span> 10:05:19 debian gdm‐password<span class="o">][</span>18939<span class="o">]</span>: pam_unix<span class="o">(</span>gdm‐password:auth<span class="o">)</span>: auth could not identify password <span class="k">for</span>
  <span class="o">[</span>penthium<span class="o">]</span>
</pre></div>

<p>Les différents niveaux de priorités sont du plus critique au plus informatif : <strong>emerg</strong>, <strong>alert</strong>, <strong>crit</strong>, <strong>err</strong>, <strong>warning</strong>, <strong>notice</strong>, <strong>info</strong>, <strong>debug</strong></p>
<p>Il est possible de cumuler les options :</p>
<div class="highlight"><pre>root@debian:~# journalctl ‐f /usr/sbin/sshd ‐p info
  ‐‐ Logs begin at Sun 2019‐04‐21 07:14:36 CEST. ‐‐
  mai <span class="m">06</span> 09:56:48 debian sshd<span class="o">[</span>18901<span class="o">]</span>: Accepted password <span class="k">for</span> penthium from 10.9.121.13 port <span class="m">60042</span> ssh2
  mai <span class="m">06</span> 09:56:48 debian sshd<span class="o">[</span>18901<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:session<span class="o">)</span>: session opened <span class="k">for</span> user penthium by <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">)</span>
  mai <span class="m">06</span> 15:48:06 debian sshd<span class="o">[</span>18901<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:session<span class="o">)</span>: session closed <span class="k">for</span> user penthium
</pre></div>

<h4 id="1122-rsyslog-a-travers-journald">11.2.2 rsyslog à travers journald<a class="headerlink" href="#1122-rsyslog-a-travers-journald" title="Permanent link"></a></h4>
<p><code>journald</code> a certes l&rsquo;avantage de stocker les logs dans une base de données mais <strong>ces logs sont uniquement conservés pour le démarrage en cours</strong>.</p>
<p>Pour conserver les logs, Debian utilise <code>rsyslog</code>. Tous les logs de <code>journalctl</code> sont transférés à <code>rsyslog</code>.</p>
<h5 id="11221-principe-de-fonctionnement">11.2.2.1 Principe de fonctionnement<a class="headerlink" href="#11221-principe-de-fonctionnement" title="Permanent link"></a></h5>
<p><code>rsyslog</code> travaille sur des <em>&ldquo;facilities&rdquo;</em> et des niveaux de priorités qui déclenchent une action.</p>
<p>Les <em>facilities</em> les plus courantes sont :</p>
<ul>
<li><strong>auth</strong> : utilisé pour des évènements concernant la sécurité ou l&rsquo;authentification à travers des applications d&rsquo;accès (ex. ssh)</li>
<li><strong>authpriv</strong> : utilisé pour les messages relatifs au contrôle d&rsquo;accès.</li>
<li><strong>daemon</strong> : utilisé pour les différents processus systèmes et d&rsquo;application.</li>
<li><strong>kern</strong> : log les events du kernel</li>
<li><strong>mail</strong> : log les events des services mails</li>
<li><strong>user</strong> : facility par défaut quand aucune n&rsquo;est spécifiée</li>
<li><strong>local0</strong> à <strong>local7</strong> : utilisées pour les messages de differents programmes.</li>
<li><strong>*</strong> : designe toutes les facilities.</li>
<li><strong>none</strong> : désigne aucune facility.</li>
</ul>
<p>Les différents niveaux de priorité sont :</p>
<ul>
<li><strong>emerg</strong> : urgence, système inutilisable</li>
<li><strong>alert</strong> : alerte, intervention immédiate nécessaire</li>
<li><strong>crit</strong> : erreur système critique</li>
<li><strong>err</strong> : erreur de fonctionnement</li>
<li><strong>warning</strong> : avertissement</li>
<li><strong>notice</strong> : évènements normaux devant être signalés</li>
<li><strong>info</strong> : pour information</li>
<li><strong>debug</strong> : message de débogage</li>
</ul>
<p>Les actions correspondent généralement à l&rsquo;écriture du journal dans un fichier, mais il est possible de configurer <code>syslog</code> pour qu&rsquo;il envoie les messages à enregistrer vers un autre serveur <code>rsyslog</code>.</p>
<p><strong>Fichier de configuration : /etc/rsyslog</strong> (extraits)</p>
<p><div class="highlight"><pre>auth,authpriv.*
*.*;auth,authpriv.none
#cron.*
daemon.*
kern.*
lpr.*
mail.*
user.*
/var/log/auth.log
‐/var/log/syslog
/var/log/cron.log
‐/var/log/daemon.log
‐/var/log/kern.log
‐/var/log/lpr.log
‐/var/log/mail.log
‐/var/log/user.log
</pre></div>
Le <code>-</code> devant certains chemins indique que l’enregistrement des logs est asynchrone.</p>
<h4 id="1123-commande-dinteraction-avec-journald-et-rsyslog">11.2.3 Commande d&rsquo;interaction avec journald et rsyslog<a class="headerlink" href="#1123-commande-dinteraction-avec-journald-et-rsyslog" title="Permanent link"></a></h4>
<p>Il est possible de faire des tests ou créer des scripts qui interagissent avec <code>journald</code> et <code>rsyslog</code> via la commande <code>logger</code>.</p>
<p>La commande <code>logger</code> permet de logger des messages dans le system log.</p>
<p><strong>Syntaxe</strong></p>
<div class="highlight"><pre>logger [options] [message]
</pre></div>

<blockquote>
<p>logger makes entries in the system log.</p>
<p>When  the  optional message argument is present, it is written to the log.
If it is not present, and the -f option is not given either, then standard input is logged.</p>
</blockquote>
<p><strong>Options usuelles</strong></p>
<ul>
<li><code>-f, --file FILE</code> : log the content of the specified FILE.</li>
<li><code>-p, --priority PRIORITY</code> : enter the message into the log with the specified PRIORITY</li>
</ul>
<p><strong>Exemple</strong> : écrire un message cron de niveau info</p>
<div class="highlight"><pre>root@debian:~# logger -p cron.info message de test
</pre></div>

<p><em>Voir TP 11 - Gestion de la journalisation</em></p>
<p><a href="#05-linux-sysadmin">Retour en haut</a></p>
<h3 id="113-planification-des-taches">11.3 Planification des tâches<a class="headerlink" href="#113-planification-des-taches" title="Permanent link"></a></h3>
<p>La planification des tâches se fait au travers du service <code>cron</code>. Il existe 2 types de planification : la planification utilisateur et la planification système.</p>
<p><strong>cron</strong></p>
<blockquote>
<p>cron - daemon to execute scheduled commands (Vixie Cron)</p>
</blockquote>
<p><strong>SYNOPSIS</strong> </p>
<div class="highlight"><pre>cron [-f] [-l] [-L loglevel]
</pre></div>

<p><strong>DESCRIPTION</strong></p>
<blockquote>
<p>cron is started automatically from /etc/init.d on entering multi-user run‐levels.</p>
</blockquote>
<h4 id="1131-planification-utilisateur">11.3.1 Planification utilisateur<a class="headerlink" href="#1131-planification-utilisateur" title="Permanent link"></a></h4>
<p>La commande <code>crontab</code> permet d&rsquo;installer, desinstaller ou lister les tables utilisées par le service <code>cron</code>. </p>
<p><strong>Syntaxe</strong></p>
<div class="highlight"><pre>crontab [-u USER] FILE
crontab [-u USER] [-i] { -e | -l | -r }
</pre></div>

<ul>
<li><code>-u</code> : name of user whose crontab is to be used. Note that <em>su</em> can confuse <em>crontab</em> and that if you are running inside of <em>su</em> you should always use the <em>-u</em> option for safety&rsquo;s sake.</li>
<li><code>-e</code> : edit the current crontab using the editor defined in VISUAL or EDITOR env var. The modified crontab will be installed automatically upon exit.</li>
<li><code>-l</code> : display current crontab in output (list)</li>
<li><code>-r</code> : remove current crontab</li>
<li><code>-i</code> : prompt the user for comfirmation before removing the crontab. Modifies the -r option.</li>
</ul>
<p><strong>Description</strong></p>
<blockquote>
<p>crontab - maintain crontab files for individual users (Vixie Cron)</p>
<p>crontab  is the program used to install, deinstall or list the tables used to drive the cron(8) daemon in Vixie Cron. Each user can have  their  own crontab,  and though these are files in /var/spool/cron/crontabs, they are not intended to be edited directly.</p>
</blockquote>
<p>Au premier lancement de la commande Debian vous proposera de choisir l&rsquo;éditeur de texte à utiliser, sauf si les variables d&rsquo;environnement VISUAL ou EDITOR sont définies.</p>
<div class="highlight"><pre>penthium @debian:~# crontab ‐e
  no crontab for root ‐ using an empty one

  Select an editor. To change later, run &#39;select‐editor&#39;.
  1. /bin/nano
  &lt;‐‐‐‐ easiest
  2. /usr/bin/vim.basic &lt;‐‐‐‐ the best 😊
  3. /usr/bin/vim.tiny
  Choose 1‐3 [1]: 2
</pre></div>

<p><strong>Composition du fichier</strong>:</p>
<ul>
<li><strong>minutes</strong>            : de 0 à 59</li>
<li><strong>heure</strong>              : de 0 à 23</li>
<li><strong>jour du mois</strong>       : de 1 à 31</li>
<li><strong>mois</strong>               : de 1 à 12</li>
<li><strong>jour de la semaine</strong> : de 0 à 7, avec 0=7=dimanche)</li>
<li><strong>commande</strong>           : la commande à executer suivant la planification (il est fortement conseillé d&rsquo;utiliser un script pour des raisons de simplification du suivi des actions).</li>
</ul>
<p>Pour les 5 premières colonnes, il est possible de les formater :</p>
<ul>
<li>avec des <strong>listes</strong> en utilisant le caractère <code>,</code>. <ul>
<li>Ex. <code>1,2,3</code> dans la colonne des jours de la semaine génère une tâche tous les lundi, mercredi et vendredi.</li>
</ul>
</li>
<li>avec des <strong>intervalles</strong> en utilisant <code>-</code> :<ul>
<li>Ex. <code>10-20</code> dans la colonne jours du mois pour générer une tâche exécutée du 10 au 20 </li>
</ul>
</li>
<li>avec un <strong>joker</strong> en utilisant <code>*</code><ul>
<li>Ex. <code>*</code> dans la colonne des heures indique toutes les heures</li>
</ul>
</li>
<li>avec un <strong>répétiteur</strong> en utilisant <code>/</code><ul>
<li>Ex. <code>*/2</code> dans la colonne des mois génère une tâche exécutée en Janvier, Mars, Mai, Juillet, Septembre, Novembre.</li>
</ul>
</li>
</ul>
<p><strong>Exemple de configuration</strong>: tâche exécutée chaque lundi à 5h du matin durant toutes l&rsquo;année quel que soit le mois.</p>
<div class="highlight"><pre><span class="m">0</span>   <span class="m">5</span>   *   *   <span class="m">1</span>   /opt/bin/backup.sh
</pre></div>

<h4 id="1132-planification-systeme">11.3.2 Planification système<a class="headerlink" href="#1132-planification-systeme" title="Permanent link"></a></h4>
<p>Cron utilise une table spéciale pour les tâches de planification du système. Ces tâches sont déclarées dans le fichier <code>/etc/crontab</code>.</p>
<div class="highlight"><pre>eni@deb-srv:~<span class="nv">$ </span>cat /etc/crontab
<span class="c1"># /etc/crontab: system-wide crontab</span>
<span class="c1"># Unlike any other crontab you don&#39;t have to run the `crontab&#39;</span>
<span class="c1"># command to install the new version when you edit this file</span>
<span class="c1"># and files in /etc/cron.d. These files also have username fields,</span>
<span class="c1"># that none of the other crontabs do.</span>

<span class="nv">SHELL</span><span class="o">=</span>/bin/sh
<span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

<span class="c1"># Example of job definition:</span>
<span class="c1"># .---------------- minute (0 - 59)</span>
<span class="c1"># |  .------------- hour (0 - 23)</span>
<span class="c1"># |  |  .---------- day of month (1 - 31)</span>
<span class="c1"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="c1"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="c1"># |  |  |  |  |</span>
<span class="c1"># *  *  *  *  * user-name command to be executed</span>
<span class="m">17</span> *    * * *   root    <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts --report /etc/cron.hourly
<span class="m">25</span> <span class="m">6</span>    * * *   root    <span class="nb">test</span> -x /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts --report /etc/cron.daily <span class="o">)</span>
<span class="m">47</span> <span class="m">6</span>    * * <span class="m">7</span>   root    <span class="nb">test</span> -x /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts --report /etc/cron.weekly <span class="o">)</span>
<span class="m">52</span> <span class="m">6</span>    <span class="m">1</span> * *   root    <span class="nb">test</span> -x /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts --report /etc/cron.monthly <span class="o">)</span>
<span class="c1">#</span>
</pre></div>

<p>C&rsquo;est le même système de notation à la différence qu&rsquo;il y a une colonne supplémentaire pour préciser le nom de l&rsquo;utilisateur qui exécutera la tâche (avant la colonne &ldquo;commande à exécuter&rdquo;).</p>
<p>Ici, il y a 4 tâches <strong>cron</strong> lancées toutes les heures, tous les jours, toutes les semaines et tous les mois. Le fonctionnement d&rsquo;<strong>anacron</strong> est expliqué ci-après.</p>
<h4 id="1133-lancement-des-taches-non-executees-avec-anacron">11.3.3 Lancement des tâches non executées avec anacron<a class="headerlink" href="#1133-lancement-des-taches-non-executees-avec-anacron" title="Permanent link"></a></h4>
<p>Il n&rsquo;est pas rare pour un poste client que le système soit coupé durant la nuit. Afin de pouvoir lancer les tâches prévues pendant ces temps de coupure, le système va utiliser des travaux d&rsquo;<strong>anacron</strong>.</p>
<p><code>anacron</code> va comparer la date contenue dans un fichier correspondant à un travail d&rsquo;<code>anacron</code> avec la date du jour. Suivant le paramétrage du travail d&rsquo;anacron, il executera une commande ou pas. Ces fichiers sont dans le répertoire <code>/var/spool/anacron</code></p>
<p><code>anacron</code> s&rsquo;appuie sur le fichier de configuration <code>/etc/anacrontab</code> :</p>
<div class="highlight"><pre><span class="c1"># /etc/anacrontab: configuration file for anacron</span>
<span class="c1"># See anacron(8) and anacrontab(5) for details.</span>

<span class="nv">SHELL</span><span class="o">=</span>/bin/sh
<span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
<span class="nv">HOME</span><span class="o">=</span>/root
<span class="nv">LOGNAME</span><span class="o">=</span>root

<span class="c1"># These replace cron&#39;s entries</span>
<span class="m">1</span>         <span class="m">5</span>    cron.daily     run‐parts ‐‐report /etc/cron.daily
<span class="m">7</span>         <span class="m">10</span>   cron.weekly    run‐parts ‐‐report /etc/cron.weekly
@monthly  <span class="m">15</span>   cron.monthly   run‐parts ‐‐report /etc/cron.monthly
</pre></div>

<ul>
<li>col.1 : indique le nombre de jours maximum entre 2 travaux</li>
<li>col.2 : indique le nombre de minutes de décalage avant l&rsquo;exécution de la commande située dans la 3e colonne.</li>
<li>col.3 : commande</li>
</ul>
<h5 id="11331-analyse-dun-travail-danacron-durant-le-demarrage-du-systeme">11.3.3.1 Analyse d&rsquo;un travail d&rsquo;anacron durant le démarrage du système<a class="headerlink" href="#11331-analyse-dun-travail-danacron-durant-le-demarrage-du-systeme" title="Permanent link"></a></h5>
<p>Pour comprendre le fonctionnement d&rsquo;<code>anacron</code>, l&rsquo;explication suivante va s&rsquo;appuyer sur le travail <code>cron.daily</code>.</p>
<p>Tous les jours si le système reste allumé 24/24, cron va executer cette tâche à 6h25 :</p>
<div class="highlight"><pre><span class="m">25</span> <span class="m">6</span> * * * root <span class="nb">test</span> -x /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts --report /etc/cron.daily <span class="o">)</span>
</pre></div>

<p><strong>Cette tâche a pour effet de lancer tous les scripts présents dans le répertoire <code>/etc/cron.daily</code></strong></p>
<p>En regardant dans ce répertoire, on voit qu&rsquo;il y a un fichier <code>0anacron</code>. Ce script execute une simple commande : <code>anacron -u cron.daily</code>.</p>
<p>Cette commande a pour effet de mettre à jour le fichier <code>/var/spool/anacron/cron.daily</code> en y mettant la date du jour.</p>
<p>Donc si le système tourne 24h/24 ce fichier est mis à jour tous les jours.</p>
<p>Si le système est arrêté à 6h25 pour une raison ou une autre, alors la tâche <code>cron.daily</code> n&rsquo;est pas exécutée et la mise à jour du fichier <code>/var/spool/anacron/cron.daily</code> n&rsquo;est pas faite.</p>
<p>Durant la phase de démarrage du système, <code>anacron</code> analysera la date à l&rsquo;intérieur du fichier <code>/var/spool/anacron/cron.daily</code> et voyant qu&rsquo;il y a plus d&rsquo;un jour de différence, il lancera les commandes configurées dans la table <code>anacron</code>.</p>
<p><em>Voir TP 12 - Gestion de la planification de tâches</em></p>
<p><a href="#05-linux-sysadmin">Retour en haut</a></p>
<h3 id="114-gestion-de-la-taille-des-fichiers-de-log">11.4 Gestion de la taille des fichiers de log<a class="headerlink" href="#114-gestion-de-la-taille-des-fichiers-de-log" title="Permanent link"></a></h3>
<p>Lorsqu&rsquo;il s&rsquo;agit de conserver des traces de journaux, plusieurs questions se posent : 
- Pour combien de temps ?
- Quelle sera la taille de stockage utilisée ?</p>
<p>Sachant que certaines informations doivent être conservées pour une durée imposée par la législation française (ex. les logs d&rsquo;activité internet).</p>
<h4 id="1141-avec-journald">11.4.1 avec journald<a class="headerlink" href="#1141-avec-journald" title="Permanent link"></a></h4>
<p>Nativement <code>journald</code> stocke ses logs dans une base de données volatile dans <code>/run/log/journal</code>. Mais il est possible de demander à <code>journald</code> de garder les logs de façon durable. Dans son fichier de configuration <code>/etc/systemd/journald.conf</code>, on peut paramétrer le type de storage via le paramètre <code>#Storage=auto</code> qui est en mode auto par défaut (il est commenté par défaut mais journald utilise la valeur auto par défaut de toute façon). </p>
<p>Le fait de créer un répertoire <code>/var/log/journal</code> rendra la conservation des logs durable.</p>
<p>La taille de bdd peut vite devenir conséquente sur un système fortement utilisé. Par défaut, <code>journald</code> utilisera un maximum de 10% du système de fichiers hébergeant <code>/var/log/journald</code>.</p>
<p>Il est possible de définir la taille maximum utilisée sur le système de fichier de la bdd avec le paramètre <code>SystemMaxUse=</code>. De plus il est possible de dire que la bdd sera subdivisée en plusieurs fichiers de taille fixe avec le paramètre <code>SystemMaxFileSize=</code>.</p>
<p>Bien évidemment si la décision est prise de garder les logs de <code>journald</code> de façon définitive, il sera peut-être intéresssant de stopper <code>rsyslog</code> afin d&rsquo;éviter les doublons d&rsquo;information.</p>
<div class="highlight"><pre>root@debian:~# systemctl disable rsyslog
</pre></div>

<h4 id="1142-avec-logrotate">11.4.2 avec logrotate<a class="headerlink" href="#1142-avec-logrotate" title="Permanent link"></a></h4>
<p>Le programme <strong>logrotate</strong> permet d&rsquo;effectuer une rotation des logs système, de les compresser ou encore de les envoyer par mail.</p>
<p>Il est executer par une tâche <em>cron</em> système tous les jours. Cette tâche est localisée dans <code>/etc/cron.daily/logrotate</code>.</p>
<blockquote>
<p><strong>SYNOPSIS</strong>
logrotate  [&ndash;force]  [&ndash;debug] [&ndash;state file] [&ndash;skip-state-lock] [&ndash;verbose] [&ndash;log file] [&ndash;mail command] config_file [config_file2 &hellip;]</p>
<p><strong>DESCRIPTION</strong>
logrotate is designed to ease administration of systems that  generate large numbers of log files. It allows automatic rotation, compression, removal, and mailing of log files. Each log file may be handled daily, weekly, monthly, or when it grows too large.</p>
</blockquote>
<p>Le fichier de configuration principal <code>/etc/logrotate.conf</code> définit des valeurs de comportement par défaut. </p>
<p><strong>Exemple de configuration</strong></p>
<div class="highlight"><pre>/var/log/squid/access.log <span class="o">{</span>
  daily
  compress
  delaycompress
  rotate 366
  create 640
<span class="o">}</span>
</pre></div>

<p>La rotation du fichier <code>/var/log/squid/access.log</code> sera effectuée tous les jours (<em>daily</em>) durant 366 jours (<em>rotate 366</em>). La rotation créera un fichier avec <code>access.log</code> avec des droits en octal 640 (<em>create 640</em>) et le fichier de rotation sera compressé à sa 2eme rotation (<em>compress</em>, <em>delaycompress</em>).</p>
<h3 id="115-outils-danalyse-du-systeme">11.5 Outils d&rsquo;analyse du système<a class="headerlink" href="#115-outils-danalyse-du-systeme" title="Permanent link"></a></h3>
<p>Voici une liste non exhaustive de commande permettant de prendre des informations sur le système.</p>
<h4 id="1151-prise-dinformation-sur-le-systeme">11.5.1 Prise d&rsquo;information sur le système<a class="headerlink" href="#1151-prise-dinformation-sur-le-systeme" title="Permanent link"></a></h4>
<h5 id="11511-connaitre-la-version-du-systeme-etcdebian_version">11.5.1.1 Connaître la version du système (/etc/debian_version)<a class="headerlink" href="#11511-connaitre-la-version-du-systeme-etcdebian_version" title="Permanent link"></a></h5>
<div class="highlight"><pre>eni@deb-srv:~<span class="nv">$ </span>cat /etc/debian_version 
11.2
</pre></div>

<h5 id="11512-connaitre-la-version-du-kernel-actif-et-son-architecture-uname-a">11.5.1.2 Connaître la version du kernel actif et son architecture (uname -a)<a class="headerlink" href="#11512-connaitre-la-version-du-kernel-actif-et-son-architecture-uname-a" title="Permanent link"></a></h5>
<div class="highlight"><pre>eni@deb-srv:~$ uname -a
  Linux deb-srv 5.10.0-11-amd64 \#1 SMP Debian 5.10.92-1 (2022-01-18) x86_64 GNU/Linux
</pre></div>

<h5 id="11513-connaitre-le-type-de-cpu-lscpu">11.5.1.3 Connaître le type de CPU (lscpu)<a class="headerlink" href="#11513-connaitre-le-type-de-cpu-lscpu" title="Permanent link"></a></h5>
<div class="highlight"><pre>eni@deb-srv:~$ lscpu
  Architecture :                          x86_64
  Mode(s) opératoire(s) des processeurs : 32-bit, 64-bit
  Boutisme :                              Little Endian
  Tailles des adresses:                   43 bits physical, 48 bits virtual
  Processeur(s) :                         1
  Liste de processeur(s) en ligne :       0
  Thread(s) par cœur :                    1
  Cœur(s) par socket :                    1
  Socket(s) :                             1
  Nœud(s) NUMA :                          1
  Identifiant constructeur :              GenuineIntel
  Famille de processeur :                 6
  Modèle :                                60
  Nom de modèle :                         Intel(R) Core(TM) i5-4690 CPU @ 3.50GHz
  Révision :                              3
  Vitesse du processeur en MHz :          3491.930
  BogoMIPS :                              6983.86
  Constructeur d&#39;hyperviseur :            VMware
  Type de virtualisation :                complet
  Cache L1d :                             32 KiB
  Cache L1i :                             32 KiB
  Cache L2 :                              256 KiB
  Cache L3 :                              6 MiB
  Nœud NUMA 0 de processeur(s) :          0
  Vulnerability Itlb multihit:            KVM: Mitigation: VMX unsupported
  Vulnerability L1tf:                     Mitigation; PTE Inversion
  Vulnerability Mds:                      Mitigation; Clear CPU buffers; SMT Host stat
                                          e unknown
  Vulnerability Meltdown:                 Mitigation; PTI
  Vulnerability Spec store bypass:        Mitigation; Speculative Store Bypass disable
                                          d via prctl and seccomp
  Vulnerability Spectre v1:               Mitigation; usercopy/swapgs barriers and __u
                                          ser pointer sanitization
  Vulnerability Spectre v2:               Mitigation; Full generic retpoline, IBPB con
                                          ditional, IBRS_FW, STIBP disabled, RSB filli
                                          ng
  Vulnerability Srbds:                    Unknown: Dependent on hypervisor status
  Vulnerability Tsx async abort:          Not affected
  Drapeaux :                              fpu vme de pse tsc msr pae mce cx8 apic sep 
                                          mtrr pge mca cmov pat pse36 clflush mmx fxsr
                                           sse sse2 ss syscall nx pdpe1gb rdtscp lm co
                                          nstant_tsc arch_perfmon nopl xtopology tsc_r
                                          eliable nonstop_tsc cpuid pni pclmulqdq ssse
                                          3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe p
                                          opcnt tsc_deadline_timer aes xsave avx f16c 
                                          rdrand hypervisor lahf_lm abm cpuid_fault in
                                          vpcid_single pti ssbd ibrs ibpb stibp fsgsba
                                          se tsc_adjust bmi1 avx2 smep bmi2 invpcid xs
                                          aveopt arat md_clear flush_l1d arch_capabili
                                          ties
</pre></div>

<h5 id="11514-lister-les-informations-des-peripheriques-pci-lspci">11.5.1.4 Lister les informations des périphériques PCI (lspci)<a class="headerlink" href="#11514-lister-les-informations-des-peripheriques-pci-lspci" title="Permanent link"></a></h5>
<div class="highlight"><pre>eni@deb-srv:~<span class="nv">$ </span>lspci
  00:00.0 Host bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX Host bridge <span class="o">(</span>rev 01<span class="o">)</span>
  00:01.0 PCI bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX AGP bridge <span class="o">(</span>rev 01<span class="o">)</span>
  00:07.0 ISA bridge: Intel Corporation 82371AB/EB/MB PIIX4 ISA <span class="o">(</span>rev 08<span class="o">)</span>
  00:07.1 IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE <span class="o">(</span>rev 01<span class="o">)</span>
  00:07.3 Bridge: Intel Corporation 82371AB/EB/MB PIIX4 ACPI <span class="o">(</span>rev 08<span class="o">)</span>
  00:07.7 System peripheral: VMware Virtual Machine Communication Interface <span class="o">(</span>rev 10<span class="o">)</span>
  00:0f.0 VGA compatible controller: VMware SVGA II Adapter
  00:10.0 SCSI storage controller: Broadcom / LSI 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI <span class="o">(</span>rev 01<span class="o">)</span>
  00:11.0 PCI bridge: VMware PCI bridge <span class="o">(</span>rev 02<span class="o">)</span>
  00:15.0 PCI bridge: VMware PCI Express Root Port <span class="o">(</span>rev 01<span class="o">)</span>
  00:15.1 PCI bridge: VMware PCI Express Root Port <span class="o">(</span>rev 01<span class="o">)</span>
  00:15.2 PCI bridge: VMware PCI Express Root Port <span class="o">(</span>rev 01<span class="o">)</span>
  02:00.0 USB controller: VMware USB1.1 UHCI Controller
  02:01.0 Ethernet controller: Intel Corporation 82545EM Gigabit Ethernet Controller <span class="o">(</span>Copper<span class="o">)</span> <span class="o">(</span>rev 01<span class="o">)</span>
  02:02.0 Multimedia audio controller: Ensoniq ES1371/ES1373 / Creative Labs CT2518 <span class="o">(</span>rev 02<span class="o">)</span>
  02:03.0 USB controller: VMware USB2 EHCI Controller
  02:05.0 Ethernet controller: Intel Corporation 82545EM Gigabit Ethernet Controller <span class="o">(</span>Copper<span class="o">)</span> <span class="o">(</span>rev 01<span class="o">)</span>
</pre></div>

<h5 id="11515-lister-les-informations-des-peripheriques-usb-lsusb">11.5.1.5 Lister les informations des périphériques USB (lsusb)<a class="headerlink" href="#11515-lister-les-informations-des-peripheriques-usb-lsusb" title="Permanent link"></a></h5>
<div class="highlight"><pre>eni@deb-srv:~<span class="nv">$ </span>lsusb
  Bus <span class="m">002</span> Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
  Bus <span class="m">001</span> Device 003: ID 0e0f:0002 VMware, Inc. Virtual USB Hub
  Bus <span class="m">001</span> Device 002: ID 0e0f:0003 VMware, Inc. Virtual Mouse
  Bus <span class="m">001</span> Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
</pre></div>

<h5 id="11516-lister-les-informations-sur-les-disques-partitions-lvm-et-systeme-de-fichiers">11.5.1.6 Lister les informations sur les disques, partitions LVM, et système de fichiers<a class="headerlink" href="#11516-lister-les-informations-sur-les-disques-partitions-lvm-et-systeme-de-fichiers" title="Permanent link"></a></h5>
<p>Ces commandes ont déjà été abordées dans le cours : <strong>fdisk -l</strong>, <strong>pvs</strong>, <strong>vgs</strong>, <strong>lvs</strong>, <strong>df -h</strong>, <strong>lsblk</strong>, <strong>blkid</strong>.</p>
<h5 id="11517-lister-les-informations-sur-les-repertoires-et-les-fichiers-du-ls-file-lsof">11.5.1.7 Lister les informations sur les répertoires et les fichiers (du, ls, file, lsof)<a class="headerlink" href="#11517-lister-les-informations-sur-les-repertoires-et-les-fichiers-du-ls-file-lsof" title="Permanent link"></a></h5>
<p><strong>du - Disk Usage: estimate file space usage</strong></p>
<div class="highlight"><pre>reno@debian10-TITAN:~<span class="nv">$ </span>du -hs /media/reno/Playground/MAGASIN-F1/SERIES-F2/
  111G    /media/reno/Playground/MAGASIN-F1/SERIES-F2/

reno@debian10-TITAN:~<span class="nv">$ </span>du -cs /media/reno/Playground/MAGASIN-F1/SERIES-F2/
  <span class="m">115968163</span>       /media/reno/Playground/MAGASIN-F1/SERIES-F2/
  <span class="m">115968163</span>       total

reno@debian10-TITAN:~<span class="nv">$ </span>du -chs /media/reno/Playground/MAGASIN-F1/SERIES-F2/
  111G    /media/reno/Playground/MAGASIN-F1/SERIES-F2/
  111G    total
</pre></div>

<p><strong>ls - list directory content</strong></p>
<div class="highlight"><pre>root@debian:~# ls ‐l fic
  ‐rw‐r‐‐r‐‐ <span class="m">1</span> root root <span class="m">7973</span> mai <span class="m">10</span> 10:11 fic
</pre></div>

<p><strong>file - determine file type</strong></p>
<div class="highlight"><pre>eni@deb-srv:~<span class="nv">$ </span>file /bin/bash
  /bin/bash: ELF 64-bit LSB pie executable, x86-64, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID<span class="o">[</span>sha1<span class="o">]=</span>3313b4cb119dcce16927a9b6cc61dcd97dfc4d59, <span class="k">for</span> GNU/Linux 3.2.0, stripped
</pre></div>

<p><strong>lsof - list open files</strong></p>
<div class="highlight"><pre>root@debian:~# lsof /root
lsof: WARNING: can&#39;t stat() fuse.gvfsd‐fuse file system /run/user/1000/gvfs
  Output information may be incomplete.
  COMMAND PID USER  FD TYPE DEVICE SIZE/OFF   NODE NAME
  bash   2074 root cwd  DIR  254,0     4096 781836 /root
  bash   2179 root cwd  DIR  254,0     4096 781836 /root
  lsof   3826 root cwd  DIR  254,0     4096 781836 /root
  lsof   3827 root cwd  DIR  254,0     4096 781836 /root
</pre></div>

<h5 id="11518-performances-et-processus">11.5.1.8 Performances et processus<a class="headerlink" href="#11518-performances-et-processus" title="Permanent link"></a></h5>
<h6 id="115181-infos-en-temps-reel-top-htop-atop-glances">11.5.1.8.1 Infos en temps réel (top, htop, atop, glances)<a class="headerlink" href="#115181-infos-en-temps-reel-top-htop-atop-glances" title="Permanent link"></a></h6>
<p>Plusieurs outils sont disponibles pour monitorer les process en temps réel.</p>
<p><strong>top (native)</strong></p>
<p><img alt="top" src="../ressources/img/05-linux-sysadmin/resmon_top.png" title="top (natif)" /></p>
<p><strong>htop (à installer)</strong></p>
<p><img alt="htop" src="../ressources/img/05-linux-sysadmin/resmon_htop.png" title="htop (à installer)" /></p>
<div class="highlight"><pre><span class="nv">$ </span>sudo apt install htop
</pre></div>

<p><strong>atop (à installer)</strong></p>
<p><img alt="atop" src="../ressources/img/05-linux-sysadmin/resmon_atop.png" title="atop (à installer)" /></p>
<div class="highlight"><pre><span class="nv">$ </span>sudo apt install atop
</pre></div>

<p><strong>glances (à installer)</strong> - écrit en python3</p>
<p><img alt="glances" src="../ressources/img/05-linux-sysadmin/resmon_glances.png" title="glances (à installer)" /></p>
<p>Glances est une version plus poussée des outils d&rsquo;analyse en temps réel avec beaucoup d&rsquo;options. Il peut être installé en mode client/serveur, remonter ses informations dans des logiciels de supervision, etc. Plus d&rsquo;information sur le site du projet : <a class="magiclink magiclink-github magiclink-repository" href="https://github.com/nicolargo/glances/" title="GitHub Repository: nicolargo/glances">nicolargo/glances</a></p>
<p>Installation avec <code>pip</code> : </p>
<div class="highlight"><pre><span class="nv">$ </span>pip install --user glances
</pre></div>

<h6 id="115182-infos-directes-ps-pgrep-free">11.5.1.8.2 Infos directes (ps, pgrep, free)<a class="headerlink" href="#115182-infos-directes-ps-pgrep-free" title="Permanent link"></a></h6>
<p><strong>lister les processus avec ps</strong></p>
<p>La commande <code>ps</code> permet d&rsquo;afficher les processus.</p>
<div class="highlight"><pre>eni@deb-srv:~<span class="nv">$ </span>ps ef
    PID TTY      STAT   TIME COMMAND
    <span class="m">960</span> pts/0    Ss     0:00 -bash <span class="nv">LC_ADDRESS</span><span class="o">=</span>fr_FR.UTF-8 <span class="nv">LC_NAME</span><span class="o">=</span>fr_FR.UTF-8 LC_MON
   <span class="m">3108</span> pts/0    R+     0:00  <span class="se">\_</span> ps ef <span class="nv">SHELL</span><span class="o">=</span>/bin/bash <span class="nv">LC_ADDRESS</span><span class="o">=</span>fr_FR.UTF-8 LC_NAM
</pre></div>

<p><strong>lister les processus avec pgrep</strong></p>
<p>La commande <code>pgrep</code> permet d&rsquo;utiliser la recherche par regex.</p>
<div class="highlight"><pre>eni@deb-desktop:~<span class="nv">$ </span>pgrep -l vi
  <span class="m">632</span> VGAuthService
  <span class="m">1254</span> dconf-service
</pre></div>

<p><strong>Information sur la RAM</strong></p>
<p>La commande <code>free</code> permet d&rsquo;afficher des informations simplifiées.</p>
<div class="highlight"><pre>eni@deb-desktop:~<span class="nv">$ </span>free -h
                 total        used        free      shared  buff/cache   available
  Mem:           3.8Gi       984Mi       997Mi        47Mi       1.9Gi       2.6Gi
  Swap:          3.8Gi          0B       3.8Gi
</pre></div>

<p><em>Voir TP 13 - Relevé d&rsquo;informations système et gestion des processus</em></p>
<p><a href="#05-linux-sysadmin">Retour en haut</a></p>
<div class="the_end">-THE END-</div>

<p><link rel="stylesheet" type="text/css" href="................../ressources/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="................../ressources/css/style.css"></p>
<style>

img {
  border: 1px solid black;
  display: block;
  max-width: 600px;
  max-height: 700px; 
  margin: 0 auto;
}

img[alt=etc-group] {
  display: block;
  height: 200px;
  margin: 0 auto;
}

img[alt=etc-passwd] {
  display: block;
  height: 200px;
  margin: 0 auto;
}

</style></article></body></html>